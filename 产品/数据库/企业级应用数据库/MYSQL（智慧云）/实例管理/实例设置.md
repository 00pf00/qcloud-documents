## 设置读写模式
### 背景介绍
当业务系统升级、故障恢复、巡检演练等过程中，需要控制数据写入，以避免数据混乱。
>!设置成只读模式时将导致数据库不可写，可能造成业务异常，请谨慎操作。

### 操作步骤
1. 在赤兔管理台主界面，点击左侧菜单【实例管理】，进入实例管理界面。
2. 进入实例详情/set详情界面。 
非分布式实例设置读写模式在【实例详情】页面，分布式实例设置读写模式在【set详情】页面。
	- 对于非分布式实例：选择所需非分布式实例ID>【实例详情】，进入实例详情界面。
	- 对于分布式实例：选择所需分布式实例ID>【Set管理】>选择所需子SetID，进入set详情页面。
3. 查看读写模式的设置项，如需更改，点击右侧【设置读写模式】，系统弹出【设置Set读写模式】对话框。
4. 将【读写模式】设置成可写或只读，点击【确定】，系统进入任务详情页，可以查看实例的读写模式设置进度和结果。


## 设置扩缩容
### 非分布式实例扩（缩）容
####   背景介绍
当非分布式实例性能、容量不足以支撑业务需要时，可以通过扩容以扩展实例配置；当实例容量远超业务需要而形成浪费时，可通过缩容来缩减实例配置。
>!非分布式实例最大的可扩展配置为物理硬件配置，缩容时不能超过实例所有表空间和日志的占用空间。

#### 操作步骤
1. 在赤兔管理台主界面，点击左侧菜单【实例管理】，进入实例管理界面。
2. 点击需要扩/缩容的实例ID，点击【实例详情】进入实例详情页面。
3. 点击【规格】右侧【扩(缩)容】，系统弹出【扩(缩)容非分布式实例】对话框。
4. 输入需要扩(缩)容的实例设置、容灾设置和其他设置项（参考4.1.3新增set步骤3），点击【确定】，系统进入任务详情页，可以查看实例的扩/缩容设置进度和结果。

### 4.7.2.2	分布式实例扩（缩）容
#### 背景介绍
当非分布式实例性能、容量不足以支撑业务需要时，可以通过扩容以扩展实例配置；当实例容量远超业务需要而形成浪费时，可通过缩容来缩减实例配置。
分布式实例扩（缩）容指将现有TDSQL实例规格进行升级或降级，因分布式数据库是由多个节点组（Set）组成，因此，其实例升级有升级节点组（Set）和新增节点组（Set）两种方案。
>!实例升级过程中不会停止服务，但部分分片会发生若干秒的只读现象，建议在低峰期进行。

- 升级节点组（Set）
实例升级节点组（Set）也叫实例的垂直扩容，与非分布式实例升级方案类似。 

#### 操作步骤
1. 在赤兔管理台主界面，点击左侧菜单【实例管理】，进入实例管理界面。
2. 选择需要扩/缩容的分布式实例ID，选择【Set管理】进入子实例管理页面。
3. 点击所需子Set【操作】栏下方【扩(缩)容】，进入子Set的【扩(缩)容非分布式实例】页面。
4. 输入需要扩(缩)容的实例设置、容灾设置和其他设置项，点击【保存】，系统进入详情页，可以查看实例的扩容/缩容进度和结果。
	- 新增节点组（Set）
新增节点组（Set），也叫实例的水平扩容，即增加分片数量。

#### 操作步骤
1. 在赤兔管理台主界面，点击左侧菜单【实例管理】，进入实例管理界面。
2. 选择需要扩/缩容的分布式实例ID > 选择【Set管理】进入子实例管理页面。
3. 点击【添加Set+】，系统弹出【添加Set到分布式实例】对话框。
4. 输入新增分片的机型规格、容灾设置和其他设置，点击【保存】，系统进入任务详情页，可以查看新增分片的进度和结果。

## 主备切换
### 背景介绍
主备切换是将主机切换为备机，即将主节点更换为从节点。 
>!进行主备切换时可能导致机器连接中断，请确保数据库有重连机制。

### 操作步骤
1. 在赤兔管理台主界面，点击【实例管理】，进入实例管理界面。
2. 进入实例详情/set详情界面。 
非分布式实例设置主备切换在【实例详情】页面，分布式实例设置主备切换在【set详情】页面。
	- 对于非分布式实例：选择所需非分布式实例ID>【实例详情】，进入实例详情界面。
	- 对于分布式实例：选择所需分布式实例ID>【Set管理】>选择所需SetID，进入set详情页面。
3. 点击【DB节点】右侧【主备切换】，系统弹出【设置主备切换】对话框。
4. 选择需要进行切换的备机，并确认是否需要强制切换，点击【确定】，系统进入详情页，可以查看主机与备机切换进度和结果。

## 重做备机
### 背景介绍
重做备机是将原备机的数据删除，从其他DB机器上拉取全量数据重建备机节点，以恢复主从数据和主从关系。
>!重做备机可能影响系统业务层的读写分离功能，请确保数据库有重连机制。

### 操作步骤
1. 在赤兔管理台主界面，点击【实例管理】，进入实例管理界面。
2. 进入实例详情/set详情界面。
非分布式实例重做备机在【实例详情】页面，分布式实例重做备机在【set详情】页面。
- 对于非分布式实例：选择所需非分布式实例ID>【实例详情】，进入实例详情界面。
- 对于分布式实例：选择所需分布式实例ID>【Set管理】>选择所需SetID，进入set详情页面。
3. 确认是否需要修改主备同步方式（强同步/异步）。 如果没有剩余可用的备机，则需要在实例详情页的【数据复制方式（配置值）】设置成【异步】。
4. 点击【DB节点】右侧【重做备机】，系统弹出【重做备机】对话框。
5. 选择需要重做的备机，点击【重做备机】，系统进入任务详情页，可以查看重做备机的进度和结果。
