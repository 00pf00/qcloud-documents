## 概述

工作流开始运行时，接收 JSON Object（JSON 对象）格式的输入数据，并将输入传递至工作流的第一个工作流节点中，各个节点都将接受一个数据输入并将 JSON 对象格式的输出传到下一个工作流节点。了解数据在不同节点之间的传递方式，如何筛选需要的数据，在工作流的使用中至关重要。在本节中，您将学习控制输入输出处理的重要参数。

在之后的章节中，您将了解工作流如何通过引用路径的方式操作工作流节点的输入、输出，与结果路径。

- **Path** （路径）
- **InputPath** （输入路径）
- **Parameters** （输入参数）
- **ResultSeclector**（结果选择器）
- **ResultPath** （结果路径）
- **OutputPath** （输出路径）

下图显示了输入输出数据如何在工作流节点中移动：

1. **InputPath** 选择 JSON 输入的哪些部分要传递给工作流中节点的任务（例如，云函数）。
2. **Parameters** 会对 **InputPath** 处理后的 JSON 数据进行进一步选择，也可以进行一些新的参数组合。
3. **ResultSelector** 会从节点的输出结果中选择部分参数传递给 **ResultPath**。
4. **ResultPath** 可以将节点的 JSON 输入和节点的输出结果组合成参数，传递给下一个节点输入。
5. **OutputPath** 可以过滤 **ResultPath** 的 JSON 输出，以进一步限制传递给下一个节点的输入信息。

[![img](https://camo.githubusercontent.com/5365cad0dda83bf29f5269b768ffde3543b09ac33f1b4e4d81f13ce699eac7fc/68747470733a2f2f6d61696e2e71636c6f7564696d672e636f6d2f7261772f65623138656636396137633938356336303132346261346637363566623964322e737667)](https://camo.githubusercontent.com/5365cad0dda83bf29f5269b768ffde3543b09ac33f1b4e4d81f13ce699eac7fc/68747470733a2f2f6d61696e2e71636c6f7564696d672e636f6d2f7261772f65623138656636396137633938356336303132346261346637363566623964322e737667)

## 路径（Path）

Path（路径）是以 **$** 开头的字符串，您通过指定特定的路径，可以筛选 JSON 数据中的内容。 路径采用 [JsonPath](https://github.com/json-path/JsonPath) 语法 。

假设需要处理的 JSON 数据如下：

```
{
  "name": "xiaoming",
  "age": 15,
  "class": ["math","chinese","english"],
  "exam_pass": false
}
```

使用引用路径，讲筛选出指定的数据信息。

```
$.name => "xiaoming"
$.age => 15
$.class => ["math", "chinese", "english"]
$.exam_pass => false
```

其中，每一个参数的数据类型都对应 JSON 数据中参数的内容。

## 输入路径（InputPath）

在状态节点中定义 InputPath 字段，节点可以从输入中选择需要的信息。假设输入节点的信息为：

```
{
  "name": "xiaoming",
  "age": 15,
  "class": ["math","chinese","english"],
  "exam_pass": false
}
```

在节点定义中，添加以下键值对：

```
{
  "InputPath": "$.class"
}
```

那么，对应输入节点的信息为一个字符串序列：

```
["math", "chinese", "english"]
```

## 输入参数（Parameters）

您可以通过定义 Parameters 参数，为工作流节点提供特定的输入。Parameters 对应的内容可以是静态值，也可以是从输入信息的 JSON 对象中过滤出特定路径的信息，也可以是以上信息的组合。每一个参数由一个键值对组成。在使用路径选择的值的键值对时，键名需要以 **.$** 结尾。

假设您提供以下输入：

```
{
  "name": "xiaoming",
  "age": 15,
  "class": ["math","chinese","english"],
  "grades": {
    "math": 95,
    "english": 100,
    "chinese": 10
  },
  "exam_pass": false
}
```

您可以在工作流节点中定义 Parameters：

```
{
  "Parameters": {
    "comment": "Just choose some info",
    "Student": {
      "name.$": "$.name",
      "mathgrades.$": "$.grades.math",
      "presence": true
    }
  }
}
```

根据输入的内容和给出的路径，实际输入状态节点的 JSON 对象数据为：

```
{
  "comment": "Just choose some info",
  "Student": {
    "name": "xiaoming",
    "mathgrades": 95,
    "presence": true
  }
}
```

## 结果选择器（ResultSelector）

您可以通过 ResultSelector，为执行的工作流节点提供特定的输出，并传送给 ResultPath。ResultSelector 对应的内容可以是静态值，也可以是从输入信息的 JSON 中过滤出特定路径的信息，也可以是以上信息的组合。每一个参数由一个键值对组成。在使用路径选择的值的键值对时，键名需要以 **.$** 结尾。

ResultSelector 是以下状态的可选字段:

- Pass 节点
- Task 节点
- Parallel 节点
- Map 节点
- Choice 节点

例如一个Task节点的执行输出：

```
{
  "date": "2021-01-20 10:00:00",
  "cos": {
    "cosBucket": {
      "appid": "123456789",
      "name": "susu3",
      "region": "sh",
      "s3Region": "ap-shanghai"
    },
    "cosObject": {
      "key": "/123456789/susu3/video/inputs/2.mp4",
      "size": 11999578,
      "url": "http://susu3-123456789.cos.ap-shanghai.myqcloud.com/video/inputs/2.mp4"
    }
  },
  "httpStatus": 200,
  "requestId": "NjAwYTc0N2VfMmE5ZDA4MDlfODkyMl81YWFiYWJh"
}
```

可以通过 ResultSelector 进行选择，如 Task 节点定义如下：

```
{
  "GetCosObject": {
    "Type": "Task",
    "Comment": "invoke scf component",
    "Resource": "qrn:qcs:asw:ap-guangzhou:123456789:sdk:json:qcloud:scf:Invoke/getCosObject",
    "ResultSelector": {
      "bucketName.$": "$.cos.cosBucket.name",
      "ObjectKey.$": "$.cos.cosObject.key"
    },
    "End": true
  }
}
```

输出的结果为：

```
{
  "bucketName": "susu3",
  "objectKey": "/123456789/susu3/video/inputs/2.mp4"
}
```

## 结果路径（ResultPath）

节点的输出可以是其输入的信息，也可以是节点的计算结果，如果在工作流中导入云函数，计算结果为云函数的输出。同时您也可以将计算结果作为新的键值对插入节点输入中，或直接写入输入信息的参数中。

支持 ResultPath 参数的有以下几个节点。

- Pass 节点
- Task 节点
- Parallel 节点
- Map 节点
- Choice 节点

使用 ResultPath，您可以将输入信息和计算结果结合，作为本节点的输出信息传至下一个节点。

ResultPath 有以下几种使用方式：

- [仅使用计算结果](https://github.com/tencentyun/qcloud-documents/blob/master/product/应用程序集成/应用与服务工作流/工作流语言.md#onlyresult)
- [仅使用原始输入](https://github.com/tencentyun/qcloud-documents/blob/master/product/应用程序集成/应用与服务工作流/工作流语言.md#justoutput)
- [将计算结果包含在输入中](https://github.com/tencentyun/qcloud-documents/blob/master/product/应用程序集成/应用与服务工作流/工作流语言.md#includeoutput)

### 仅使用计算结果

如果不设置 ResultPath，默认"ResultPath": “$”。那么节点将不对输入进行处理，直接使用节点执行结果作为输出 。

[![1615881810454](https://camo.githubusercontent.com/54359d69dad117b99bac302b2efc6240d6fc22c15d94e416a720a34e94adf8a8/68747470733a2f2f6d61696e2e71636c6f7564696d672e636f6d2f7261772f36313230663639393862633635316530613663616533626162656634633964342e706e67)](https://camo.githubusercontent.com/54359d69dad117b99bac302b2efc6240d6fc22c15d94e416a720a34e94adf8a8/68747470733a2f2f6d61696e2e71636c6f7564696d672e636f6d2f7261772f36313230663639393862633635316530613663616533626162656634633964342e706e67)

### 仅使用原始输入

如果将 ResultPath 设置为 null，它会丢弃计算结果，将原始输入传递给输出。使用 "ResultPath": null 时，节点的输入有效负载将直接复制到输出中，而不考虑结果。

[![1615881267700](https://camo.githubusercontent.com/e64d4a6855fd3b43d8577adaee9a29753d863bb7df8cfb12922ffeacd34d1ee7/68747470733a2f2f6d61696e2e71636c6f7564696d672e636f6d2f7261772f36386465363461643131613464663434396361663261323936663931366162622e706e67)](https://camo.githubusercontent.com/e64d4a6855fd3b43d8577adaee9a29753d863bb7df8cfb12922ffeacd34d1ee7/68747470733a2f2f6d61696e2e71636c6f7564696d672e636f6d2f7261772f36386465363461643131613464663434396361663261323936663931366162622e706e67)

### 将计算结果包含在输入中

下图展示了 ResultPath 如何包含节点结果与输入。

[![1615881267700](https://camo.githubusercontent.com/2e3af591d757bb8a5905fec47bd4b3a9792cd7645a7908a31965be0192aa4ba2/68747470733a2f2f6d61696e2e71636c6f7564696d672e636f6d2f7261772f65303263643936393036663061336161643131646433313032363362653964362e706e67)](https://camo.githubusercontent.com/2e3af591d757bb8a5905fec47bd4b3a9792cd7645a7908a31965be0192aa4ba2/68747470733a2f2f6d61696e2e71636c6f7564696d672e636f6d2f7261772f65303263643936393036663061336161643131646433313032363362653964362e706e67)

本案例基于 [使用工作流编排云函数](https://cloud.tencent.com/document/product/1272/50726) 的案例，如果在**InvokeScf**节点的定义中插入以下键值对定义 ResultPath：

```
{
  "Comment": "",
  "StartAt": "InvokeScf",
  "States": {
    "InvokeScf": {
      "Type": "Task",
      "ResultPath": "$.info",
      "Resource": "qrn:qcs:asw:ap-guangzhou:123456789:sdk:json:qcloud:scf:Invoke/scf-demo/$DEFAULT/default",
      "End": true
    }
  }
}
```

在示例中，节点的输入为：

```
{
  "comment": "this is an example.",
  "user": "Lucy",
  "age": 15
}
```

加入 ResultPath 定义后，节点的输出变为：

```
{
  "comment": "this is an example.",
  "user": "Lucy",
  "age": 15
}
```

其中 info键对应云函数的返回结果。

如果键名已经存在于输入中，那么计算结果将会更新输入中对应的键值。

[![1615881267700](https://camo.githubusercontent.com/dc20cb331771543f4af5d043e7f7bf78f1f67c2d6ea63377cc6216621ce6d8da/68747470733a2f2f6d61696e2e71636c6f7564696d672e636f6d2f7261772f64383266393632613630373563383935326533393837303231336431363034382e706e67)](https://camo.githubusercontent.com/dc20cb331771543f4af5d043e7f7bf78f1f67c2d6ea63377cc6216621ce6d8da/68747470733a2f2f6d61696e2e71636c6f7564696d672e636f6d2f7261772f64383266393632613630373563383935326533393837303231336431363034382e706e67)

例如，将工作流节点 **ResultPath** 对应的值改为如下内容：

```
{
  "ResultPath": "$.comment"
}
```

那么对应的输出信息将变为：

```
{
  "comment": "Name is Lucy. Age is 15.",
  "user": "Lucy",
  "age": 15
}
```

## 输出路径（OutputPath）

OutputPath 可以帮助您过滤节点的输出信息，您可以选择上一节点中需要的输出内容作为下一个节点的输入。OutputPath 的默认值为“$”，即将整个输出值传送至下一节点。

假设您此节点的输出内容为：

```
{
  "name": "xiaoming",
  "age": 15,
  "class": ["math","chinese","english"],
  "exam_pass": false
}
```

如果您在此节点定义中添加以下字段：

```
{
  "OutputPath": "$.exam_pass"
}
```

那么，传入下一节点的输入为：

```
{
  "exam_pass": false
}
```

