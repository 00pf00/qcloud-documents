# SCS + CKafka 构建实时异常检测系统
## 前言
&nbsp;&nbsp;异常检测包括众多应用场景，包括：金融风控，设备运行监控，气象预测，入侵检测等，在大多数情况下，能及时的发现异常情况，就能提前控制异常情况的蔓延；因此构建一个性能优越的异常检测系统就显得十分重要。
&nbsp;&nbsp;腾讯云SCS是基于Apache Flink的一个大数据实时处理流计算系统，用户可以通过定义SQL的方式实现业务逻辑，轻松实现毫秒级，高吞吐的消息处理；腾讯云CKafka是基于Apache Kafka实现的一个分布式，高吞吐量，可扩展性的消息队列，可用于处理监控数据聚合，日志手机，实时数据处理等场景。
## 系统架构
 ![](https://main.qcloudimg.com/raw/0834a34e2f12180af8c7dfcda3c8e0ab.png)
&nbsp;&nbsp;流计算作业使用CKafka，CDB作为数据源，并使用本地缓存提高作业数据处理的实时性，提供作业的吞吐量，并通过流计算管道CDP将结果进行数据集成到关系数据库。
## 实现方法
### Ckafka 消息队列
&nbsp;&nbsp;用于收集客户端上报的数据，如设备CPU,内存等监控数据，金融风控事件数据等，并将上报的数据发到下游的流计算服务；
### Flink实时计算
以Ckafka，CDB作为数据源，从CKafka中读取上报的需要进行异常检测的数据，从CDB中读取进行异常的阈值数据，并将读取来的数据进行比较分析，此处流计算可以使用本地缓存，将远端CDB的阈值数据写入缓存，然后进行流表和维表Join计算，提高计算的实时性和吞吐量；最终得出计算结果，并将计算结果写入到数据目的CDP中；
### CDP 数据集成
数据计算结果写入到流计算的专用数据管道CDP中，CDP具有数据集成的功能，可以将结果数据集成到关系数据库CDB中，以供用户查询。
### 本地缓存Cache 
用户编写流计算作业时候，可以在SQL中指定使用数据缓存，通过数据在本地缓存，减少与远端数据库的交互，提高作业的运行效率。