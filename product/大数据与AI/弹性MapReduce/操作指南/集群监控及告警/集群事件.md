## 功能介绍
集群事件中包含事件列表和事件策略，【事件列表】记录集群发生的关键变化事件或异常事件；【事件策略】支持根据业务情况自定义事件监控触发策略，已开启监控的事件可设置为集群巡检项。

## 查看事件列表
1. 登录 [EMR 控制台](https://console.cloud.tencent.com/emr)，在【集群列表】中单击对应的集群【ID/名称】进入集群详情页。
2. 在集群详情页中选择【集群监控】>【集群事件】>【事件列表】，可直接查看当前集群所有操作事件。
![](https://main.qcloudimg.com/raw/3e97621eafcf8ff5fd86fe47a9fb1190.png)
严重程度如下：
 - 致命：主机或服务的异常事件，人工干预处理，否则服务不可用，这类事件可能持续一段时间。
 - 严重：暂时未造成服务或主机不可用问题，属于预警类，如果一直不处理会产生致命事件。
 - 一般：记录集群发生的常规事件，一般无需特别处理。

## 设置事件策略
1. 登录 [EMR 控制台](https://console.cloud.tencent.com/emr)，在【集群列表】中单击对应的集群【ID/名称】进入集群详情页。

2. 在集群详情页中选择【集群监控】>【集群事件】>【事件策略】，可以自定义设置事件监控触发策略。
3. 事件配置列表包含：事件名、事件发现策略、严重程度（致命/严重/一般）、开启监控、支持修改和保存。

4．事件发现策略分两类：一类事件为系统固定策略事件，不支持用户修改；另一类事件会因客户业务标准的不同而变化，支持用户设置。

5. 事件策略可自定义是否开启事件监控，已开启监控的事件才支持在集群巡检的巡检项中选择，部分事件默认开启，部分事件默认开启且不可关闭；具体规则如下：

| **类别**                                       | **事件名称**                                                 | **事件含义**                                                 | **建议&措施**                              | **默认值**           | **严重程度** | **允许关闭** | **默认开启** |
| ---------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------ | -------------------- | ------------ | ------------ | ------------ |
| **节点**                                       | CPU利用率连续高于阈值                                        | 机器CPU利用率>=m，持续时间t秒(300<=t<=2592000)               | 节点扩容或升配                             | m=85, t=1800         | 严重         | 是           | 是           |
| CPU利用率平均值高于阈值                        | 机器CPU利用率平均值>=m，持续时间t秒(300<=t<=2592000)         | 节点扩容或升配                                               | m=85, t=1800                               | 一般                 | 是           | 否           |              |
| CPU IOwait平均值高于阈值                       | t秒内机器CPU iowait使用率平均值>=m(300<=t<=2592000)          | 人工排查                                                     | m=60, t=1800                               | 严重                 | 是           | 是           |              |
| CPU1秒负载连续高于阈值                         | CPU1分钟负载>=m，持续时间t秒(300<=t<=2592000)                | 节点扩容或升配                                               | m=8, t=1800                                | 一般                 | 是           | 否           |              |
| CPU5秒负载连续高于阈值                         | CPU5分钟负载>=m，持续时间t秒(300<=t<=2592000)                | 节点扩容或升配                                               | m=8, t=1800                                | 严重                 | 是           | 否           |              |
| 内存使用率持续高于阈值                         | 内存用率>=m，持续时间t秒(300<=t<=2592000)                    | 节点扩容或升配                                               | m=85, t=1800                               | 严重                 | 是           | 是           |              |
| SWAP空间持续高于阈值                           | 机器swap内存>m，持续时间t秒(300<=t<=2592000)                 | 节点扩容或升配                                               | m=0.1, t=300                               | 一般                 | 是           | 否           |              |
| 系统进程总数连续高于阈值                       | 系统进程总数>=m，持续时间t秒(300<=t<=2592000)                | 人工排查                                                     | m=10000, t=1800                            | 严重                 | 是           | 是           |              |
| fork子进程总数平均值高于阈值                   | t秒内机器fork子进程总数平均值>=m(300<=t<=2592000)            | 人工排查                                                     | m=5000, t=1800                             | 一般                 | 是           | 否           |              |
| 进程OOM 暂无                                   | 进程发生OOM错误                                              | 调整进程堆内存大小                                           | ——                                         | 严重                 | 否           | 是           |              |
| 磁盘IO错误 暂不支持                            | 磁盘IO发生错误                                               | 更换磁盘                                                     | ——                                         | 致命                 | 是           | 是           |              |
| 磁盘空间使用率持续高于阈值                     | 磁盘空间使用率>=m，持续时间t秒(300<=t<=2592000)              | 节点扩容或升配                                               | m=85, t=1800                               | 严重                 | 是           | 是           |              |
| 磁盘IO设备利用率持续高于阈值                   | 磁盘IO设备利用率>=m，持续时间t秒(300<=t<=2592000)            | 节点扩容或升配                                               | m=85, t=1800                               | 严重                 | 是           | 是           |              |
| 节点文件句柄使用率持续超过阈值                 | 节点文件句柄使用率>=m，持续时间t秒(300<=t<=2592000)          | 人工排查                                                     | m=85, t=1800                               | 一般                 | 是           | 否           |              |
| 节点TCP连接数持续超过阈值                      | 节点TCP连接数>=m，持续时间t秒(300<=t<=2592000)               | 检查是否存在连接泄露                                         | m=10000, t=1800                            | 一般                 | 是           | 否           |              |
| 节点进程缺失                                   | 节点服务进程缺失                                             | 查看服务日志以定位服务无法被拉起原因                         | ——                                         | 一般                 | 否           | 是           |              |
| 节点心跳丢失                                   | 节点心跳未定时上报                                           | 人工排查                                                     | ——                                         | 致命                 | 否           | 是           |              |
| Hostname错误                                   | 节点hostname错误                                             | 人工排查                                                     | ——                                         | 致命                 | 否           | 是           |              |
| 元数据库Ping失败                               | CDB心跳未定时上报                                            | ——                                                           | ——                                         | ——                   | ——           | ——           |              |
| **HDFS**                                       | HDFS文件总数持续高于阈值                                     | 集群文件总数量>=m，持续时间t秒(300<=t<=2592000)              | 调大namenode内存                           | m=50,000,000, t=1800 | 严重         | 是           | 否           |
| HDFS文件总数平均值高于阈值                     | t秒内集群文件总数量平均值>=m(300<=t<=2592000)                | 调大namenode内存                                             | m=50,000,000, t=1800                       | 严重                 | 是           | 否           |              |
| HDFS总block数量持续高于阈值                    | 集群Blocks总数量>=m，持续时间t秒(300<=t<=2592000)            | 调大namenode内存或调大block size                             | m=50,000,000, t=1800                       | 严重                 | 是           | 否           |              |
| HDFS总block数量平均值高于阈值                  | t秒内集群Blocks总数量平均值>=m(300<=t<=2592000)              | 调大namenode内存或调大block size                             | m=50,000,000, t=1800                       | 严重                 | 是           | 否           |              |
| HDFS标记为 Dead 状态的数据节点数量持续高于阈值 | 标记为 Dead 状态的数据节点数量>=m，持续时间t秒(300<=t<=2592000) | 人工排查                                                     | m=1,t=1800                                 | 一般                 | 是           | 否           |              |
| HDFS存储空间使用率持续高于阈值                 | HDFS存储空间使用率>=m，持续时间t秒(300<=t<=2592000)          | 清理HDFS中的文件或对集群扩容                                 | m=85, t=1800                               | 严重                 | 是           | 是           |              |
| HDFS存储空间使用率平均值高于阈值               | HDFS存储空间使用率平均值>=m，持续时间t秒(300<=t<=2592000)    | 清理HDFS中的文件或对集群扩容                                 | m=85, t=1800                               | 严重                 | 是           | 否           |              |
| NameNode 发生主备切换                          | NameNod发生主备切换                                          | 排查NameNode切换的原因                                       | -                                          | 严重                 | 是           | 是           |              |
| NameNode RPC请求处理延迟持续高于阈值           | RPC请求处理延迟>= m毫秒，持续时间t秒(300<=t<=2592000)        | 人工排查                                                     | m=300, t=300                               | 严重                 | 是           | 否           |              |
| NameNode 当前连接数持续高于阈值                | NameNode 当前连接数>=m，持续时间t秒(300<=t<=2592000)         | 人工排查                                                     | m=2000, t=1800                             | 一般                 | 是           | 否           |              |
| NameNode 发生full GC                           | NameNode 发生full GC                                         | 参数调优                                                     | -                                          | 严重                 | 是           | 是           |              |
| NameNode JVM内存使用率持续高于阈值             | NameNode JVM内存使用率持续 >= m，持续时间t秒(300<=t<=2592000) | 调整NameNode堆内存大小                                       | m=85, t=1800                               | 严重                 | 是           | 是           |              |
| DataNode RPC请求处理延迟持续高于阈值           | RPC请求处理延迟>= m毫秒，持续时间t秒(300<=t<=2592000)        | 人工排查                                                     | m=300, t=300                               | 一般                 | 是           | 否           |              |
| DataNode 当前连接数持续高于阈值                | DataNode 当前连接数>=m，持续时间t秒(300<=t<=2592000)         | 人工排查                                                     | m=2000, t=1800                             | 一般                 | 是           | 否           |              |
| DataNode 发生full GC                           | NameNode 发生full GC                                         | 参数调优                                                     | -                                          | 一般                 | 是           | 否           |              |
| DataNode JVM内存使用率持续高于阈值             | NameNode JVM内存使用率持续 >= m，持续时间t秒(300<=t<=2592000) | 调整DataNode堆内存大小                                       | m=85, t=1800                               | 一般                 | 是           | 是           |              |
| **YARN**                                       | 集群当前丢失的NodeManager的个数持续高于阈值                  | 集群当前丢失的NodeManager的个数>=m，持续时间t秒(300<=t<=2592000) | 检查NM进程状态，检查网络是否畅通           | m=1, t=1800          | 一般         | 是           | 否           |
| Pending Containers 个数持续高于阈值            | pengding Containers 个数>=m个，持续时间t秒(300<=t<=2592000)  | 合理指定YARN任务可用资源                                     | m=90, t=1800                               | 一般                 | 是           | 否           |              |
| 集群内存使用率持续高于阈值                     | 内存使用率 >= m，持续时间t秒(300<=t<=2592000)                | 集群扩容                                                     | m=85, t=1800                               | 严重                 | 是           | 是           |              |
| 集群内存使用率平均值高于阈值                   | t秒内内存使用率平均值 >= m(300<=t<=2592000)                  | 集群扩容                                                     | m=85, t=1800                               | 严重                 | 是           | 否           |              |
| 集群CPU使用率持续高于阈值                      | CPU使用率 >= m，持续时间t秒(300<=t<=2592000)                 | 集群扩容                                                     | m=85, t=1800                               | 严重                 | 是           | 是           |              |
| 集群CPU使用率平均值高于阈值                    | t秒内CPU使用率平均值>= m(300<=t<=2592000)                    | 集群扩容                                                     | m=85, t=1800                               | 严重                 | 是           | 否           |              |
| 各队列中可用的CPU核数持续低于阈值              | 任意队列中可用CPU核数 <= m，持续时间t秒(300<=t<=2592000)     | 给队列分配更多资源                                           | m=1, t=1800                                | 一般                 | 是           | 否           |              |
| 各队列中可用的内存持续低于阈值                 | 任意队列中可用内存 <= m，持续时间t秒(300<=t<=2592000)        | 给队列分配更多资源                                           | m=1024, t=1800                             | 一般                 | 是           | 否           |              |
| ResourceManager 发生主备切换                   | ResourceManager发生了主备切换                                | 检查RM进程状态，查看standby RM日志查看主备切换原因           | -                                          | 严重                 | 是           | 是           |              |
| ResourceManager 发生full GC                    | ResourceManager发生了full GC                                 | 参数调优                                                     | -                                          | 严重                 | 是           | 是           |              |
| ResourceManager JVM内存使用率持续高于阈值      | RM JVM内存使用率持续 >= m，持续时间t秒(300<=t<=2592000)      | 调整ResourceManager堆内存大小                                | m=85, t=1800                               | 严重                 | 是           | 是           |              |
| NodeManager 发生full GC                        | NodeManager 发生full GC                                      | 参数调优                                                     | -                                          | 一般                 | 是           | 否           |              |
| NodeManager可用的内存持续低于阈值              | 单个NM 可用内存持续 <= m，持续时间t秒(300<=t<=2592000)       | 调整NodeManager堆内存大小                                    | m=1, t=1800                                | 一般                 | 是           | 否           |              |
| NodeManager JVM内存使用率持续高于阈值          | NM JVM内存使用率持续 >= m，持续时间t秒(300<=t<=2592000)      | 调整NodeManager堆内存大小                                    | m=85, t=1800                               | 一般                 | 是           | 否           |              |
| **HBase**                                      | 集群处于RIT Region个数持续高于阈值                           | 集群处于RIT Region个数>=m，持续时间t秒(300<=t<=2592000)      | HBase2.0版本以下，hbase hbck -fixAssigment | m=1, t=60            | 严重         | 是           | 是           |
| 集群dead RS数量持续高于阈值                    | 集群dead RegionServer数量>=m，持续时间t秒(300<=t<=2592000)   | 人工排查                                                     | m=1, t=300                                 | 一般                 | 是           | 是           |              |
| 集群每个RS平均REGION数持续高于阈值             | 集群每个RegionServer平均REGION数>=m，持续时间t秒(300<=t<=2592000) | 节点扩容或升配                                               | m=300, t=1800                              | 一般                 | 是           | 是           |              |
| HMaster 发生full GC                            | HMaster 发生了full GC                                        | 参数调优                                                     | m=5, t=300                                 | 一般                 | 是           | 是           |              |
| HMaster JVM内存使用率持续高于阈值              | HMaster JVM内存使用率>=m，持续时间t秒(300<=t<=2592000)       | 调整HMaster堆内存大小                                        | m=85, t=1800                               | 严重                 | 是           | 是           |              |
| HMaster 当前连接数持续高于阈值                 | HMaster 当前连接数>=m，持续时间t秒(300<=t<=2592000)          | 人工排查                                                     | m=1000, t=1800                             | 一般                 | 是           | 否           |              |
| RegionServer 发生full GC                       | RegionServer 发生full GC                                     | 参数调优                                                     | m=5, t=300                                 | 严重                 | 是           | 否           |              |
| RegionServer JVM内存使用率持续高于阈值         | RegionServer JVM内存使用率>=m，持续时间t秒(300<=t<=2592000)  | 调整RegionServer堆内存大小                                   | m=85, t=1800                               | 一般                 | 是           | 否           |              |
| RegionServer 当前RPC连接数持续高于阈值         | RegionServer 当前RPC连接数>=m，持续时间t秒(300<=t<=2592000)  | 人工排查                                                     | m=1000, t=1800                             | 一般                 | 是           | 否           |              |
| RegionServer Storefile个数持续高于阈值         | RegionServer Storefile个数>=m，持续时间t秒(300<=t<=2592000)  | 建议执行major compaction                                     | m=50000, t=1800                            | 一般                 | 是           | 否           |              |
| HBaseThrift 发生full GC                        | HBaseThrift 发生full GC                                      | 参数调优                                                     | m=5, t=300                                 | 严重                 | 是           | 否           |              |
| HBaseThrift JVM内存使用率持续高于阈值          | HBaseThrift JVM内存使用率>=m，持续时间t秒(300<=t<=2592000)   | 调整HBaseThrift堆内存大小                                    | m=85, t=1800                               | 一般                 | 是           | 否           |              |
| **Hive**                                       | HiveServer2 发生full GC                                      | HiveServer2 发生full GC                                      | 参数调优                                   | m=5, t=300           | 严重         | 是           | 是           |
| HiveServer2 JVM内存使用率持续高于阈值          | HiveServer2 JVM内存使用率>=m，持续时间t秒(300<=t<=2592000)   | 调整HiveServer2堆内存大小                                    | m=85, t=1800                               | 严重                 | 是           | 是           |              |
| HiveMetaStore 发生full GC                      | HiveMetaStore 发生full GC                                    | 参数调优                                                     | m=5, t=300                                 | 一般                 | 是           | 是           |              |
| HiveWebHcat 发生full GC                        | HiveWebHcat 发生full GC                                      | 参数调优                                                     | m=5, t=300                                 | 一般                 | 是           | 是           |              |
| **Zookeeper**                                  | Zookeeper连接数持续高于阈值                                  | Zookeeper连接数>=m，持续时间t秒(300<=t<=2592000)             | 人工排查                                   | m=65535, t=1800      | 一般         | 是           | 否           |
| ZNode节点数量持续高于阈值                      | ZNode节点数>=m，持续时间t秒(300<=t<=2592000)                 | 人工排查                                                     | m=2000, t=1800                             | 一般                 | 是           | 否           |              |

 
