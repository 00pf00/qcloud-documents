## 接口描述
本接口支持使用者通过HTTP POST方式上传一段音频并在极短时间内（一般来说，30分钟的音频可以在10秒内完成识别）同步获取识别结果，满足>音视频字幕、准实时质检等场景下对语音文件识别时效性要求。
在使用该接口前，需要在语音识别控制台开通服务，并进入 [API 密钥管理页面](https://console.cloud.tencent.com/cam/capi) 新建密钥，生
成 AppID、SecretID 和 SecretKey，用于 API 调用时生成签名，签名将用来进行接口鉴权。

## 接口要求

| 内容 | 说明 |
| --- | --- |
| 支持语言| 中文普通话 |
| 音频格式| wav、pcm、ogg-opus、speex、silk、mp3、m4a、aac |
| 使用限制| 支持100MB以内音频文件的识别 |
| 请求协议| HTTP |
| 请求地址|  http://asr.cloud.tencent.com/asr/flash/v1/<appid\>?{请求参数} |
| 接口鉴权| 签名鉴权机制，详见 [签名生成](#sign) |
| 响应格式| 统一采用 JSON 格式 |
| 开发语言| 任意，只要可以向腾讯云服务发起 HTTP 请求的均可 |

## 请求结构
请求结构主要由**请求方法、请求 URL、请求头部、请求Body**组成。
### 请求方法
HTTPS 请求方法，录音文件识别的请求方法为 **POST**。
### 请求 URL

```
https://asr.cloud.tencent.com/asr/flash/v1/<appid>?
convert_num_mode=1&
engine_type=xxx&
filter_dirty=0&
filter_modal=0&
filter_punc=0&
first_channel_only=1&
hotword_id=xxx&
secretid=xxx&
speaker_diarization=0&
timestamp=xxx&
voice_format=xxx&
word_info=0&

```
URL 中各字段含义如下：  

| 参数名称 | 必选 | 类型 | 描述 |  
| --- | --- | --- | --- |
| AppId |  是 | Integer | 用户在腾讯云注册账号的 AppId，可以进入[ API 密钥管理页面 ](https://console.cloud.tencent.com/cam/capi)获取 |
| secretid | 是 | String | 用户在腾讯云注册账号 AppId 对应的 SecretId，可以进入 [ API 密钥管理页面 ](https://console.cloud.tencent.com/cam/capi)获取 |
| engine_type | 是 | String | 引擎模型类型。<br>8k_zh：8k 中文普通话通用。<br>16k_zh：16k 中文普通话通用 |
| voice_format | 是 | String | 音频格式。支持wav、pcm、ogg-opus、speex、silk、mp3、m4a、aac |
| timestamp | 是 | Integer | 当前UNIX时间戳，如果与当前时间相差超过3分钟，会报签名失败错误 |
| speaker_diarization | 否 | Integer | 是否开启说话人分离（目前支持中文普通话引擎），默认为0，0：不开启，1：开启 |
| filter_dirty | 否 | Integer | 是否过滤脏词（目前支持中文普通话引擎），默认为0。0：不过滤脏词；1：过滤脏词；2：将脏词替换为 * |
| filter_modal | 否 | Integer | 是否过滤语气词（目前支持中文普通话引擎），默认为0。0：不过滤语气词；1：部分过滤；2：严格过滤  |
| filter_punc | 否 | Integer | 是否过滤标点符号（目前支持中文普通话引擎），默认为0。0：不过滤，1：过滤句末标点，2：过滤所有标点 |
| convert_num_mode | 否 | Integer | 是否进行阿拉伯数字智能转换，默认为1。0：全部转为中文数字；1：根据场景智能转换为阿拉伯数字。|
| word_info | 否 | Integer | 是否显示词级别时间戳，默认为0。0：不显示；1：显示，不包含标点时间戳，2：显示，包含标点时间戳|
| first_channel_only | 否 | Integer | 是否只识别首个声道，默认为1。0：识别所有声道；1：识别首个声道 |

### 请求头部
请求头部，包括 Host，Authorization，Content-Type，Content-Length 四个参数。  

| 参数名称 | 必选 | 类型 | 描述 |  
| --- | --- | --- | --- |
| Host |  是 | String | 语音识别服务域名，固定为 asr.cloud.tencent.com |
| Authorization | 是 | String | 用户的有效签名，用于鉴权。对应签名鉴权中得到的签名字符串 |
| Content-Type | 是 | String | application/octet-stream|
| Content-Length | 是 | Int | 请求长度，此处对应语音数据字节数，单位：字节|

### 请求Body
请求Body包含音频数据，最大长度为100MB

### 代码示例
请参考： 
- [python示例](https://github.com/TencentCloud/tencentcloud-speech-sdk-python/blob/master/examples/asr/asrexample.py) 
- [golang示例](https://github.com/TencentCloud/tencentcloud-speech-sdk-go/blob/master/examples/asrexample/flashexample.go) 

### 请求示例
用户通过 [签名生成](#sign) 的签名为 qPHg2LZkMRZyC5py******，上传语音数据 @/data/test.wav，请求录音识别极速版服务，结果返回方式为同步返回。
```
curl --data "@/data/test.wav" -H "Authorization:qPHg2LZkMRZyC5py******" -X POST "https://asr.cloud.tencent.com/asr/flash/v1/1259228442?convert_num_mode=1&engine_type=16k_zh&filter_dirty=0&filter_modal=0&filter_punc=0&first_channel_only=1&hotword_id=&secretid=AKIDoQq1zhZMN8dv0psmvud6OUKuGPO*****&speaker_diarization=0&timestamp=1609502112&voice_format=wav&word_info=0"
```

### 签名生成
这里以 Appid=1259228442, SecretId=AKIDoQq1zhZMN8dv0psmvud6OUKuGPO***** 为例拼接签名原文，则拼接的签名原文为：

```
POSTasr.cloud.tencent.com/asr/flash/v1/1259228442?convert_num_mode=1&engine_type=16k_zh&filter_dirty=0&filter_modal=0&filter_punc=0&first_channel_only=1&hotword_id=&secretid=AKIDoQq1zhZMN8dv0psmvud6OUKuGPO*****&speaker_diarization=0&timestamp=1609502112&voice_format=wav&word_info=0
```
对签名原文和 SecretKey=kFpwoX5RYQ2SkqpeHgqmS******,使用 **HmacSha1** 算法进行加密处理：

```
签名串=Base64Encode(HmacSha1(签名原文,SecretKey))
```

## 返回结构

发送请求后，会收到服务端的响应，识别结果以JSON字符串的形式返回。

| 参数 | 类型 |  描述 |  
| --- | --- |--- |
| code | Integer | 0：正常，其他，发生错误 |
| message | String | code非0时，message中会有错误消息 |
| request_id | String | 请求唯一标识，请您记录该值，以便排查错误 |
| audio_duration | Integer | 音频时长，单位为毫秒 |
| flash_result | []Result | 声道识别结果列表 |

Result结构为：
| 参数 | 类型 |  描述 |  
| --- | --- |--- |
| channel_id | Integer | 声道标识，从0开始，对应音频声道数 |
| text | String | 声道音频完整识别结果 |
| sentence_list | []Sentence | 句子/段落级别的识别结果列表 |

Sentence结构为：
| 参数 | 类型 |  描述 |  
| --- | --- |--- |
| text | String | 句子/段落级别文本 |
| start_time | Integer | 开始时间 |
| end_time | Integer | 结束时间 |
| speaker_id | Integer | 说话人Id（请求中如果设置了speaker_diarization，可以按照speaker_id来区分说话人） |
| word_list | []Word | 词级别的识别结果列表 |

Word结构为：
| 参数 | 类型 |  描述 |  
| --- | --- |--- |
| word | String | 词级别文本 |
| start_time | Integer | 开始时间 |
| end_time | Integer | 结束时间 |

### 返回示例

```
{
    "request_id":"5fef0ff60a0f0c5bcec31bb0",
    "code":0,
    "message":"",
    "audio_duration":4060,
    "flash_result":[
        {
            "text":"北京科技馆。",
            "channel_id":0,
            "sentence_list":[
                {
                    "text":"北京科技馆。",
                    "start_time":1040,
                    "end_time":3100,
                    "speaker_id":0
                }
            ]
        }
    ]
}

```

## 错误码

| 数值 |  说明 |  
| --- | --- |
| 1001 | 参数不合法，具体详情参考 message |
| 1002 | 音频数据太大 |
| 1003 | 音频数据为空 |
| 1004 | 请求并发超限 |
| 1005 | 音频时长超限 |
| 1006 | 音频解码失败 |
| 1007 | 服务未开通，请在控制台开通服务 |
| 1008 | 账户欠费停止服务，请及时充值 |
| 1009 | 签名校验失败/鉴权失败 |
| 2001 | 后端服务资源不足 |
| 2002 | 音频识别失败，偶现可以忽略，重复出现请提交工单 |
| 2003 | 音频识别超时，偶现可以忽略，重复出现请提交工单 |
