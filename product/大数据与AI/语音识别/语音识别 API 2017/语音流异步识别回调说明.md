## 1. 回调说明

语音流异步识别通过回调的方式来返回识别结果，用户需要自行搭建可公网访问的HTTP或者HTTPS服务，并在创建识别任务时，将回调Url填写到CallbackUrl中。
回调时，所有内容会放入Body中。

## 2. 回调参数说明

| 参数 | 类型 |  描述 |  
| --- | --- |--- |
| checksum | String | 返回结果签名(由用户appid+SignToken+data拼接成字符串，通过SHA256算法生成)，有需求的用户可用来签名校验。详见 [签名生成](#sign) |
| data | String | 识别结果信息，String里放的是JSON结构 |

data中的JSON结构为：

| 参数 | 类型 |  描述 |  
| --- | --- |--- |
| TaskId | Integer | 语音流异步识别任务的唯一标识，在创建任务时会返回 |
| Result | []Sentence | 句子/段落级别的识别结果列表 |

Sentence结构为：
| 参数 | 类型 |  描述 |  
| --- | --- |--- |
| Text | String | 句子/段落级别文本 |
| StartTime | Integer | 开始时间 |
| EndTime | Integer | 结束时间 |
| VoiceId | String | 该次识别结果的唯一标识 |
| WordList | []Word | 词级别的识别结果列表 |

Word结构为：
| 参数 | 类型 |  描述 |  
| --- | --- |--- |
| Word | String | 词级别文本 |
| StartTime | Integer | 开始时间 |
| EndTime | Integer | 结束时间 |


<span id="sign"></span>
## 3. 签名生成说明

1. 对所有参数按字典序进行排序，拼接 POST串 + 请求URL 作为签名原文，这里以 Appid=1259228442, SecretId=AKIDoQq1zhZMN8dv0psmvud6OUKuGPO7pu0r 为例拼接签名原文，如下：


```
POSTasr.cloud.tencent.com/asr/flash/v1/1259228442?convert_num_mode=1&engine_type=16k_zh&filter_dirty=0&filter_modal=0&filter_punc=0&first_channel_only=1&hotword_id=&secretid=AKIDoQq1zhZMN8dv0psmvud6OUKuGPO7pu0r&speaker_diarization=0&timestamp=1609560089&voice_format=wav&word_info=0

```

2. 对签名原文使用 SecretKey 进行 HmacSha1 加密，之后再进行 base64 编码。例如对上一步的签名原文， SecretKey=kFpwoX5RYQ2SkqpeHgqmSzHK7h3A2fni，使用 HmacSha1 算法进行加密并做 base64 编码处理：


```
Base64Encode(HmacSha1("POSTasr.cloud.tencent.com/asr/flash/v1/1259228442?convert_num_mode=1&engine_type=16k_zh&filter_dirty=0&filter_modal=0&filter_punc=0&first_channel_only=1&hotword_id=&secretid=AKIDoQq1zhZMN8dv0psmvud6OUKuGPO7pu0r&speaker_diarization=0&timestamp=1609560089&voice_format=wav&word_info=0", "kFpwoX5RYQ2SkqpeHgqmSzHK7h3A2fni"))
```

得到 signature 签名值为：

```
R53FKwXyJujLC+W2rqJijhmS1a4=
```

### 3.6 请求示例

用户通过 [签名生成](#sign) 的签名为 HepdTRX6u155qIPKNKC+3U0j1N0=，语音数据路径为/data/test.wav，请求录音识别极速版服务，这里以curl请求为例来说明。
```
curl --data "@/data/test.wav" -H "Authorization:R53FKwXyJujLC+W2rqJijhmS1a4=" -X POST "https://asr.cloud.tencent.com/asr/flash/v1/1259228442?convert_num_mode=1&engine_type=16k_zh&filter_dirty=0&filter_modal=0&filter_punc=0&first_channel_only=1&hotword_id=&secretid=AKIDoQq1zhZMN8dv0psmvud6OUKuGPO7pu0r&speaker_diarization=0&timestamp=1609560089&voice_format=wav&word_info=0"

```

## 4. 返回Body示例

```
checksum=c634a0daf4b061602b7056d3532b6d96d9396350c1f78472555b614ebb4aaf7d&data={\"TaskId\": 1000000007,\"Result\":[{\"VoiceId\":\"1000000007_5fa008e4934a1054925507b0_15_770\",\"Text\":\"你 好。\",\"StartTime\":0,\"EndTime\":307860,\"WordList\":[]}]}

```
