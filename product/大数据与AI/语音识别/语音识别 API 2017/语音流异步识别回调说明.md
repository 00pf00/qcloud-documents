## 1. 回调说明

语音流异步识别通过回调的方式来返回识别结果，用户需要自行搭建可公网访问的HTTP或者HTTPS服务，并在创建识别任务时，将回调Url填写到CallbackUrl中。
回调时，所有内容会放入Body中。

## 2. 回调参数说明

| 参数 | 类型 |  描述 |  
| --- | --- |--- |
| checksum | String | 返回结果的签名，如果创建任务时没有传入SignToken字段，则checksum为空。详见 [签名生成](#sign) |
| data | String | 识别结果信息，String里放的是JSON结构 |

data中的JSON结构为：

| 参数 | 类型 |  描述 |  
| --- | --- |--- |
| TaskId | Integer | 语音流异步识别任务的唯一标识，在创建任务时会返回 |
| Result | []Sentence | 句子/段落级别的识别结果列表 |

Sentence结构为：
| 参数 | 类型 |  描述 |  
| --- | --- |--- |
| Text | String | 句子/段落级别文本 |
| StartTime | Integer | 开始时间 |
| EndTime | Integer | 结束时间 |
| VoiceId | String | 该次识别结果的唯一标识 |
| WordList | []Word | 词级别的识别结果列表 |

Word结构为：
| 参数 | 类型 |  描述 |  
| --- | --- |--- |
| Word | String | 词级别文本 |
| StartTime | Integer | 开始时间 |
| EndTime | Integer | 结束时间 |


<span id="sign"></span>
## 3. 签名生成

如果用户创建任务时，如果传入了SignToken字段，则回调时会生成一个签名放入checksum字段中，用来做签名校验。

下面说明签名的生成过程，用户可参考进行签名校验。

1. 签名原文生成：

签名原文由用户的 AppID + SignToken + 回调中data字段内容 拼接组成，这里以 Appid=1259228442, SignToken=ewef32ee 为例拼接签名原文，如下：

```
1259228442ewef32ee{"TaskId":100000447,"Result":[{"VoiceId":"1000004470_5ff02063dac60f47a62343b0_1_0_46","Text":"测试","StartTime":17140,"EndTime":17940,"WordList":[]}]}

```

2. 对签名原文通过SHA256算法计算，生成最终签名，以python为例

```
import hashlib

sign = hashlib.sha256('1259228442ewef32ee{"TaskId":100000447,"Result":[{"VoiceId":"1000004470_5ff02063dac60f47a62343b0_1_0_46","Text":"测试","StartTime":17140,"EndTime":17940,"WordList":[]}]}').hexdigest()

print(sign)

```

得到签名值为：

```
550e661c30ceb8fbfc6babb88e7e78aaeae5f908077a2446528023d3e3491f1d

```

## 4. 返回Body示例

```
checksum=550e661c30ceb8fbfc6babb88e7e78aaeae5f908077a2446528023d3e3491f1d&data={"TaskId":100000447,"Result":[{"VoiceId":"1000004470_5ff02063dac60f47a62343b0_1_0_46","Text":"测试","StartTime":17140,"EndTime":17940,"WordList":[]}]}

```

## 5. 常见问题

- 回调周期一般是多久？
  - 如果音频流中存在人声，一般3-15秒内会返回该时间段内的语音识别内容

- 过了很久都没有收到回调怎么办？
  - 请确认音频流是否存在，如果存在，请确认是否有数据
  - 请确认音频流是否一直没有人声出现
  
