本文为您介绍腾讯云 ES 集群运行日志的使用说明。用户可以通过集群的运行日志，了解集群的运行状况，定位问题，辅助集群的应用开发和运维。

## 查看集群日志

登录 [ES 控制台](https://console.cloud.tencent.com/es)，在集群详情页的【集群日志】页面，可查看集群的运行日志。

缺图后续补充

共有四种类型的日志：主日志、查询/写入慢日志和GC日志，日志内容包括日志时间、日志级别，以及具体信息等。腾讯云 ES 默认提供集群7天内的运行日志，按时间倒序展示，用户可以按时间和关键字进行查询。此外，用户也可以调用 ES api 调整日志相关配置，如：对于慢日志，设定查询或索引数据时，认为响应较慢的时间阈值。

### 日志说明
#### 1、主日志
展示了集群运行产生的日志，有不同级别：INFO、WARN、DEBUG 等。

```
2019-2-14 08:00:00 10.0****	INFO	[o.e.c.r.a.AllocationService] [1550199698000783811] Cluster health status changed from [YELLOW] to [GREEN] (reason: [shards started [[filebeat-2019.02.19][2]] ...]).

2019-2-14 02:30:02 10.0****	DEBUG	[o.e.a.a.i.d.TransportDeleteIndexAction] [1550199698000783811] failed to delete indices [[[filebeat-2019.02.09/7VZM6Fa-Twmj8pVaAyyrxg]]]
org.elasticsearch.index.IndexNotFoundException: no such index
	at org.elasticsearch.cluster.metadata.MetaData.getIndexSafe(MetaData.java:475) ~[elasticsearch-5.6.4.jar:5.6.4]
	at org.elasticsearch.cluster.metadata.MetaDataDeleteIndexService.lambda$deleteIndices$0(MetaDataDeleteIndexService.jav
```

#### 2、查询、写入慢日志
慢日志的目的是捕获超过指定时间阈值的查询和索引请求，用于追踪分析由用户产生的很慢的请求。

```
2018-10-28 12:04:17 WARN [index.indexing.slowlog.index] [1540298502000001009] [pmc/wCALr6BfRm-sr3qOQuGX
Xw] took[18.6ms], took_millis[18], type[articles], id[AWa41-J9c0s1mOPvR6F3], routing[] , source[]
```

**慢日志开启和调整**
默认情况，慢日志是不开启的。要开启它，需要定义具体动作（query，fetch 还是 index），以及期望的事件记录等级（INFO、WARN 、 DEBUG 等），时间阈值。用户可以根据业务场景，开启和调整相关配置。
操作方法，在 集群 Kibana 页面，Dev Tools 调用 Elasticsearch 相关 api，或者通过客户端，调用配置修改 api。

```
PUT */_settings
{
"index.indexing.slowlog.threshold.index.debug" : "5ms",
"index.indexing.slowlog.threshold.index.info" : "50ms",
"index.indexing.slowlog.threshold.index.warn" : "100ms",
"index.search.slowlog.threshold.fetch.debug" : "10ms",
"index.search.slowlog.threshold.fetch.info" : "50ms",
"index.search.slowlog.threshold.fetch.warn" : "100ms",
"index.search.slowlog.threshold.query.debug" : "100ms",
"index.search.slowlog.threshold.query.info" : "200ms",
"index.search.slowlog.threshold.query.warn" : "1s"
}
```

这是一个索引级别的设置，也可以对单个索引进行设置：

```
PUT /my_index/_settings
{
"index.indexing.slowlog.threshold.index.debug" : "5ms",
"index.indexing.slowlog.threshold.index.info" : "50ms",
"index.indexing.slowlog.threshold.index.warn" : "100ms",
"index.search.slowlog.threshold.fetch.debug" : "10ms",
"index.search.slowlog.threshold.fetch.info" : "50ms",
"index.search.slowlog.threshold.fetch.warn" : "100ms",
"index.search.slowlog.threshold.query.debug" : "100ms",
"index.search.slowlog.threshold.query.info" : "200ms",
"index.search.slowlog.threshold.query.warn" : "1s"
}
```

#### 3、GC日志
ES 默认开启 GC 日志，以下两条具体的 GC 日志，分别是日志时间、节点 ip、日志级别。

```
2019-2-14 20:48:22	10.0.***	INFO	[o.e.m.j.JvmGcMonitorService] [1550199698000783711] [gc][380573] overhead, spent [307ms] collecting in the last [1s]
2019-2-14 10:04:09	10.0.***	WARN	[o.e.m.j.JvmGcMonitorService] [1550199698000784111] [gc][341943] overhead, spent [561ms] collecting in the last [1s]
```

### 查询日志
用户可以按照时间范围和关键字查询相关日志，关键字查询语法同 lucene 查询语法一致。
输入关键词查询，如：“YELLOW”；或指定字段设置关键词，如：“message:YELLOW”；或者是多个条件组合：“level:INFO and ip:10.0.1.1”，可以查询相关日志。

