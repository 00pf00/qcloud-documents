# 白板 2.0 接入文档-Android

## 1. SDK文件结构
1. 提供aar库文件。
2. sdk接口说明。
3. sdk接入文档

## 2. SDK 快速集成

### 2.1 导入SDK到项目
在 `Android Studio` 开发环境下，按如下步骤导入 SDK：
1. 在新建**app/libs**目录，如果已有libs目录，则不用新建；
2. 将TEduBoard sdk库TEduBoardSdk-release.aar，放在libs目录下；
3. 在app目录下的build.gradle文件中添加以下代码：

```java
android { 
	repositories { 
		flatDir { 
		dirs  'libs' 
		} 
	} 
}
//加入库依赖
dependencies { 
	compile(name: 'TEduBoardSdk-release', ext: 'aar') 
}
```
说明：Board SDK的manifest中设置minSdkVersion 17 (Android 4.2)，所以建议您的App中对Android机器要求是>=17，否则在编译中会报"Manifest merger failed with multiple errors, see logs";




### 2.2 白板窗口管理
#### 2.2.1 白板控制器创建及初始化
1. 白板实例在TICManager中创建和销毁；
2. 在要使用白板的Activity onCreate函数中，获取TEduBoardController对象，同时注册白板的回调；
```java
// 1、在具体使用的Activity onCreate()函数中，获取白板的对象并初始化。
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_class_ex);
	
	//初始化其它内容，如Trtc、IM
	...
	
	//1.初始白板
        initTEduBoard();
    }
    
    private void initTEduBoard() {  
        //获取白板对象
        mBoard = mTicManager.getBoard();  

        //生成一个继承于TEduBoardController.TEduBoardCallback事件监听，交给白板对象，用于处理白板事件响应。
        mBoardCallback = new MyBoardCallback(this);  
        mBoard.addCallback(mBoardCallback);  
        
        //初始化具体的参数，包含用户信息、appid，sig值；
        TEduBoardController.TEduBoardAuthParam authParam = new TEduBoardController.TEduBoardAuthParam(Constants.APPID, mUserID, mUserSig);  
        
        //如果用户希望白板显示出来时，不使用系统默认的参数，需要设置特性缺省参数，如是使用默认参数，则填null。
        TEduBoardController.TEduBoardInitParam initParam = new         TEduBoardController.TEduBoardInitParam();  
        
  initParam.brushColor = new TEduBoardController.TEduBoardColor(0, 255, 0, 255);  
		//调用初始化函数
        mBoard.init(authParam, mRoomId, initParam);  
    }

```

3、获取白板View并显示出来。方法是在白板初始化成功后， `onTEBInit` 回调方法内获取白板view加入显示视图中：
```java
//1、在Activity的布局xml文件中，用FrameLayout占个位，将来放board的View。
<FrameLayout  
  android:id="@+id/board_view_container"  
  android:layout_width="match_parent"  
  android:layout_height="200dp"/>
  
//2、获取View，并将其加入到View视频中。 
@Override
public void onTEBInit() {
    TICClassMainActivity activity = mActivityRef.get();
    if (activity != null) {
        activity.addBoardView();
    }
}
	
void addBoardView() {
    mBoardContainer = (FrameLayout) findViewById(R.id.board_view_container);
    View boardview = mBoard.getBoardRenderView();
    FrameLayout.LayoutParams layoutParams = new FrameLayout.LayoutParams(FrameLayout.LayoutParams.MATCH_PARENT, FrameLayout.LayoutParams.MATCH_PARENT);
        mBoardContainer.addView(boardview, layoutParams);
    }
    
    FrameLayout container = findViewById(R.id.board_view_container);  
    View boardview = mBoard.getBoardRenderView();  
    if (boardview != null) {
        container.addView(boardview);
    }

```

4、在onDestroy函数删除Board的回调和从视图中去掉BoardView;
 ```java
@Override  
protected void onDestroy() {  
	super.onDestroy();  
	unitTEduBoard();
}

private void unitTEduBoard() {
    if (mBoard != null) {
        //删除加入的boardview
        View boardview = mBoard.getBoardRenderView();
        if (mBoardContainer != null && boardview != null) {
            mBoardContainer.removeView(boardview);
        }
	
        //删除回调
        mBoard.removeCallback(mBoardCallback);
    }
}
```


### 2.3 涂鸦操作
#### 2.3.1 启用禁用涂鸦
白板窗口显示出来后，默认情况下用户可以在白板窗口上进行涂鸦操作，您可以通过以下接口禁用或再次启用涂鸦操作：
```cpp
// 判断当前是否允许涂鸦
mBoard.setDrawEnable(true); //如果不调用此函数，白板内部默认可以进行涂押；
```
#### 2.3.2 选择涂鸦工具
白板目前支持以下几种涂鸦工具：

| 工具类型 | 对应枚举值 |
| ------  |-------|
| 鼠标 | TEDU_BOARD_TOOL_TYPE_MOUSE |
| 画笔 | TEDU_BOARD_TOOL_TYPE_PEN |
| 橡皮擦| TEDU_BOARD_TOOL_TYPE_ERASER |
| 激光笔 | TEDU_BOARD_TOOL_TYPE_LASER |
| 直线 | TEDU_BOARD_TOOL_TYPE_LINE |
| 空心椭圆 | TEDU_BOARD_TOOL_TYPE_OVAL |
| 空心矩形 | TEDU_BOARD_TOOL_TYPE_RECT |
| 实心椭圆 | TEDU_BOARD_TOOL_TYPE_OVAL_SOLID |
| 实心矩形 | TEDU_BOARD_TOOL_TYPE_RECT_SOLID |
| 点选工具 | TEDU_BOARD_TOOL_TYPE_POINT_SELECT |
| 框选工具 | TEDU_BOARD_TOOL_TYPE_RECT_SELECT |
| 文本工具 | TEDU_BOARD_TOOL_TYPE_TEXT |
| 缩放和移动 | TEDU_BOARD_TOOL_TYPE_ZOOM_DRAG |

您可以通过以下接口选择涂鸦工具：
```java
	// 选择选框工具
	mBoard.setToolType(TEDU_BOARD_TOOL_TYPE_SELECT);
```
#### 2.3.3 设置涂鸦属性
目前受支持的涂鸦属性有以下几种：

| 属性说明 | 对应获取接口| 对应设置接口 |
| ---- | ---- | ---- |
| 创建白板时使用的默认背景色 | getDefaultBackgroundColor | setDefaultBackgroundColor |
| 白板当前使用的背景色 | getBackgroundColor | setBackgroundColor |
| 用于所有涂鸦绘制的画笔颜色 | getBrushColor | setBrushColor |
| 用于所有涂鸦绘制的画笔粗细 | getBrushThin | setBrushThin |
| 文本颜色 | getTextColor | setTextColor |
| 文本大小 | getTextSize | setTextSize |
| 文本样式 | getTextStyle | setTextStyle|
| 文本字体 | getTextFamily | setTextFamily |
| 设置白板是否开启数据同步 | isDataSyncEnable | setDataSyncEnable|
| 白板当前使用的背景图片 | 无 | setBackgroundImage |
| 设置网页为背景 | 无 | setBackgroundH5|
| 设置当前白板页宽高比 | getBoardRatio | setBoardRatio|
| 设置当前白板页缩放比例 | getBoardScale | setBoardScale|
| 设置白板内容自适应模式 | getBoardContentFitMode | setBoardContentFitMode|

每个接口的详细使用说明参见 [白板2.0接口参考文档]()。

#### 2.3.4 清除涂鸦
您可以调用以下接口清除当前白板页涂鸦，通过参数可以指定是否同时清除背景图片：
```java
// 清除当前白板页的涂鸦（同时清除背景图片）
mBoard.clear(true);
```

#### 2.3.5 撤销重做
您可以调用白板控制器的 `undo` 和 `redo` 接口进行涂鸦的撤销和重做操作，同时可以通过 `onTEBUndoStatusChanged` 和 `onTEBRedoStatusChanged` 这两个回调接口拿到当前是否还可以继续撤销或重做的信息。
```java
mBoard.undo(); //撤销
mBoard.redo(); //重做
```
### 2.4 白板操作

| 方法说明 | 对应接口| 对应回调| 
| ---- | ---- | ---- | 
| 增加一页白板 | addBoard| onTEBAddBoard | 
| 删除一页白板 | deleteBoard| onTEBDeleteBoard | 
| 跳转到指定白板页 | gotoBoard |  onTEBGotoBoard | 
| 获取当前白板页ID | getCurrentBoard |  无 | 
| 获取所有文件的白板列表 | getBoardList|  无 | 
| 上一步 | prevStep| 无| 
| 下一步 | nextStep|无| 
| 向前翻页 | prevBoard|  无 | 
| 向后翻页 | nextBoard | 无 | 


#### 2.4.1 白板管理
- 每个白板页(想象成一个PPT页面)由全局唯一的白板ID标识，若需要获取当前白板页的白板ID，您可以调用白板控制器的 `getCurrentBoard`接口。
- 此外您可以调用白板控制器的 `getBoardList` 接口获取所有白板ID列表。
- 您也可以调用白板控制器的 `addBoard` 接口添加白板，`DeleteBoard` 接口删除白板。
```java
String boardid = mBoard.getCurrentBoard(); //获取当前白板页的id。
List<String> boardids = mBoard.getBoardList(); //获取所有文件的白板页id;
List<String> boardids = mBoard.getFileBoardList(fileId); // 获取指定文件的白板ID列表;
```

#### 2.4.2 翻页操作
```java
mBoard.prevBoard(); //白板向前翻页。
mBoard.nextBoard(); //白板向后翻页;
```

### 2.5 文件操作
| 方法说明 | 对应接口|对应回调|
| ---- | ---- | ---- | 
| 增加文件 | addFile| onTEBAddFile| 
| 增加H5文件 | addH5PPTFile| onTEBAddH5PPTFile| 
| 删除文件 | deleteFile| onTEBDeleteFile| 
| 切换文件 | switchFile| onTEBSwitchFile| 
| 获取当前文件ID | getCurrentFile|
| 获取白板中上传的所有文件的文件信息列表 | getFileInfoList|  
| 获取指定文件的白板ID列表 | getFileBoardList|
| 清空指定文件的所有白板涂鸦 | clearFileDraws| 


#### 2.5.1 文件管理
- 每个文件(想象成一个PPT文件)由全局唯一的文件ID标识，若需要获取当前白板所属的文件ID，您可以调用白板控制器的 `GetCurrentFile` 接口。
- 一个文件对应一个或多个白板页，每个白板页对应文件中的一个页面，您可以调用白板控制器的 `GetFileBoardList` 接口获取文件对应的白板ID列表。
 ```java
String fileId = mBoard.getCurrentFile(); //获取当前的文件。
List<TEduBoardFileInfo> filelist = mBoard.getFileInfoList(); //获取所有打开的文件;
```

#### 2.5.2 文件切换
可以通过AddFile将一个本地的文件上传到后台，然后在Board中显示出来。参考下面的实例：
 ```java
mBoard.addFile(path); //将一个文件加入到白板中。
mBoard.addH5PPTFile(url); //将H5 URL文件加入到白板中。
mBoard.deleteFile(fileId); //删除当前的文件;
mBoard.switchFile(fileId); //切换到fileId的文件;
```

### 2.6 使用外部传输通道时的做法指引
TEduBoard SDK在使用过程中，需要在不同的用户之间同步消息(比如，涂鸭消息)。 默认的情况下，使用腾讯云通信SDK(TIM)进行，在初始化BoardSDK时进行指定。
 ```java
//使用腾讯的IM进行消息传递，前提是你的项目中已经集成TIM。
const boolean timSync = true;//
mBoard.init(authParam, mRoomId, timSync); 
```
如果使用自已的通道进行消息传递，则需要按下面步骤进行：

 ```java
//1、将此使用tim同步参数初始置false
TEduBoardController.TEduBoardInitParam initParam = new TEduBoardController.TEduBoardInitParam();  
initParam.timSync = false;
mBoard.init(authParam, mRoomId, initParam); 

//2、TEduBoard SDK有数据要同步给其他用户时，将调用callback接口中的onTEBSyncData()函数
 @Override
 public void onTEBSyncData(String data) {
   //使用自定义的通道，发送data数据给其他白板用户。
 }

//3、在收到其他用户的信息时，将消息传递给TEduBoard SDK.
mBoard.addSyncData(msg);
```
