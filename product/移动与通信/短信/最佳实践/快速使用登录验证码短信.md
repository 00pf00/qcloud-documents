通过手机短信发送验证码，是最普遍、最安全验证用户真实身份的方式。目前，短信验证码广泛应用于用户注册、密码找回、登录保护、身份认证、随机密码、交易确认等应用场景。
本文以用户 B 使用 [云函数（Serverless Cloud Function，SCF）](https://cloud.tencent.com/document/product/583)开发一个短信验证码登录注册服务为例，帮助个人用户了解如何快速发送验证码短信。

## 准备工作
- 已 [注册腾讯云](https://cloud.tencent.com/document/product/378/17985) 账号，并完成 [企业实名认证](https://cloud.tencent.com/document/product/378/10496)。
- 已 [购买](https://cloud.tencent.com/document/product/382/18060) 短信套餐包。
- 准备短信签名归属方资质证明文件，详细的文件清单以及规范请参见 [签名审核标准](https://cloud.tencent.com/document/product/382/39022)。
 本文以使用企业营业执照作为资质证明文件为例。
- 了解短信正文内容审核规范，详情请参见 [正文模板审核标准](https://cloud.tencent.com/document/product/382/39023)。
- 已开通

<span id="Step1"></span>
## 步骤1：创建签名
>?短信签名提交后，我们会在2个小时左右完成审核，您可以 [配置告警联系人](https://cloud.tencent.com/document/product/382/37810) 并设置接收模板和签名审核通知，便于及时接收审核通知。

1. 登录 [短信控制台](https://console.cloud.tencent.com/smsv2)。
2. 在左侧导航栏选择【国内短信】>【签名管理】，单击【创建签名】。
3. 结合实际情况和 [短信签名审核标准](https://cloud.tencent.com/document/product/382/39022) 设置以下参数：
 <table>
     <tr>
         <th width="20%">参数</th>  
         <th>取值样例</th>  
     </tr>
	 <tr>      
       <td>签名用途</td>   
	     <td>自用（签名为本账号实名认证的公司、网站、产品名等）</td>   
     </tr> 
	 <tr>      
       <td>签名类型</td>   
	     <td>APP</td>   
     </tr> 
	 <tr>      
       <td>签名内容</td>   
	     <td>测试 Demo</td>   
     </tr> 
	 <tr>      
       <td>证明类型</td>   
	     <td>小程序设置页面截图</td>   
     </tr> 
	 <tr>      
       <td>证明上传</td>   
	<td><img src="https://main.qcloudimg.com/raw/48ad431a784461465054160737b9b166.png" width=400/></td>    
     </tr> 
</table>
3. 单击【确定】。
 等待签名审核，当状态变为【已通过】时，短信签名才可用。


<span id="Step2"></span>
## 步骤2：创建正文模板
>?短信正文模板提交后，我们会在2个小时左右完成审核，您可以 [配置告警联系人](https://cloud.tencent.com/document/product/382/37810) 并设置接收模板和签名审核通知，便于及时接收审核通知。

1. 登录 [短信控制台](https://console.cloud.tencent.com/smsv2)。
2. 在左侧导航栏选择【国内短信】>【正文模板管理】，单击【创建正文模板】。
3. 结合实际情况和 [短信正文模板审核标准](https://cloud.tencent.com/document/product/382/39023) 设置以下参数：
 <table>
     <tr>
         <th width="20%">参数</th>  
         <th>取值样例</th>  
     </tr>
	 <tr>      
        <td>模板名称</td>   
	     <td>验证码短信</td>   
     </tr> 
	 <tr>      
        <td>短信类型</td>   
	     <td>普通短信</td>   
     </tr> 
	 <tr>      
        <td>短信内容</td>   
	     <td>您的注册验证码：{1}，请于{2}分钟内填写，如非本人操作，请忽略本短信。</td>   
     </tr> 
</table>
4. 单击【确定】。
 等待正文模板审核，当状态变为【已通过】时，正文模板才可用。

<span id="Step3"></span>
## 步骤3：设置短信发送频率限制（可选）
>!个人认证用户不提供修改频率限制的权限。如需使用该功能，请将 “个人认证” 修改为 “企业认证”，具体操作请参见 [设置发送频率限制](https://cloud.tencent.com/document/product/382/37809#.E8.AE.BE.E7.BD.AE.E5.8F.91.E9.80.81.E9.A2.91.E7.8E.87.E9.99.90.E5.88.B6)。

为了保障业务和通道安全，减少业务被刷后的经济损失，短信默认的频率限制策略为：
- 同一号码同一内容30秒内最多发送1条。
- 同一手机号一个自然日最多发送10条。

<span id="Step4"></span>
## 步骤4：配置私有网络和子网
默认情况下，云函数部署在公共网络中，只可以访问公网。如果开发者需要访问腾讯云的 TencentDB 等资源，需要建立私有网络来确保数据安全及连接安全。

1. 按需 [规划网络](https://cloud.tencent.com/document/product/215/30313)。
2. 创建私有网络，具体操作请参见 [创建私有网络](https://cloud.tencent.com/document/product/215/36515#.E5.88.9B.E5.BB.BA.E7.A7.81.E6.9C.89.E7.BD.91.E7.BB.9C)。
 >!私有网络和子网的 CIDR 创建后不可修改。
 >
 <table>
     <tr>
         <th width="20%">参数</th>  
         <th>取值样例</th>  
     </tr>
	 <tr>      
        <td>所属地域</td>   
	     <td>	华南地区(广州)</td>   
     </tr> 
	 <tr>      
        <td>名称</td>   
	     <td>Demo VPC</td>   
     </tr> 
	 <tr>      
        <td>IPv4 CIDR</td>   
	     <td>10.0.0.0.16</td>   
     </tr> 
	 <tr>      
        <td>子网名称</td>   
	     <td>Demo 子网</td>   
     </tr> 
	 <tr>      
        <td>IPv4 CIDR</td>   
	     <td>10.0.0.0/16</td>   
     </tr> 
	 <tr>      
        <td>可用区</td>   
	     <td>广州三区</td>   
     </tr> 
</table>

<span id="Step5"></span>
## 步骤5：配置 MySQL 数据库
云数据库 MySQL 实例需与 [步骤3](#Step3) 配置私有网络的地域和子网的可用区保持一致。

1. 购买云数据库 MySQL 实例，具体操作请参见 [购买方式](https://cloud.tencent.com/document/product/236/5160)。
 <table>
     <tr>
         <th width="20%">参数</th>  
         <th>取值样例</th>  
     </tr>
	 <tr>      
        <td>计费模式</td>   
	     <td>	按量计费</td>   
     </tr> 
	 <tr>      
        <td>地域</td>   
	     <td>广州</td>   
     </tr> 
	 <tr>      
        <td>数据库版本</td>   
	     <td>MySQL5.7</td>   
     </tr> 
	 <tr>      
        <td>架构</td>   
	     <td>高可用版</td>   
     </tr> 
	 <tr>      
        <td>主可用区</td>   
	     <td>广州三区</td>   
     </tr> 
	 <tr>      
        <td>备可用区</td>   
	     <td>广州四区</td>   
     </tr> 
	 <tr>      
        <td>实例规格</td>   
	     <td>4核8000MB</td>   
     </tr> 
	 <tr>      
        <td>硬盘</td>   
	     <td>200GB</td>   
     </tr> 
	 <tr>      
        <td>网络</td>   
	     <td>Demo VPC，Demo 子网</td>   
     </tr> 
	 <tr>      
        <td>实例名</td>   
	     <td>立即命名：Demo 数据库</td>   
     </tr> 
	 <tr>      
        <td>购买数量</td>   
	     <td>1</td>   
     </tr> 
</table>
2. 初始化 MySQL 数据库，具体操作请参见 [初始化 MySQL 数据库](https://cloud.tencent.com/document/product/236/3128)。
 <table>
     <tr>
         <th width="20%">参数</th>  
         <th>取值样例</th>  
     </tr>
	 <tr>      
        <td>支持字符集</td>   
	     <td>UTF8</td>   
     </tr> 
	 <tr>      
        <td>表名大小写敏感</td>   
	     <td>是</td>   
     </tr> 
	 <tr>      
        <td>自定义端口</td>   
	     <td>3306</td>   
     </tr> 
	 <tr>      
        <td>设置 root 帐号密码</td>   
	     <td>请自定义设置</td>   
     </tr> 
	 <tr>      
        <td>确认密码</td>   
	     <td>请再次输入密码</td>   
     </tr> 
</table>
3. 登录 MySQL 数据库，具体操作请参见 [登录 phpMyAdmin](https://cloud.tencent.com/document/product/236/36444)。
4. 根据实际需求，创建数据表和字段用于存储用户的手机号、头像、用户昵称等信息，具体操作请参见 [创建数据库和表](https://cloud.tencent.com/document/product/236/8465)。

<span id="Step6"></span>
## 步骤6：配置 NAT 网关
1. 新建 NAT 网关，具体操作请参见 [创建 NAT 网关](https://cloud.tencent.com/document/product/552/18186#.E6.AD.A5.E9.AA.A41.EF.BC.9A.E5.88.9B.E5.BB.BA-nat-.E7.BD.91.E5.85.B3)。
  <table>
     <tr>
         <th width="20%">参数</th>  
         <th>取值样例</th>  
     </tr>
	 <tr>      
        <td>网关名称</td>   
	     <td>Demo NAT</td>   
     </tr> 
	 <tr>      
        <td>所属网络</td>   
	     <td>Demo VPC</td>   
     </tr> 
	 <tr>      
        <td>网关类型</td>   
	     <td>小型</td>   
     </tr> 
	 <tr>      
        <td>出带宽上限</td>   
	     <td>100Mbps</td>   
     </tr> 
	 <tr>      
        <td>弹性 IP</td>   
	     <td>新建弹性 IP</td>   
     </tr> 
</table>
2. 新增路由，具体操作请参见 [配置相关子网所关联的路由表](https://cloud.tencent.com/document/product/552/18186#.E6.AD.A5.E9.AA.A42.EF.BC.9A.E9.85.8D.E7.BD.AE.E7.9B.B8.E5.85.B3.E5.AD.90.E7.BD.91.E6.89.80.E5.85.B3.E8.81.94.E7.9A.84.E8.B7.AF.E7.94.B1.E8.A1.A8)。

<span id="Step7"></span>
## 步骤7：新建云函数
云函数目前支持 Python、Node.js、PHP、Java 以及 Golang 语言开发，本文以 Node.js 为例。

1. 在华南地区(广州)地区新建函数，具体操作请参见 [编写函数](https://cloud.tencent.com/document/product/583/37509#.E7.BC.96.E5.86.99.E5.87.BD.E6.95.B0)。
  <table>
     <tr>
         <th width="20%">参数</th>  
         <th>取值样例</th>  
     </tr>
	 <tr>      
        <td>函数名称</td>   
	     <td>Demo</td>   
     </tr> 
	 <tr>      
        <td>运行环境</td>   
	     <td>Nodejs 8.9</td>   
     </tr> 
	 <tr>      
        <td>创建方式</td>   
	     <td>模板函数：helloworld</td>   
     </tr> 
</table>
2. 部署函数并配置触发方式为【API网关触发器】，具体操作请参见 [部署函数](https://cloud.tencent.com/document/product/583/37509#.E9.83.A8.E7.BD.B2.E5.87.BD.E6.95.B0.EF.BC.88.E5.90.AB.E9.85.8D.E7.BD.AE.E8.A7.A6.E5.8F.91.E5.99.A8.EF.BC.89)。

<span id="Step8"></span>
## 步骤8：部署短信 SDK
1. 执行以下命令，安装 SDK。
```
npm install tencentcloud-sdk-nodejs --save
```
2. 在代码中引用短信模块代码。
3. 配置发送短信核心逻辑。
```
带补充【脱敏的】【可对外发布的】示例代码
```

<span id="Step9"></span>
## 步骤9：检验验证码核心逻辑
验证码的时效性要求较高，您可以把验证码存在内存中或存在云数据库 Redis 中。以手机号作为 key，存储发送时间、验证码、验证次数、是否已验证过等信息。出于安全考虑，建议设置防止暴力破解的限制，本文以验证码有效时间为10分钟且最多验证3次为例。
```
带补充【脱敏的】【可对外发布的】示例代码
```

<span id="Step10"></span>
## 步骤10：配置登录模块
登录模块主要用于用户注册或登录，首次登录（即注册）时将保存用户的手机号、用户名、头像、注册时间等信息。
```
带补充【脱敏的】【可对外发布的】示例代码
```

<span id="Step11"></span>
## 步骤11：查看短信发送结果

