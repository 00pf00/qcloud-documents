## 操作场景

富媒体推送允许开发者推送 图片、声音、视频等除普通文本之外更丰富的内容，能够有效提升通知点击率。应用开发者可以利用该功能推送如新闻、优惠券、活动信息等更加丰富的内容 ，满足不同开发者的个性化推送需求。

## 适用范围

目前 TPNS 对于富媒体推送能力的支富媒体持程度如下：
- Android：支持图片、音频
- iOS：支持图片、音频、视频

各推送通道富媒体支持类型和使用要求如下表所示：

| 推送通道 | 支持类型          | 使用要求                                                     |
| -------- | ----------------- | ------------------------------------------------------------ |
| 华为     | 缩略图            | <li>URL 使用的协议必须是`HTTPS`协议<li> 格式要求：`PNG/JPG/JPEG`格式图片；尺寸120 × 120px；小于200KB |
| 小米     | 大图              | <li>格式要求：`PNG/JPG/JPEG`格式图片；固定876 x 324px；小于1M      |
| TPNS     | 大图+缩略图 +音频 | <li>仅支持 HTTP 格式，后缀为`JPEG/JPG/PNG`格式的图片<li>图片高度不能超过256，宽度自适应<li>音频文件大小不超过5M，URL 格式必须为`HTTPS ` |
| APNs     | 缩略图+音视频     | <li>仅支持`JPEG/PNG/GIF`格式的图片文件<li>请将图片大小控制在10Mb以内<li>音视频文件大小不超过5M，格式为`MPEG/MPEG2video/MPEG4/AVI`且 URL 格式为`HTTP/HTTPS` |

## 操作步骤

### 控制台使用

1. 登录 [移动推送控制台](https://console.cloud.tencent.com/tpns)，在左侧导航中选择【推送管理】>【推送任务】，进入推送任务页面。
2. 单击【新建推送】>【高级设置】。
![](https://main.qcloudimg.com/raw/e6ffbd24e1d929e106cd6098b7632c12.png)
3. 打开通知图片或音视频开关填入富媒体消息 URL，当您打开通知图片时：

#### Android 端：
> ?1.缩略图：
> 通过TPNS通道和华为通道下发的推送可展示缩略图。
> 格式要求：PNG/JPG/JPEG格式图片，尺寸120×120px，小于200KB；
> 2.大图:
> 通过TPNS通道和小米通道下发的推送可展示大图。
> 格式要求：PNG/JPG/JPEG格式图片，尺寸固定876*324px，小于1M；

![](https://main.qcloudimg.com/raw/7101050f66a6d8790bf21d80b551418d.png)

#### iOS 端：
![](https://main.qcloudimg.com/raw/785df5313dc5b0dafa36a60aad45d830.png)

> ?填写图片 URL 后，通知会展示图片，格式要求：
>1. 大小不超过10M
>2. 格式为`png/jpg/jpeg/gif`
>3. URL 格式为 HTTP/HTTPS

当您打开通知音频或音视频时：
Android端：
![](https://main.qcloudimg.com/raw/3bcebae62b352876f8ff4f85401f4782.png)

> ?填写音频URL后，TPNS通道下发的通知可携带音频。

1. 音频文件大小不超过 5 M
2. URL格式必须为https

iOS端：
![](https://main.qcloudimg.com/raw/208866d2a4b6191a6ce3e9ec7273cb44.png)

> ?填写音视频URL后，通知可携带音频或视频，通过Apple原生组件播放。
> 注意：

1. 音视频文件大小不超过 5 M
2. 格式为MPEG/MPEG2video/MPEG4/AVI
3. URL格式为http/https

### Rest API 使用

若需要在调用API推送时下发富媒体消息，可通过 Push API 中`Android`或`iOS`消息体中的 `xg_media_resources` 和`xg_media_audio_resources`来设置，详情可参考 [PushAPI 必要参数](https://cloud.tencent.com/document/product/548/39064#android-.E6.99.AE.E9.80.9A.E6.B6.88.E6.81.AF) 说明。
Android 端推送示例如下：

```
{
    "audience_type": "token",
    "token_list": [
        "05da87c0ae******2dfa9e08d884aada5bb2"
    ],
    "message_type": "notify",
    "multi_pkg":true,
    "message": {
        "title": "推送标题",
        "content": "推送内容",
		"xg_media_resources": "xxx1" , //此处填富媒体元素地址，例如https://www.xx.com/img/bd_logo1.png?qua=high
        "xg_media_audio_resources":"xxx", //此处填音频富媒体元素地址，例如https://sc1.111ttt.cn/2018/1/03/13/396131227447.mp3 
        "android": {
             "custom_content":"{\"key\":\"value\"}"
        }			
    }
}
```

## 常见问题

1. 魅族、OPPO、vivo厂商通道不支持富媒体，推送全部设备时，通知如何下发？
答：TPNS、华为、小米、FCM通道下发的通知带图片，魅族、OPPO、vivo通道下发的通知默认纯文本样式，不带图片。

2. 推送消息需要携带图片怎么使用？
答：无论是调用API还是通过控制台下发，都需要将图片生成URL后使用。

3. Android音频富媒体下发策略是怎么样的？
答：TPNS通道下发的音频富媒体推送，正常展示音频，其他通道下发的音频富媒体推送，默认纯文本样式，不带音频。

4. 通知图片和通知音视频可以同时开启吗？
答：不能同时开启。
