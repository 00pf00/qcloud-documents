## 简介

用户在 COS 控制台设置存储桶的权限策略时，可能会出现误修改或者误操作等场景，而开启存储桶策略多版本功能，可帮助用户找回先前设置的存储桶权限策略。

**功能特性**

存储桶策略多版本主要有以下特性：

- 存储桶策略多版本为存储桶属性，因此其只能应用于单个存储桶，不能应用于多个存储桶。
- 存储桶策略多版本在用户对存储桶策略进行创建或修改完成后自动生成，即不需额外触发。
- 存储桶策略多版本中每个版本包含权限策略内容、创建时间，方便用户查看。
- 对于存储桶的配置来说，用户可以选择是否添加权限策略，因此存储桶策略多版本中的生效版本允许被删除。

**使用约束**

使用存储桶策略多版本，有如下约束：

- 存储桶策略多版本对于每个存储桶最多可保留五个版本，如果再继续添加多版本，则按新旧版本顺序依次删除较旧的版本。
- 存储桶策略多版本为低频率操作，因此只支持在控制台操作。
- 存储桶策略多版本功能当前适用于广州地域。

**计费方式**
存储桶策略多版本功能当前可免费使用。

## 操作指南

> ?如果需要使用存储桶策略多版本，需要先 [添加存储桶策略](https://cloud.tencent.com/document/product/436/33369)。

**添加存储桶策略**

1. 登录 [腾讯云控制台](https://console.cloud.tencent.com/)，单击【对象存储】，单击【存储桶列表】。
2. 单击需要操作的存储桶，单击【权限管理】，此时可以看到 Policy权限设置，如下图所示：
   ![](https://main.qcloudimg.com/raw/5dd5498b2da225dc444d986bf09a227d.png)
3. 可以选择图形设置或者策略语法来创建创建存储桶策略；
4. 以下通过图形设置方式为例，单击编辑策略，按所需策略进行添加，如下图所示：
   ![](https://main.qcloudimg.com/raw/4e12329ead6f5850e310476ffe7907f7.png)
5. 策略编辑完成后，点击保存，可以在控制台顶部看到“设置 Policy 权限信息成功，已应用为生效版本”提示。

**查看存储桶策略多版本**

Bucket policy 创建后，可以在版本列表中查看：

1. 单击需要操作的存储桶，单击【权限管理】，单击版本列表，可以看到刚创建的存储桶策略，版本号为1，同时标识其为生效版本：
   ![](https://main.qcloudimg.com/raw/5d9ce328e70f6093fb9920d28bd8db3f.png)
2. 同时可以点击**1（生效版本）**，可以查看此生效版本的具体内容：
   ![](https://main.qcloudimg.com/raw/161f65dcebc1f387f71ddae09ba41e9f.png)

**修改存储桶策略**

存储桶策略创建后，可以对存储桶策略进行修改：

1. 单击需要操作的存储桶，单击【权限管理】，单击图形设置或者策略语法来对存储桶策略进行修改。
2. 以**策略语法**方式为例，对存储桶策略进行修改，如下图所示：
   ![](https://main.qcloudimg.com/raw/dcc661abadb40b6e6f3fc8cd84e2a382.png)
3. 点击编辑，对存储桶策略内容进行修改。
4. 修改完成后，点击保存，可以在控制台顶部看到“设置 Policy 权限信息成功，已应用为生效版本”提示。

> !图形设置或者策略语法中展示的内容为生效版本内容。

**回滚存储桶策略多版本**

存储桶策略修改后，在版本列表中可以查看修改前的版本。

1. 单击需要操作的存储桶，单击【权限管理】，单击版本列表，可以看到刚修改后的存储桶策略，版本号为2，同时标识其为生效版本；修改前的版本，其版本号为1，如下图所示：
   ![](https://main.qcloudimg.com/raw/b68a668e4e2deffdde4ce177e86b266b.png)
2. 如果发现修改后的存储桶策略(如版本2)不合适，需要回滚到版本1，则可以通过选择版本1，同时设置为生效版本即可，如下图所示：
   ![](https://main.qcloudimg.com/raw/bda497f2801f862a7d8c4977d69c2511.png)

> !版本号为阿拉伯数字，从1开始，如果将某个版本删除，后续版本号持续累加，因此会出现版本号不连续的情况。
