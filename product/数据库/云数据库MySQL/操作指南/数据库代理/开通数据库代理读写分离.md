
本文为您介绍如何通过云数据库 MySQL 控制台开通数据库代理读写分离。

## 前提条件
- 已 [开通数据库代理](https://cloud.tencent.com/document/product/236/54653)。
- 该主实例已 [创建只读实例](https://cloud.tencent.com/document/product/236/7270)，如未创建只读实例，开通页面会提示购买只读实例。

## 操作步骤
1. 登录 [MySQL 控制台](https://console.cloud.tencent.com/cdb)，在实例列表，选择已开启代理的主实例，单击实例名或“操作”列的【管理】，进入实例管理页面。
2. 在实例管理页面，选择【数据库代理】>【读写分离】页，单击【立即开启】。
![](https://main.qcloudimg.com/raw/5634da6096e8ffd53c09fdbea035d0b1.png)
3. 在弹出的对话框，设置延迟剔除、权重等后，单击【确定】。
>!仅状态为”运行中“的主实例和只读实例，才能加入数据库代理中。
>
 - **只读实例剔除**：是否启动剔除策略。延迟剔除阈值默认为10秒。
    - 若只读实例延迟超过阈值时，则会被剔除，被剔除的实例权重自动设置为0，且系统会向用户发出告警（须先订阅"数据库代理挂载节点剔除“告警，配置请参见 [告警功能](https://cloud.tencent.com/document/product/236/8457)）。
    - 当只读实例延迟时间小于阈值时，会重新加入到数据库代理中。同时，不管是否启用延迟剔除功能，只读实例故障被剔除后，待实例修复也会重新加入到数据库代理中。
 - **读权重分配**：支持系统自动分配权重和自定义权重两种方式，来配置主实例和只读实例的读权重。权重输入范围为0 - 100，且必须是整数。
    - 数据库代理将按照权重设置分配读请求的流量，如两个只读库的权重分别为10和20，那么他们的读请求流量将按照1:2的比例分配。
    - 权重仅为读请求的权重，写请求会直接路由到主库，不参与权重的计算。如，客户端发送了10条写语句和10条读语句，主库和只读库的权重比为1:1，这时主库会收到10条写语句和5条读语句，只读库收到5条读语句。
    - 系统自动分配时，仅能设置主实例的权重。
    - 如果只读实例的权重为0，则proxy不会对该只读实例建连，如果只读实例的权重从0改为非0，权重无法立即生效，只能对新连接生效。
 - **故障转移**：推荐开启，数据库代理出现故障时，连接地址将会路由到主实例。
 - **自动添加只读实例**：开启后，主实例新建的只读实例会自动添加到
![](https://main.qcloudimg.com/raw/577d9bf1c3fdb06c7621fcb2075f80b9.png)

