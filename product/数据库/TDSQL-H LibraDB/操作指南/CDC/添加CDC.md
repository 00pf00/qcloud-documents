## 添加CDC

在控制台列表页，点击【实例ID】或是【详情】，切换到【CDC】标签，在CDC列表页点击【添加CDC】，可创建将OLTP同步到分析引擎的数据链路。

<img src="https://qcloudimg.tencent-cloud.cn/raw/1216dcd1279944ec9ae88526abb031eb.png" style="zoom:60%;" />



1. 按照页面"**设置数据源**"要求，分别填写源端MySQL实例的信息。“测试连通性”通过后，即可点击【下一步】，进入“**设置对象**”。

- 特别的，为了让服务对您的源端实例影响降到最小。CDC限制了源实例账号的权限。建议您为CDC任务单独增加用户和账号信息。所需权限如下

  - “整个实例”同步，需要的帐号权限如下。

    ```sql
    CREATE USER 'CDC帐号'@'%' IDENTIFIED BY 'CDC密码';  
    GRANT RELOAD,LOCK TABLES,REPLICATION CLIENT,REPLICATION SLAVE,SHOW DATABASES,SHOW VIEW,PROCESS ON *.* TO 'CDC帐号'@'%';  
    GRANT ALL PRIVILEGES ON `__tencentdb__`.* TO 'CDC帐号'@'%';  
    GRANT SELECT ON *.* TO 'CDC帐号';
    ```

  - “指定对象”同步，需要的帐号权限如下。

    ```sql
    CREATE USER 'CDC帐号'@'%' IDENTIFIED BY 'CDC密码';  
    GRANT RELOAD,LOCK TABLES,REPLICATION CLIENT,REPLICATION SLAVE,SHOW DATABASES,SHOW VIEW,PROCESS ON *.* TO 'CDC帐号'@'%';  
    GRANT ALL PRIVILEGES ON `__tencentdb__`.* TO 'CDC帐号'@'%';  
    GRANT SELECT ON `mysql`.* TO 'CDC帐号'@'%';
    GRANT SELECT ON 待同步的库.* TO 'CDC帐号';
    ```

  - 授权语句中，有对\_\_tencentdb\_\_库的授权，腾讯云需要该库记录位点等元数据信息。

    > 对\_\_tencentdb\_\_授权前，无需创建\_\_tencentdb\_\_

2. 在第二步“**设置对象**”页面，选择同步类型和对象，点击保存，即可进入下一步“**高级设置**”。

   CDC提供了如下同步类型选择，以适用于用户多种场景。

   | CDC  | 初始全量数据 | 增量数据 | 功能                                                         | 场景                                                 |
   | ---- | ------------ | -------- | ------------------------------------------------------------ | ---------------------------------------------------- |
   | √    |              |          | 只将库表结构同步到 LibraSQL 分析引擎。                       | 做结构验证。                                         |
   | √    | √            |          | 将库表结构和全量数据同步到 LibraSQL 分析引擎。               | 开发测试环境做测试验证。                             |
   | √    | √            | √        | 将库表结构、全量数据同步到 LibraSQL 分析引擎后继续保持数据同步。将源端在同步过程中的数据，实时同步到目标。 | 同步的信息最多，适用于所有场景。                     |
   | √    |              | √        | 只做结构同步和增量数据同步。                                 | 日志场景，流式分析等只关注增量数据的场景。           |
   |      |              | √        | 只将增量数据同步到目标端。                                   | 用户需要定制化的目标表结构，且只需要流式的增量数据。 |
   
3. “**高级设置**”页面，可设置分区键和特殊的字段类型映射，对应章节有具体介绍。完成设置后，点击“保存”，即进入下一步“**校验任务**”。

4. CDC正式启动数据同步前，需要检查用户的各项设定是否能满足启动的要求，”**校验任务**“页即是将检查结果汇总报告。若校验通过，则可正式启动任务。可关闭该页，在任务列表页修改、重新校验或是启动任务。

   - 若有“失败”类校验结果，则不能启动任务。
   - 若有“警告”类校验结果，虽可以启动任务，但需用户仔细核对警告信息。

5. ”**校验任务**“通过校验后，即可“启动任务”。任务启动后会返回任务列表。显示当前任务的进度和信息。