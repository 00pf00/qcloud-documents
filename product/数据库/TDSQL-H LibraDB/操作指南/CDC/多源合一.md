## 多源合一

将多个OLTP实例的数据，同步到一个 LibraSQL 分析引擎进行分析是一个常见的使用场景。

- 例如：在游戏行业中，各个游戏服采用分库的架构时，各个库中就会有相同用户表，日志表，道具表等等。而通过使用TDSQL-H LibraDB，将数据多源合一到LibraSQL分析引擎，既能为各个游戏服产出报表，也能以全局视角聚合分析所有数据，以及完成全局的审计需要等等。

#### 多源合一特点

- OLTP实例中的库表名，可能相同。
- 可能存在数据冲突。
- 对CDC链路及目标分析引擎性能要求较高。

#### TDSQL-H LibraDB 多源合一实践

- 使用CDC的“库表名映射修改”能力，可以使不同源DB实例的表，在导入LibraSQL分析引擎后拥有相同的命名模式。

  - 例如：日志表在源实例A是A_20210101,在源实例B是B_20210101，可以通过重命名，为同步到LibraSQL分析引擎实例中的这两张表添加_log后缀。

- 利用Merge表能力，构造虚拟表，完成表数据查询合并。当然前置条件是，虚拟表各母表的表结构必须相同。

- 以日志应用为例，Merge表创建使用举例如下:

```sql
-- 在当前Database下，按照普通表tbl_1的表结构建立Merge表tbl_all。tbl_all是所有命名符合正则.*_log的表的全局只读视图。
create table tbl_all as tbl_1 engine=Merge(currentDatabase(), ‘.*_log’);

-- 当查询Merge表时，LibraSQL分析引擎会自动查询所有tbl_*表，并汇聚结果返回
select * from tbl_all;
```

