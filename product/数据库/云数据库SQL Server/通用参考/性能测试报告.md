## 测试工具
本文性能测试使用的是 HammerDB 内置的 TPC-C 基准测试负载。TPC-C 是一种典型的 OLTP 工作负载，其模拟了拥有多个仓库的商品批发销售公司为大量客户发货商品的场景，其中仓库数的调整在测试中能够体现数据库所能够支持的数据规模能力。
- [HammerDB 下载地址](https://www.hammerdb.com/download.html)
- [HammerDB 使用手册](https://www.hammerdb.com/document.html)
- [HammerDB 内置 TPC-C 测试负载介绍](https://www.hammerdb.com/docs/ch03.html)

## 测试环境和参数
### 测试实例版本
测试版本覆盖2008R2企业版、2012企业版、2014企业版、2016企业版、2017企业版、2019企业版。

### 测试实例规格
#### 高可用版
高可用版测试规格覆盖当前售卖的所有规格，包括1核2GB、1核4GB、1核8GB、2核16GB、 4核32GB、8核64GB、12核96GB、16核128GB、24核192GB 、32核256GB、48核384GB、64核512GB、90核720GB。

#### 基础版
基础版测试规格覆盖当前售卖的所有规格，包括1核2GB、1核4GB、2核4GB、2核8GB、 4核8GB、4核16GB、8核16GB、8核32GB、16核32GB 、16核64GB、24核48GB、24核96GB。

### 负载生成环境
安装 HammerDB 的机器，与数据库实例型号一致，能保证充分压测出 SQL Server 实例性能。

### TPCC 基准参数
- Number of Warehouses = 100：设置仓库个数为100。
- Minutes of Rampup Time = 2：设置测试前预热时间为2分钟。
- Minutes Test Duration = 5：设置测试时间为5分钟。

### 虚拟用户数
虚拟用户数即并发连接数，本文分别在不同版本不同规格的实例上，测试了不同的并发连接数。

#### 高可用版
| 并发连接数 | 2        | 4        | 8        | 16       | 32       | 64       | 128      | 256      | 512      | 1024     |
| ---------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- |
| 1核2GB     | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | -   | -    |
| 1核4GB     | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | -   | -    |
| 1核8GB     | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | -   | -    |
| 2核16GB   | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | -        |
| 4核32GB   | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | -        |
| 8核64GB   | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | -        |
| 12核96GB   | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; |
| 16核128GB  | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; |
| 24核192GB  | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; |
| 32核256GB  | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; |
| 48核384GB  | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; |
| 64核512GB  | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; |
| 90核720GB  | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; |

#### 基础版
| 并发连接数 | 2        | 4        | 8        | 16       | 32       | 64       | 128      | 256      | 512      | 1024 |
| ---------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | -------- | ---- |
| 1核2GB     | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | -        | -    |
| 1核4GB     | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | -        | -    |
| 2核4GB     | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | -    |
| 2核8GB     | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | -    |
| 4核8GB     | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | -    |
| 4核16GB    | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | -    |
| 8核16GB    | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | -    |
| 8核32GB    | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | -    |
| 16核32GB    | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003;   |
| 16核64GB    | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003;   |
| 24核48GB    | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003;   |
| 24核96GB    | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003; | &#10003;  |

## 测试方法
 ## 测试方法
1. 准备 TPC-C 工作负载。
 - Number of Warehouses：仓库个数，将影响生成测试库的大小。
 - Virtual Users to Build Schema：生成负载数据时的并发连接数（不能超过仓库个数），大小将影响负载数据生成效率，建议与生成负载设备 CPU 核心数保持一致。
![](https://main.qcloudimg.com/raw/976f094fdf0e32dcfb5537bc6cf2cf0b.png)
2. 设置测试脚本。
 - Total Transactions per User：每个用户的总事务数。建议设置较高的值保证在压测时，User 不会因为事务运行完而退出。
 - Minutes of Rampup Time：压测预热时间。
 - Minutes for Test Duration：压测运行时间。
![](https://main.qcloudimg.com/raw/c0225b4272891c94f58ffb6645ca0da1.png)
3. 设置自
