
## DTS简介
数据传输服务（TencentDB Service for Transmission）是提供数据迁移、数据同步、数据订阅于一体的数据库数据传输服务，帮助您在业务不停服的前提下轻松完成数据库迁移，利用实时同步通道轻松构建异地容灾的高可用数据库架构。DTS for Redis目前支持各种网络场景、各种版本的Redis数据迁移。

| 术语 | 说明 | 
|---------|---------|
| 源实例 | 迁移的源实例。 | 
| 目标实例 | 迁移的目标实例，即用户购买的腾讯云 Redis。 | 
| CVM 自建 | 用户在腾讯云服务器上部署的 Redis 服务迁移至腾讯云 Redis。 | 
| 公网自建 | 用户在外网环境下部署的 Redis 服务迁移至腾讯云 Redis。 | 

## 迁移支持说明

#### 支持功能
- 数据迁移：DTS迁移服务支持一次性的将数据迁移到云上；
- 数据同步：DTS迁移服务支持全量迁移+增量同步的方式将数据实时同步到云上；

#### 支持版本
- DTS迁移服务支持的版本包括Redis 2.8、3.0、3.2、4.0；
- 支持的架构包括单节点、redis cluster、codis、tewmproxy；
- 迁移权限要求：DTS迁移数据需要源实例支持SYNC或者PSYNC命令；

#### 支持网络
DTS迁移服务支持常见的网络常见迁移，包括了公网、云主机自建、专线接入、VPN接入、云联网场景下的数据迁移与数据同步；

#### 支持场景
  - 上云迁移：DTS服务支持将您在传统IDC的Redis迁移到腾讯云Redis，帮助您的业务高效、便捷的完成上云迁移。
  - 云上自建迁移：DTS服务支持将您在腾讯云或者其他云上，通过虚拟机自建的Redis服务迁移到腾讯云。
  - 云实例间迁移：DTS服务支持在云实例间进行数据迁移或者实时同步，支持的版本如下：
    <table>
    <tr>
    <td colspan=3>源实例</td>
    <td>目标实例</td>
    </tr>
    <tr>
    <td>2.8标准版</td>
    <td>4.0标准版</td>
    <td>4.0集群版</td>
    <td></td>
    </tr>
    <tr>
    <td>✓</td>
    <td>x</td>
    <td>x</td>
    <td>2.8标准版</td>
    </tr>
    <tr>
    <td>✓</td>
    <td>✓</td>
    <td>✓</td>
    <td>4.0标准版</td>
    </tr>
    <tr>
    <td>✓</td>
    <td>✓</td>
    <td>✓</td>
    <td>4.0集群版</td>
    </tr>
    </table>

#### 迁移限制说明
>!
- 为保障迁移效率，CVM 自建实例迁移不支持跨地域迁移。
- 外网实例迁移时，需确保源实例服务在外网环境下可访问。
- 进行迁移任务时，只允许迁移正常运行状态下的实例，未初始化密码或者有其他任务在执行中的实例，不能够迁移。
- 目的实例必须是没有数据的空实例，迁移过程中，会锁住实例，不能对实例进行写入操作。
- 迁移成功时，由业务侧验证数据后，可断开源实例连接，将连接切换到目标实例。

## 迁移过程
### 1. 新建迁移任务
1. 登录 [数据传输服务控制台](https://console.cloud.tencent.com/dtsnew/migrate/page) ，在数据迁移列表，单击【新建任务】创建迁移任务。
2. 在【链路地域】选择对应地域，单击【0元购买】。

### 2. 设置任务
- 任务名称：为任务指定名称。
- 定时执行：为迁移任务指定开始时间。

>!
> - 修改定时任务，校验通过后，需要重新单击【定时启动】，任务才会定时启动。
> - 如果任务过了定时启动的时间，定时启动会变为立即启动，单击【立即启动】，会立刻启动任务。

### 3. 设置源库和目标库
以 CVM 上的 Redis 实例为例说明，外网实例迁移下同。

| 字段 | 描述 | 备注 | 必填 |
|---------|---------|---------|---------|
| 任务名称 | 迁移任务的名称 |方便用户管理任务 | 是 |
| CVM 实例 ID |源 Redis 实例所在的腾讯云服务器 ID |迁移任务会根据 CVM 实例 ID，检查云服务器运行情况 | 是 |
| CVM 内网 IP |源 Redis 实例所在的腾讯云服务器的内网 IP |迁移任务会检查云服务器内网 IP | 是 |
| 端口 | 源实例端口号 |迁移任务会访问源实例服务 | 是 |
| 密码 | 源实例密码 |访问源实例服务时，有 auth 鉴权 | 否 |
| 实例 ID | 目标实例 ID |同步数据到目标实例 | 是 |

>!目前支持源无密码的迁移。

### 4. 设置参数并校验
1. 系统在迁移开始会设置这些参数，迁移结束会恢复参数的历史值，单击【下一步：校验任务】进行参数校验（为保证迁移效率，建议使用默认值）。
![](https://main.qcloudimg.com/raw/af8381c236e912ae4798b296c5cdbe0a.png)
2. 校验成功后，单击【启动】。
>!
>- 出现告警项也可以进行数据迁移，但需了解告警内容是否对数据有影响。
>- 如果网络不可达，请检查源实例所在服务的安全组，需要将安全组放通全部端口。

### 5. 启动迁移任务
1. 参数校验成功后，任务处于未启动状态，返回【数据迁移】页。
2. 在【操作】列单击【立即启动】，启动任务后，任务状态变为【校验中】，任务会再做一次参数校验，校验期间只能取消任务、查看任务和查看校验情况。
3. 参数校验成功后，数据开始迁移。
数据同步阶段，会展示数据偏移量、源实例、目标实例 key 变化情况。

### 6. 完成迁移任务 
断开同步前，可在目标实例上验证数据，如果验证无误，即可完成迁移任务。
当源实例和目标实例的 key 同步一致时，单击【完成】确定，即可完成数据同步操作。



 
 
