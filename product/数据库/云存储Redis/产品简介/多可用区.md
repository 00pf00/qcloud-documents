
云数据库 Redis 支持同地域下跨多个可用区部署副本，相对单可用区实例（主节点和副本节点在同一可用区），多可用区实例具有更高的可用性和容灾能力。
- 单可用区：主机、机架级容灾能力。
- 多可用区：主机、机架、可用区级容灾能力。

## 产品架构
![](https://main.qcloudimg.com/raw/855cfa6d9f004b589c708eeb12de1518.png)
架构说明：
- LB（负载均衡）：Redis 的标准架构和集群架构都有 Proxy，且 Proxy 的数量 >= 3，因此需要通过 LB 来均衡访问。
- VIP：多 AZ（可用区）的实例只有一个 VIP，这个 VIP 在整个 Region 都可以访问，Redis 的 HA（高可用）并不会导致 VIP 变化。
- Proxy：每个实例至少有3个 Proxy，标准架构的 Proxy = 3 + (副本数 - 1)，集群架构的 Proxy = 分片数 * 副本数。
- Master（Group）：Redis 的主节点或是所有分片的主节点被称为 Master（Group）。
- Replica（Group）：Redis 的副本节点或是集群实例的多个分片中的一个副本组成的集合被称为副本或者副本组 Replica（Group），集群架构的副本组是将一个分片的多个副本分到不同的组，以便于将不同的副本组部署到不同的可用区。
- 主可用区：主节点所在的可用区被称为主可用区，除非手动在控制台变更，否则主可用区将始终保持不变，主节点故障后可能会导致主节点切换到副本可用区，这个状态是临时的，HA 系统将在满足条件的前提下，在数分钟内将主节点迁回到主可用区，迁移过程是无损，除非您的业务使用了阻塞命令，如 blpop、blpush。

## 可用区配置
支持将 Redis 节点部署到同 Region 下任意可用区，最大支持部署到6个可用区。
![](https://main.qcloudimg.com/raw/c5d9cd4fc9c9e0b5e988115a20497c83.png)
多可用区信息：

 
## 故障切换机制（HA）
	故障判断：Redis标准架构和集群架构采用的是Redis Cluster原生的集群管理机制，依靠集群内节点之间的Gossip协议来进行节点状态的判断，节点判死的时效性取决于cluster-node-timeout，默认值是15ms，建议不要更改该参数。节点故障的判断请参考Redis Cluster 原生的设计：https://redis.io/topics/cluster-tutorial
	主节点选举：相对原生的Cluster Failover机制，腾讯云Redis引入了主可用区优先切换的逻辑，以保障主可用区的业务的访问时延，具体的机制如下：
	数据最新的节点优先选主；
	数据相同，主可用区的副本优先选注；
跨可用区访问
未开副本只读
未开启副本只读（读写分离）的实例，所有的读写请求都会经过本可用区的Proxy路由到主节点，保障数据的一致性，同时保障最多仅有一次的AZ穿越；
卡其副本只读
开启副本只读（读写分离）的实例，写请求将路由到主节点，读请求将路由到本可用区的副本节点，满足业务就近访问的诉求。
部署推荐
采用一主两副本，主AZ一主一副本，副本AZ一个副本，这种部署模式可以最大限度的保障业务的可用性和降低主机故障带来的延迟影响，因为在主AZ部署一个副本，在主节点故障后，主可用区有一个副本可以优先选主，保障主可用区的访问延迟不会因为主节点切换到备可用区而受到影响。
 
