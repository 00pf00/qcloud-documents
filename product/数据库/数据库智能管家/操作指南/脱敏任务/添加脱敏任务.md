本文将为您介绍如何通过控制台添加数据脱敏任务。

## 操作场景
DBbrain 数据脱敏支持一键式全流程配置脱敏任务，支持定时任务、立刻执行任务等多种任务执行方式，确保脱敏任务的灵活启动，支持脱敏规则适配展现，能够向用户展示本次任务对数据表每个字段的识别结果以及计划应用的脱敏算法，用户发现适配存在问题时可以手动调整，确保脱敏任务按照用户的思路进行执行，还支持抽样脱敏，能够抽取数据表少量数据进行快速脱敏并在页面上向用户展示，用户认可脱敏结果后再进行全量脱敏。因此，数据脱敏在开始正式脱敏任务时，其数据识别准确率、脱敏后数据可用性都能得到有效保障。


## 操作步骤
### 步骤1：进入添加任务页面
1. 登录 [DBbrain 控制台](https://console.cloud.tencent.com/dbbrain/desensitization)，在左侧导航选择【数据库安全】>【数据脱敏】，进入数据脱敏页面。
2. 在数据脱敏页面，单击【添加任务】，进入添加任务页面。
![](https://main.qcloudimg.com/raw/3deb825e8098583e155740132cc3b0e4.png)

### 步骤2：设置源和目标数据库
设置源和目标数据库步骤主要分为三部分，分别用于设置数据脱敏的脱敏任务、源数据库和目标数据库。
- 【任务设置】用于设置数据脱敏任务的执行信息，包括任务名称和执行方式的设置，其中执行方式包括定时执行和立即执行，默认不开启的状态为立即执行，用户也可以根据自己的需要开启定时执行脱敏任务。
- 【源库设置】用于设置连接脱敏任务的数据源，包括源库类型、实例ID、账号、密码等，同时支持连通性测试用来检测是否成功连接源数据库
- 【目标库设置】用于设置连接脱敏任务的目标库，包括目标库类型、实例ID、账号、密码等，同时支持连通性测试用来检测是否成功连接目标数据库
![](https://main.qcloudimg.com/raw/bfcc9bac026b0ce8de0017a83d93dbc9.png)
完成上述配置后，设置源和目标库即配置完成，点击【下一步】进入后续流程。


### 步骤3：选择库表和规则
选择库表和规则步骤用于设置需要脱敏的数据库表、脱敏规则、数据库编码和关联令牌。
- 【选择库表】用于设置需要脱敏的数据库表，一次脱敏任务只能对一张数据表进行脱敏，支持按库名和表名对数据表进行搜索
- 【预定义规则】用于为脱敏任务添加脱敏规则，单击下拉框，可以选择之前建立的脱敏规则，如若下拉框中未有所需要的规则，单击右方的规则管理（<span style="color:red"> “规则管理”加链接，链接到“脱敏规则管理”页面</span>），可建立新的脱敏规则。
- 【设置数据库编码】用于设置源库和目标库的编码，默认为UTF8，同时也支持其它编码，如：GBK、LATIN1、UTF8MB4
- 【关联令牌】为非必填项，用于设置当前脱敏任务与其他脱敏任务的关联。如果当前任务填入了其它任务的令牌，则在两次脱敏任务的数据表中有相同字段及内容的情况下，令牌可保证该字段在两次脱敏任务中令牌化的结果相同

![](https://main.qcloudimg.com/raw/a5b966078025d4a0f817b7e7a9f4e50d.png)
选择库表和规则以后，单击【下一步】，如果检测到在本次脱敏任务中，目标实例中已存在重名库表，用户可以做出如下选择：一是删除重名目标表，将脱敏数据写入表，二是取消当前脱敏任务。
![](https://main.qcloudimg.com/raw/16be5f01a4252ba1e7e213fd047e55ea.png)


### 步骤4：规则预览
任务基本参数配置完成后，DBbrain数据脱敏系统将对被脱敏的数据表进行扫描，并对其字段进行各类规则的匹配。
在【规则预览】步骤中，系统将抽取一行数据，按照从数据库中获取的表组织信息进行脱敏，同时，页面会展示这行数据脱敏的字段名、抽样数据、主键非主键判断结果、敏感字段类型、脱敏算法等脱敏操作的依据。系统将通过这些展示，辅助用户判断脱敏系统对规则的理解是否正确。

如果用户发现脱敏系统错误的将某个字段理解为未知类型，或者为字段匹配了错误的脱敏算法，可在此步骤中进行修正。
![](https://main.qcloudimg.com/raw/e98f577bb177d542660f9262033ff139.png)
> 注意：
> 1.对于text、varchar等数据类型，单个单元格超过阈值长度（2083字符），将无法进行脱敏，该单元格数据将会全保留
> 2.对于单个单元格数据大小超过10k的数据，将会写入失败，该单元格数据将会截断保留
> 3.在该步骤中若出现乱码状况，请至上一步【选择库表和规则】步骤中，设置正确的字符集



### 步骤5：抽样脱敏
规则预览微调完成后，DBbrain数据脱敏系统将开始对原始数据表进行抽样脱敏，用户可在【抽样脱敏】步骤的页面中详细了解脱敏后的效果，如果对脱敏结果不满意，可点击【上一步】按钮，返回第三步【规则预览】进行规则修改。如果对规则满意且需要执行任务，则点击【添加任务】，脱敏任务创建成功。创建完成任务后，返回脱敏任务列表，即可看到刚刚建立完成的脱敏任务的任务详情及任务状态，待到执行时间后，将会启动脱敏任务。

> 注意：抽样脱敏是拉取的随机实时数据，为了防止给用户的数据库造成性能影响，脱敏任务在任务开始时拉取的是最新备份数据。

![](https://main.qcloudimg.com/raw/1a7e886d95ee20947e7da33b0e4e9ae0.png)
