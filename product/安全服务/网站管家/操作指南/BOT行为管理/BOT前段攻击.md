## 前端对抗
本文档将为您介绍腾讯云 Web 应用防火墙 BOT 行为管理前端对抗功能。BOT 行为管理前端对抗类型为无感前端对抗，您只需要开启前端对抗防护开启，即可完成对网站业务安全防护。该功能通过客户端动态安全验证技术，对业务请求的每个客户端生成唯一 ID，检测客户端对 Web 或 H5 页面访问中可能存在机器人和恶意爬虫行为，保护网站业务安全。

## 背景信息
前端对抗技术分为有感前端对抗和无感前端对抗技术。
**有感前端对抗：**对符合条件的客户请求通过弹出验证码（滑块、拼图、字符比较等方式）的方式进行验证识别，区别人和工具（BOT）的访问行为，对验证失败达到一定次数的请求进行拦截处理；适用于保护网站核心接口（如购物车、支付、短信接口等）。该能力已经在WAF 的各个模块动作处理（观察、验证码、重定向和拦截等）中集成，您可以根据实际需要进行配置使用。
**无感前端对抗：**通过动态安全技术，对请求客户端生成客户端唯一 ID，检测客户端对 Web 或 H5 页面访问中可能存在刷量和恶意爬虫行为，您可以根据实际需要对恶意访问行为进行动作处理。

>?前端对抗技术仅适用于 Web 或 H5 环境，移动端和小程序暂不支持。

## 前提条件
您已经购买 Web 应用防火墙套餐，完成防护域名添加，域名处于正常防护状态，并且完成域名 BOT 检测开通开启。

>?
>- 对抗当前处于灰度阶段，如需试用请 [联系我们](https://cloud.tencent.com/act/event/connect-service) 进行开通。在灰度期间您可以免费使用，正式发布后，将按官网公布刊例价正常收取费用。
>- 在 CLBWAF 实例添加的域名，暂时不支持前端对抗。

## 操作步骤
1. 进入前端对抗设置页面
登录 [Web 应用防火墙（WAF）控制台](https://console.cloud.tencent.com/guanjia/waf/overview)，在左侧导航栏中，选择【BOT 行为管理】>【防护设置】点击防护域名接入防护设置页面。
![](https://main.qcloudimg.com/raw/d350129b791a93ae69ba3d7eace9b863.png)
选择【前端对抗】进入默认设置页面 
![](https://main.qcloudimg.com/raw/b9424b5cb24492a897ddd99e1c05fccb.png)
**字段和操作说明：**
   - **防护开关：**默认为关闭，前端对抗全局开关。开启后 WAF 将对域名指定的面进行动态安全防护，当前防护只对网页和 H5 页面生效，WAF 将在网页中插入 JS 进行黑产对抗。APP 和小程序暂不适用该策略。
   - **防护模式：**默认为观察，总开关关闭状态下置灰。总开关开启，可以编辑，您根据需要，对检测出异常行为进行动作只处理，当前支持动作类型包括：观察、验证码、重定向和拦截。
2. 前端对抗策略防护
开启防护设置开关，选择策略设置，点击【设置】进行防护配置
 ![](https://main.qcloudimg.com/raw/4015732e5fbc3de834580cc46b353f09.png)
 ![](https://main.qcloudimg.com/raw/03828baadeaf3983bdb1c99885069214.png)
**字段和操作说明：**
 - **防护路径：**默认为：/，表示全站生效，设置前端对抗生效的路径，支持目录和具体 URL，支持输入多个路径，请以英文逗号隔开，最多支持10个，至少需要输入1个路径。
 - **自动化工具识别：**默认开启，自动化工具识别能力，开启后辅助进行动态威胁检测。
 - **页面防调试：**默认开启，为了防⽌⽤户查看⻚⾯逻辑，⻚⾯防调试功能在⽤户调⽤浏览器的开发者工具页面时，阻⽌⽤户跟踪⻚⾯逻辑。
3. 查看前端对抗防护是否开启
第一种查看方式：通过查看 Web 页面源代码，开启前端对抗防护页面，将会在 Web 返回代码中添加如下内容：
![](https://main.qcloudimg.com/raw/bb0b8249055db672de91b1d42348e9c5.png)
查询到该内容，说明该页面已经支持前端对抗防护。
第二种查看方式：通过 curl 访问域名，查看返回内容为不可读页面。
![](https://main.qcloudimg.com/raw/07f9df5d0919f2874a004a5dcf2afd2a.jpg)
第三种查看方式（针对已经开启页面防调试）：通过试用浏览器的开发者根据查看页面，以下以 Chrome 浏览器为例，出现如下提示：
 ![](https://main.qcloudimg.com/raw/e77572f5f3b51d3e72cf14d8072e7589.png)
说明页面防调试功能已经启用。
4、查看前端对抗防护攻击日志
BOT 行为管理前端对抗攻击日志属于 BOT 拦截日志的一部分，可以通过查看 BOT 拦截日志进行查看。
在左侧导航栏中，选择【日志服务】>【攻击日志】，进入“日志查询”页签，选择攻击类型为：Bot 拦截，attack_content 格式为：BOT 类型：xx，BOT 行为：xx 的日志为前端对抗防护产生的攻击日志。（如：BOT 类型：WebDriver，BOT 行为：重放攻击）。
![](https://main.qcloudimg.com/raw/0d6d9abda8cc83f42b8a90f00e413177.png)
>?
>- BOT 类型包括：PhantomJS、WebDriver、AppScan、AWVS、LoadRunner、WebInspect、NetSparker、   RSAS、UFT_QTP、HeadlessChrome、NODEJS,HouYiCaiJi等。
>- BOT 行为包括：非法客户端、令牌篡改、简单脚本攻击、重放攻击、无效请求头等。
>
5、设置前端对抗白名单
指定请求白名单和响应白名单，对不需要进行前端对抗防护页面进行加白，或对可能有兼容性问题的页面进行加白处理。
请求白名单，加白网站RUL页面不需要进行动态安全检测；
响应白名单，默认WAF会根据业务情况对响应页面插入JS，可指定页面不插入JS，提高网站兼容性。
在前端对抗页面，开启防护开关，选择【白名单】进行白名单设置
 ![](https://main.qcloudimg.com/raw/70b9c0045137cabbc635f1bdaa3c92d4.png)
点击【添加规则】进入白名单规则添加页面。
![](https://main.qcloudimg.com/raw/cafca9b73af23f773f10dff0b6d7b2b7.png)
**字段说明：**
 - **类型：**默认为请求白名单，用户可选择设置响应白名单。
 - **匹配条件：**支持路径后缀匹配、前缀匹配、相等和包含，默认为：路径后缀匹配
 - **匹配内容：**当匹配条件为【路径后缀匹配】，默认给出需要加白的文件后缀名称，包括：ico、gif、bmp、htc、jpg、jpeg、png、tiff、swf、js、css、rm、rmvb、wmv、avi、mkv、mp3、mp4、ogg、wma、zip、exe、rar、eot、woff、woff2、ttf、svg。您可以根据实际情况进行修改。
 - 输入其他匹配条件，请按照实际情况输入白名单路径。
 - **规则描述：**输入规则描述信息。
 - **规则开关：**默认开启，您可根据实际情况调整。
 - 完成白名单规则添加后，您可以在白名单规则管理页面，进行启停、删除等操作。
 ![](https://main.qcloudimg.com/raw/8c200356444688c60cdf442db685e8e9.png)
