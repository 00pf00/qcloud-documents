## 现象描述
在配置高防 IP 专业版的情况下，客户端进行访问，长时间加载不成功且返回502的错误码。

## 常见原因一：高防回源 IP 被源站拦截或限速
### 问题分析
在配置高防 IP 专业版后，源站上所有访问流量都先被牵引到高防 IP 再回到源站，因此对于源站而言，所有访问都是来自回源 IP。但由于高防的回源 IP 数量有限，每个回源 IP 对源站都会产生较高的请求量。如果源站配置了 DDoS 攻击防护、访问控制或限流限速等限制策略，回源 IP 的频繁访问有一定概率会触发此类限制策略从而导致回源 IP 的请求被限速甚至拦截。

### 排查步骤
>? 排查过程中，建议先暂时关闭 CC 防护，否则部分操作可能触发 CC 防护影响排查结果。

1. 使用第三方拨测平台（如：boce.com 、17ce）分别对源站和高防 IP 进行 http 类型的拨测，对比源站和高防 IP 的访问情况，如果源站正常、高防大范围异常则进行下一步判断。
2. 使用压测工具（如ab，webbench）进行压测，如果源站正常、高防大范围异常则基本可以判断属于该原因导致。

### 解决方法
在源站的防火墙、Web 应用防火墙、IPS入侵防护系统、流量管理等硬件设备上设置白名单策略，将源站的主机防火墙和其他任何安全类的软件（如安全狗等）的防护功能关闭或设置白名单策略，确保高防的回源 IP 不受源站安全策略和限速策略的影响。

## 常见原因二：源站本身异常，导致响应高防的请求超时
### 问题分析
1. 源站 IP 暴露，被恶意攻击导致瘫痪。
2. 源站服务器机房物理故障。
3. 源站服务器中 Apache、Nginx 等 Web 程序出现问题。
4. 服务器内存、CPU 占用过高，导致性能骤降。
5. 源站上行链路拥挤阻塞。

### 排查步骤
1. 修改本地 hosts 文件，将域名直接指向源站 IP。进行本地访问测试，若访问异常同时出 ping、telnet 丢包超时等现象，可判断为属于此类原因导致。用户可根据实际情况开展第2 - 4项排查工作。
2. 查看源站服务器的相关监控，各项进程状态，CPU/内存的使用率、带宽的使用率等情况。如有异常，联系负责源站的相关技术人员或机房负责人员协助排查问题。
3. 查看源站流量、请求量是否大幅增长，同时对比 [DDoS防护（大禹）管理控制台](https://console.cloud.tencent.com/dayu/overview) 中的 [统计报表](https://cloud.tencent.com/document/product/1005/30859)。如果源站遭到大流量攻击，但 [统计报表](https://cloud.tencent.com/document/product/1005/30859) 显示无异常，则可能是攻击流量绕过高防 IP 直接攻击源站。这种情况，请参考最佳实践相关章节进行处理。
4. 当确认服务无异常时，向腾讯云提交工单详细说明（异常时间点、受影响的域名、IP 等信息），腾讯云售后技术支持团队会对比相关日志协助您进行排查。

## 常见原因三：网络出现抖动或链路故障
### 问题分析
个别的地域偶发性出现抖动现象也可能导致502错误。
### 排查步骤
1. 使用第三方拨测工具（例如boce.com）进行网络质量的检测和监控。
2. 向腾讯云提交工单详细说明地域、运营商等情况，售后团队会为您提供相应的链路质量监控情况。
