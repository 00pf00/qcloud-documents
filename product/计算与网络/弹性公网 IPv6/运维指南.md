## 操作场景
本文将为您提供云服务器的 IPv6 连通性问题的基本排障思路

## 操作步骤
首先通过如下三个步骤检查云服务器是否已经完成 IPv6 配置：
1. 执行如下命令，查看云服务器的网卡（通常是 eth0）是否已经获取到“2402”开头的 IPv6 地址（不是“fe80”开头的地址）。
```
ifconfig
```
![](https://main.qcloudimg.com/raw/8493e3bb2d5f2276527bf89e5c8907c5.png)
2. 执行如下命令，查看网卡的默认路由。
```
ip -6 route show
```
![](https://main.qcloudimg.com/raw/15d7674f6f537671357a05c0fb5d9f59.png)
通过`ping6 240c::6666`或者`ping -6 240c::6666`来测试公网连通性。
![](https://main.qcloudimg.com/raw/01f56c86f25d721f2849b80061046c82.png)
<span id="step3" />3. 执行如下命令，确认是否22端口和80端口都已经监听了 IPv6。
```
netstat - tupln
```
![](https://main.qcloudimg.com/raw/9413dc799785105dfe493433c25f409e.png)


## 解决思路
1. 如果通过 `ifconfig`，没有看到“fe80”开头的 IPv6 地址，则说明云服务器的 IPv6 没有打开。请参见 [快速入门-步骤5](https://cloud.tencent.com/document/product/1142/38130#.E6.AD.A5.E9.AA.A45.EF.BC.9A.E7.99.BB.E5.BD.95.E4.BA.91.E6.9C.8D.E5.8A.A1.E5.99.A8.EF.BC.8C.E5.BC.80.E5.90.AF-ipv6) ，选择您所需的镜像开启 IPv6 的方式重新配置，可以通过执行 `sysctl -a | grep ipv6 | grep disable` 来确认。

2. 如果通过 `ifconfig`，没有看到“2402”开头的 IPv6 地址，则有两种可能性：
 1. 控制台云服务器的弹性网卡没有分配 IPv6，解决方法是进入控制台的弹性网卡分配 IPv6，详情请参见 [弹性网卡申请与释放 IPv6 地址](https://cloud.tencent.com/document/product/1142/38140)。
。
 2. 云服务器内的 dhcpv6 相关配置没有配置好或者没有执行 `dhclient -6`。请登录云服务器：
    1. 执行如下命令，打开`/etc/sysconfig/network-scripts/`文件夹下的`ifcfg-eth0`文件。
```
vim /etc/sysconfig/network-scripts/ifcfg-eth0
```
    2. 按 “i” 切换至编辑模式，增加如下内容。
```
dhcpv6c=yes
```
![](https://main.qcloudimg.com/raw/b94f6655fde243174503b453ad046d9e.png)
    3. 按 “Esc”，输入 “:wq”，保存文件并返回，重启云服务器。

3. 如果已经获取到 IPv6 地址，但是无法 Ping 通公网，则可以通过 `ip -6 route show` 查看是否已经配置默认路由。如果看不到默认路由，则需要：
 1. 执行如下命令，打开`/etc/sysconfig/network-scripts/`文件夹下的`route6-eth0`文件。
```
vim /etc/sysconfig/network-scripts/route6-eth0
```
 2. 按 “i” 切换至编辑模式，增加如下内容。
```
default dev eth0
```
![](https://main.qcloudimg.com/raw/7638e594ef3b500f1219565e2c6f9097.png)
 3. 按 “Esc”，输入 “:wq”，保存文件并返回，重启网络服务或者重启云服务器。

4. 如果 IPv6 公网可以 Ping 通，但是无法通过22或者80端口来访问，则通常是 sshd 和 Nginx 等文件配置问题，需要修改 sshd 和 Nginx 配置，使22或者80等端口监听 IPv6。配置完成后：
  1. 依次执行如下命令，重启 sshd 和 Nginx 服务。
```
service sshd restart
service nginx restart
```
![](https://main.qcloudimg.com/raw/983a49105b07fd033556c5d876d2e11b.png)
  2. 通过执行 `netstat -tupln` 进行查看，可参见上文 [操作步骤第3步](#step3)。

 

 
