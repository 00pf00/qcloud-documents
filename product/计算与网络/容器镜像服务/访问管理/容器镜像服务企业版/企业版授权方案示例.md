本文将介绍如何通过 CAM 对子账户进行 TCR 相关资源的访问管理，包括具体的操作步骤以及常用的策略配置示例。

**说明：** TCR 控制台中部分功能需要外部权限，不属于 TCR 的权限策略范围。包括私有网络、云审计、云标签等。具体能支持哪些 API 功能请参见 [企业版接入 CAM 的 API 列表](https://cloud.tencent.com/document/product/1141/41418)。
## 操作步骤
1. 登录 [访问管理 CAM](https://cloud.tencent.com/product/cam)，点击【立即使用】。
2. 选择左侧导航栏的【策略】。
3. 查看列表中已有的策略（包含 **预设策略** 和 **自定义策略**），点击最右列的【关联用户/组】为子用户添加所需的权限策略。
![](https://main.qcloudimg.com/raw/ded2b509ae7728580f3c1df0e5c9c807.png)
4. 若现有策略无法满足需求，点击【新建自定义策略】创建策略。
![](https://main.qcloudimg.com/raw/8b3a589a97cbcda52b5844a2cda3b433.png)
5. 选择【按策略生成器创建】。

接下来，以“授权子账号只读某个镜像仓库”为例：

1. 点击【按策略生成器创建】
2. 【效果（Effect）】选择【允许】
3. 【服务（Service）】选择【容器镜像服务（tcr）】
4. 【操作（Action）】选择【读操作】—— 点击【确定】
5. 【资源（Resource）】选择【特定资源】
- 点击【instance】的【添加资源六段式】— 在【地域】处选择仓库所属地域 — 在【资源】处填写该仓库所属实例的实例id（/$instanceid/\*，如：tcr-xxxxxxxx/*）
![](https://main.qcloudimg.com/raw/ca6395b5253bc43905ced500d8cc1621.png)
- 同理，再点击【repository】的【添加资源六段式】— 在【地域】处选择仓库所属地域 — 在【资源】处填写仓库的资源路径（/$instanceid/$namespacename/$repositoryname/\*，如：tcr-xxxxxxxx/team-01/repo-demo/*）
- 点击【确定】
6. 填写策略名称、描述 — 关联用户/用户组 — 点击【完成】即可
![](https://main.qcloudimg.com/raw/b97f9e55defda22c3dba730d9ba26a43.png)

## 常用策略配置

如图所示，上述的可视化策略生成器的策略内容可与 JSON 格式内容等价转化：
![](https://main.qcloudimg.com/raw/14322a0c129ce2f4a04b9135a23421bb.png)
因此也可以通过策略语法创建策略。

以下附上常用的 JSON 格式的策略配置：

（若需要自定义编辑策略 JSON，请参见 [企业版接入 CAM 的 API 列表](https://cloud.tencent.com/document/product/1141/41418) 以及 [策略语法](https://cloud.tencent.com/document/product/598/10596)。）

### 预设策略配置
- **QcloudTCRFullAccess**：容器镜像服务（TCR）全读写权限。
子账号绑定该策略后，将具有 TCR 全部资源的全部操作权限，包含企业版及容器服务 TKE 内的个人版。
```json
	{
		"version": "2.0",
		"statement": [{
			"action": [
				"tcr:*"
			],
			"resource": "*",
			"effect": "allow"
		}]
	}
```
- **QcloudTCRReadOnlyAccess**：TCR 只读权限。
子账号绑定该策略后，将具有容器镜像服务全部资源的只读权限，包含企业版及容器服务 TKE 内的个人版。
```json
	{
		"version": "2.0",
		"statement": [{
			"action": [
				"tcr:Describe*",
				"tcr:PullRepository*"
			],
			"resource": "*",
			"effect": "allow"
		}]
	}
```

### 典型场景策略配置
>!以下场景策略均只面向企业版使用场景。
>
- 授予子账号 TCR 企业版内全部资源的全读写操作权限。
```json
	{
		"version": "2.0",
		"statement": [{
			"action": [
				"tcr:*"
			],
			"resource": [
				"qcs::tcr:::instance/*",
				"qcs::tcr:::repository/*"
			],
			"effect": "allow"
		}]
	}
```
- 授予子账号 TCR 企业版内全部资源的只读操作权限。
```json
	{
		"version": "2.0",
		"statement": [{
			"action": [
				"tcr:Describe*",
				"tcr:PullRepository*"
			],
			"resource": [
				"qcs::tcr:::instance/*",
				"qcs::tcr:::repository/*"
			],
			"effect": "allow"
		}]
	}
```
- 授权子账号管理指定实例。例如 dev-guangzhou，其实例 ID 为 tcr-xxxxxxxx。
```json
	{
		"version": "2.0",
		"statement": [{
			"action": [
				"tcr:*"
			],
			"resource": [
				"qcs::tcr:::instance/tcr-xxxxxxxx/*"
			],
			"effect": "allow"
		}]
	}
```
- 授权子账号管理指定实例内的指定命名空间。例如实例 tcr-xxxxxxxx 下 team-01。
```json
	{
		"version": "2.0",
		"statement": [{
				"action": [
					"tcr:*"
				],
				"resource": [
					"qcs::tcr:::repository/tcr-xxxxxxxx/team-01/*"
				],
				"effect": "allow"
			},
			{
				"action": [
					"tcr:DescribeInstance*"
				],
				"resource": [
					"qcs::tcr:::repository/tcr-xxxxxxxx/*"
				],
				"effect": "allow"
			}
		]
	}
```
- 授权子账号只读某个镜像仓库，仅能拉取该仓库内镜像，无法删除仓库、修改仓库属性及推送镜像。例如实例 tcr-xxxxxxxx 下 team-01 命名空间内的 repo-demo。
```json
	{
		"version": "2.0",
		"statement": [{
				"action": [
					"tcr:DescribeRepositories",
					"tcr:PullRepository",
					"tcr:DescribeNamespaces"
				],
				"resource": [
					"qcs::tcr:::repository/tcr-xxxxxxxx/team-01/repo-demo/*"
				],
				"effect": "allow"
			},
			{
				"action": [
					"tcr:DescribeInstance*"
					
				],
				"resource": [
					"qcs::tcr:::instance/tcr-xxxxxxxx/*"
				],
				"effect": "allow"
			}
		]
	}
```
