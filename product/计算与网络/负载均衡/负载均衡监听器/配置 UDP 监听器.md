## UDP 监听器简介
您可以在负载均衡实例上添加一个 UDP 监听转发来自客户端的 UDP 协议请求。UDP 协议适用于对传输效率要求高、对准确性要求相对较低的场景，如即时通讯、在线视频等。
UDP 协议的监听器，后端服务器可直接获取客户端的真实 IP。
## 前提条件
您需要[创建负载均衡实例](https://cloud.tencent.com/document/product/214/6149)。

## 配置 UDP 监听器
### 步骤一：打开监听器管理页面
1. 登录[负载均衡控制台](https://console.cloud.tencent.com/clb)。
2. 在左侧导航栏，选择【实例】。
3. 在实例列表页点击需配置的实例ID，进入实例详情页，而后点击【监听器管理】页；您也可以在列表页的“操作”中点击【配置监听器】。
![](![](https://main.qcloudimg.com/raw/eb7ba0cb3e0eff749370c6f9ddfe99c7.png)
4. 【监听器管理】页面截图如下。
![](https://main.qcloudimg.com/raw/64d334042ae0577fe7858d38ec55ea94.png)

### 步骤二：配置监听器
在 TCP/UDP/TCP SSL 监听器下，单击【新建】按钮，在弹出框中配置 UDP 监听器。
#### 1. 基本配置
| 监听器基本配置    | 说明                    | 示例                              |
| ------- | ------------------------ | ---------------------------------------- |
| 名称 | 监听器的名称 | test-udp-8000 |
| 监听协议端口 | 监听器的协议和监听端口。<br>- 监听协议：CLB支持的协议包括 TCP、UDP、TCP SSL、HTTP、HTTPS，本例选择 UDP；<br> - 监听端口：用来接收请求并向后端服务器转发请求的端口，端口范围为 `1-65535`；<br> - 同一个负载均衡实例内，监听端口不可重复。| UDP:8000 |
| 均衡方式 | UDP监听器中，负载均衡支持加权轮询（WRR）和加权最小连接数（WLC）两种调度算法。 <br> - 加权轮询算法：根据后端服务器的权重，按依次将请求分发给不同的服务器。加权轮询算法根据 **新建连接数** 来调度，权值高的服务器被轮询到的次数（概率）越高，相同权值的服务器处理相同数目的连接数。<br>- 加权最少连接数：根据服务器当前活跃的连接数来估计服务器的负载情况，加权最小连接数根据服务器负载和权重来综合调度，当权重值相同时，当前连接数越小的后端服务器被轮询到的次数（概率）也越高。| 加权轮询 |

配置截图如下：
![](https://main.qcloudimg.com/raw/b0c23849638448197fd7e688a4cfa792.png)

#### 2. 健康检查
| 健康检查配置    | 说明                    | 示例                                |
| ------- | ------------------------ | ---------------------------------------- |
| 健康检查状态 | 开启或关闭健康检查。UDP 监听器中，负载均衡实例向服务器发 Ping 进行健康检查。 | 开启 |
| 响应超时 | - 健康检查响应的最大超时时间。<br> - 如果后端云服务器在相应时间内没有正确响应，则判定为健康检查异常。<br> - 可配置范围：2 - 60秒，默认值 2秒 | 2s |
| 检测间隔 | - 负载均衡进行健康检查的时间间隔。<br> - 可配置范围：5 - 300秒，默认值 5秒。 | 5s |
| 不健康阈值 | - 如果连续 n 次（n 为填写的数值）收到的健康检查结果失败，则识别为不健康，控制台显示为【异常】。<br> - 可配置范围：2 - 10次，默认值 3次。 | 3次 |
| 健康阈值 | - 如果连续 n 次（n 为填写的数值）收到的健康检查结果为成功，则识别为健康，控制台显示为【健康】。<br> - 可配置范围：2 - 10次，默认值 3次。  | 3次 |

配置截图如下：
![](https://main.qcloudimg.com/raw/a0702161be35d98739e0804519227f5d.png)

#### 3. 会话保持
| 会话保持配置    | 说明                    | 示例                                |
| ------- | ------------------------ | ---------------------------------------- |
|会话保持状态 | 开启或关闭会话保持。<br>- 开启会话保持后，负载均衡监听会把来自同一客户端的访问请求分发到同一台后端服务器上。<br> - UDP 协议是基于客户端 IP 地址的会话保持，即来自同一 IP 地址的访问请求转发到同一台后端服务器上。 <br> - 加权轮询调度支持会话保持，加权最小连接数调度不支持开启会话保持功能。 | 开启 |
| 会话保持时间 | 会话保持时间。<br> - 当超过保持时间，连接内无新的请求，将会自动断开会话保持。<br> - 可配置范围 30 - 3600秒。 | 30s |

配置截图如下：
![](https://main.qcloudimg.com/raw/e803d6b999d5beb41d21ecb74cfb6d80.png)

### 步骤三：绑定后端云服务器
1. 在【监听器管理】页面，【单击】已创建完毕的监听器，如上述 `UDP:8000` 监听器，即可在监听器右侧查看【已绑定云服务器】。
![](https://main.qcloudimg.com/raw/b045afa540991a2eef9c62238036ac4d.png)
2. 点击【绑定】按钮，在弹出框中选择需绑定的后端服务器，并配置服务端口和权重。
（1）添加端口功能：在右侧【已选择】云服务器框内，单击【添加端口】，即可添加同一个云服务器的多个端口，如同时添加 CVM 的 80、81、82 三个端口。
（2）默认端口功能：先填写【默认端口】，再选择云服务器，每台云服务器的端口均为默认端口。
![](https://main.qcloudimg.com/raw/e5fef75672df28af623a0c0107c9bb96.png)

完成步骤一到步骤三之后，UDP 监听器规则已配置完毕，配置详情如下：
![](https://main.qcloudimg.com/raw/481b6fa044f01010d592430f18a847fd.png)

### 步骤四：安全组（可选）
您可以配置负载均衡的安全组来进行公网流量的隔离，详情可参见[配置负载均衡安全组](https://cloud.tencent.com/document/product/214/14733)。

### 步骤五：修改/删除监听器（可选）
如果您需要修改或删除已创建的监听器，请在【监听器管理】页面，【单击】已创建完毕的监听器，选择【编辑】或【删除】来完成操作。
![](https://main.qcloudimg.com/raw/9f8ba60aa36fef931df8776c748e107c.png)
