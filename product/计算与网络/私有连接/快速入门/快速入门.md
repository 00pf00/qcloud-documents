本文指导您如何快速创建私有连接服务，将您 VPC 中部署的云服务共享给同地域同账号下其他 VPC 访问。

## 背景信息
VPC 是您独有的云上私有网络，不同 VPC 之间默认完全隔离。您可以通过私有连接（Private Link）服务，实现腾讯云 VPC 与其他 VPC 上安全稳定的访问连接，简化网络架构，避免公网访问服务带来的潜在安全风险。

使用 Private Link 建立连接，您需要创建终端节点和终端节点服务。在创建终端节点服务之前，您需要创建一个内网4层负载均衡实例，并创建监听器关联已经部署业务的云服务器实例，之后在创建终端节点服务时关联该负载均衡实例，此时终端节点服务将作为服务提供方的业务访问入口，供服务使用方创建的终端节点来申请连接，连接建立成功后，服务使用方即可访问服务提供方的部署业务服务。

## 场景示例
本文以下图业务场景为例。某公司业务分布在两个私有网络：VPC1 和 VPC2，因业务发展，公司在 VPC2 中部署了相关服务资源，且希望将 VPC2 中的业务共享给 VPC1 进行访问。为避免公网访问带来的潜在安全风险，使用腾讯云私有连接 Private Link 来实现 VPC1 到 VPC2 的安全内网访问方案。
![](https://main.qcloudimg.com/raw/ea85a1293c108267f16d95b84cba8e9f.png)

## 前提条件
+ 您已注册腾讯云账号，并已创建服务提供方 VPC2 和服务使用方 VPC1，具体可参见 [创建私有网络](https://cloud.tencent.com/document/product/215/36515)。
+ 在服务提供方 VPC2 中已创建内网4层 CLB 实例，并在 CLB 后端云服务器实例中部署相关服务资源，请确保后端云服务器实例可以正常处理负载均衡转发的请求，具体请参见 [负载均衡快速入门](https://cloud.tencent.com/document/product/214/8975)。
+ 为保证服务使用方能够正常访问腾讯云公共业务，例如 MySQL，**请确保服务提供方 VPC2 中负载均衡后端云服务器关联的安全组已放通11.163.0.0/16地址段**，具体可参见 [添加安全组规则](https://cloud.tencent.com/document/product/215/39790)，如下图所示。   
	<img src="https://main.qcloudimg.com/raw/0462ab7efa311e9fb253e147628e2f7a.png" width="80%" />

## 操作步骤

### 步骤1：服务提供方创建终端节点服务
>?本例中服务提供方 VPC2 中已创建4层内网 CLB，CLB 后端云服务器实例已部署相关业务服务，且云服务器实例安全组已放通11.163.0.0/16网段。
>
1. 登录 [私有网络控制台](https://console.cloud.tencent.com/vpc/vpc?rid=16)。
2. 在左侧导航栏单击【私有连接】>【终端节点服务】。
3. 单击【新建】，在弹出的新建终端节点服务界面，配置相关参数。
![](https://main.qcloudimg.com/raw/ba71a7ede78ba2e2e8c41a3b47659805.png)
参数说明如下：
 - 服务名称：自定义终端节点服务的名称。
 + 所在地域：终端节点服务所在地域。
 + 所属网络：选择所属 VPC，本例选择 VPC2。
 + 负载均衡：选择 VPC 下已创建的负载均衡，本例选择 VPC2 中已创建好的 CLB 实例。
 + 自动接受：指定终端节点服务是否自动接受终端节点发起的连接请求，默认为否，此处和白名单策略结合使用，遵循如下原则：
	 + 如果是同账号，则默认自动加入白名单列表，而无论此处选择是或者否，系统都认为是自动接受，终端节点创建成功即为可用状态。
	 + 如果是跨账号，选择【是】自动接受时，且终端节点在用户白名单中，终端节点创建成功即为可用状态。
	 + 如果是跨账号，选择【否】不接受自动连接时，终端节点创建成功的初始状态为【待接受】，需等服务方接受后方可变更为可用。
<table>
<tr>
<th>名称</th>
<th>描述</th>
</tr>
<tr>
<td>服务名称</td>
<td>自定义终端节点服务的名称。</td>
</tr>
<tr>
<td>所在地域</td>
<td>终端节点服务所在地域。</td>
</tr>
<tr>
<td>所属网络</td>
<td>选择所属 VPC，本例选择 VPC2。</td>
</tr>
<tr>
<td>负载均衡</td>
<td>选择 VPC 下已创建的负载均衡，本例选择 VPC2 中已创建好的 CLB 实例。</td>
</tr>
<tr>
<td>自动接受</td>
<td>指定终端节点服务是否自动接受终端节点发起的连接请求，默认为否，此处和白名单策略结合使用，遵循如下原则：<ul><li>如果是同账号，则默认自动加入白名单列表，而无论此处选择是或者否，系统都认为是自动接受，终端节点创建成功即为可用状态。</li><li>如果是跨账号，选择【是】自动接受时，且终端节点在用户白名单中，终端节点创建成功即为可用状态。</li><li>如果是跨账号，选择【否】不接受自动连接时，终端节点创建成功的初始状态为【待接受】，需等服务方接受后方可变更为可用。</li></ul></td>
</tr>
</table>


4. 完成参数设置后，单击【确定】完成终端节点服务的创建。

### 步骤2：服务使用方创建终端节点
1. 在左侧导航栏单击【终端节点】。
2. 单击【新建】，在弹出的新建终端节点界面，配置相关参数。
![](https://main.qcloudimg.com/raw/b1f3248237098a9f197f2519e7b3d8e7.png)
	参数说明如下：
	+ 名称：自定义终端节点的名称。
	+ 所属地域：终端节点所在地域。
	+ 所属网络：选择终端节点所在的 VPC，本例选择 VPC1。
	+ 所属子网：选择终端节点所在的子网。
	+ IP 地址：终端节点的 IP 地址。可以指定 IP 地址，IP 地址为 VPC1 内的内网 IP，也可以选择自动分配 IP。
	+ 对端账户类型：选择需要访问的 VPC 的所属账户，【我的账户】说明是同账户 VPC 的访问，【其他账户】说明是跨账户 VPC 的访问，本例选择【我的账户】。
>?如果是跨账户，则需要将本账户的账号告知对端账户，且发起连接请求后，需要服务端接受后才可联通。
>
    + 选择服务：输入终端节点服务的 ID 后单击【验证】，只有验证通过的服务才可建立连接。例如，终端节点服务 ID 如下图所示。
     <img src="https://main.qcloudimg.com/raw/073830696e0fad180b42c43155d0356a.png" width="50%" />
3. 完成参数配置后，单击【确定】。


### 步骤3：服务使用方发起访问请求进行连接验证
1. 登录服务使用方 VPC1 下的某台 CVM，通过 VIP+VPORT 访问服务提供方的后端服务。
2. 本例使用 telnet 验证连通性，执行 telnet *VIP VPORT*。
<dx-alert infotype="explain" title="">
如果服务器没有安装 telnet，请先执行 `yum install telnet` 安装 telnet。
</dx-alert>
获取终端节点 VIP：<br>
<img src="https://main.qcloudimg.com/raw/e05b372a650e384513261bf66757d58c.png" width="70%"><br>
获取 CLB 的 VPORT：<br>
<img src="https://main.qcloudimg.com/raw/922dc796b2d687354a355ab6fe845437.png" width="70%" /><br>
如果出现如下信息，表示已连接：<br>
<img src="https://main.qcloudimg.com/raw/546f1f75ba5fbb61bf80be0f8ead6363.png" width="50%" />

