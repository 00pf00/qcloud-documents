## 按实际运行时长进行计算

当前云函数的资源用量，按照函数的配置内存乘以触发时的实际运行时长进行计费，相较于向上对齐 100ms 计费的方式，总体资源用量更低，产生的费用更低。

### Web & API Service

web 服务或 API 请求，代码的实际运行时间通常仅 30~50 ms；按实际运行时长计费，优惠程度可达到 70% 。

案例：A 用户使用云函数及 API 网关构成的某个 API 服务，配置了 128MB 的函数，平均执行时间在37ms。原计算方案中，函数的计费时长为 100ms，在每天 100 万次调用的情况下会产生 12500 GBs 的资源用量；使用按实际运行时长计费的方案，产生的资源用量为 4625 GBs，降低程度达 63%。

### 消息处理

针对消息队列中的消息进行过滤、转换、转发，代码的实际运行时长通常仅 60~80ms；按实际运行时长计费，优惠程度可达 40% 。

案例：B 用户使用 Ckakfa 的消息触发云函数，并将完成过滤及数据格式转换的消息重新投递 Ckafka，配置了 256MB 的内存，平均运行时长在 67ms。原有的计算方案，在每天 500 万次调用的情况下会产生 125000 GBs 的资源用量；而按实际运行时长计费，产生的资源用量为 83750 GBs，降低程度达 37%。


### 事件转发

将对象存储的事件转发至下游系统，代码的实际执行时间通常仅50~80ms；按实际运行时长计费，优惠程度可达50%。

案例：C 用户使用云函数将 ÇOS 对象存储的文件上传事件转发至自身的文件处理系统中，配置了128MB 内存，函数的平均运行时长在 43ms。原有的计算方式，在每天有 20 万文件上传的情况下，会产生2500GBs 的资源用量；而按照实际运行时长计费，产生的资源用量为 1075 GBs，降低程度达 57%。


## Web & API 服务示例

假设函数配置了 API 网关，通过 URL 请求触发函数运行，每天有 10 万次请求；云函数配置了 128MB 内存，每次处理请求的平均运行时间为 70 ms。

每天的资源使用量及调用次数如下：
- 每天的资源使用量 : （128/1024） x （70/1000） x 100000 = 875 GBs。
- 每天的调用次数 : 100000 次。

按月 30 天计算费用如下：
- 资源使用月费用 : 875 x 30 = 26250 GBs； 小于 40 万 GBs，不产生费用。
- 调用次数月费用 : (100000 x 30 / 10000 - 100) x 0.0133 = 2.66 元。

## 消息队列触发示例

假设函数配置了 Ckafka 触发方式，每秒触发函数 3 次，配置云函数使用了 128MB 内存，将消息处理后放入处理后的消息队列，每次处理消息，函数运行时间为 260 ms。

每天的资源使用量及调用次数如下：
- 每天的资源使用量： （128/1024） x （260/1000） x 3 x 3600 x 24 = 8424 GBs。
- 每天的调用次数： 3 x 3600 x 24 = 259200 次。

按月30天计算费用如下：
- 资源使用月费用： 8424 x 30 = 252720 GBs；小于 40 万 GBs，无费用产生。
- 调用次数月费用: ( 259200 x 30 / 10000 - 100 ) x 0.0133 = 9.01 元。

在这种情况下，总花费为：调用次数费用 9.01 元。


## 外部文件上传示例

假设函数由用户使用云 API 直接调用，每分钟调用50次，配置了云函数使用256MB内存，函数每次生成一个 1KB 大小的文件并上传至用户自建的外部站点上，每次生成及上传，函数运行时间为 780 ms。

每天的资源使用量及调用次数如下：
- 每天的资源使用量： （256/1024）x (780/1000) x 50 x 60 x 24 = 14040 GBs。
- 每天的调用次数： 50 x 60 x 24 = 72000 次。
- 每天的流量： 1 x 50 x 60 x 24 = 72000 KB = 70.31 MB。

按月30天计算费用如下：
- 资源使用月费用： (14040 x 30 - 400000) * 0.00011108  = 2.35 元。
- 调用次数月费用： （72000 x 30 / 10000 - 100）* 0.0133 = 1.54 元。
- 外网出流量费用： （70.31 x 30 / 1024） x 0.8 = 1.65 元。

在这种情况下，总花费为：资源使用费用 2.35 元 + 调用次数费用 1.54 元 + 外网出流量费用 1.65 元 =  5.54 元。
