

按量计费实例和竞价实例混合的伸缩组可以帮助您优化云服务器 CVM 的使用成本，同时确保您可获得所需的规模和性能。您可通过下功能，了解并开始使用按量计费实例和竞价实例混合的伸缩组：

- 使用 [竞价实例回收监测](#auctionInstanceMonitoring) 主动监控中断通知，在系统触发回收前正常退还竞价实例，以降低竞价实例中断给业务带来的影响。
- [控制伸缩组内按量计费实例与竞价实例的数量及配比](#controlQantityRatio)。
- 指定竞价实例创建策略：
  - 通过 [容量优化策略（推荐）](#capacityOptimizationStrategy)最好的利用竞价实例资源，在尽最大努力减少中断可能性的前提下，降低总体资源使用成本。
  - 通过 [成本优化策略](#costOptimizationStrategy) 最大化节约成本。
- 通过 [添加缩容生命周期挂钩](#addLifecycleHook) 在退还实例前执行所需操作。



## 功能介绍

### 竞价实例回收监测[](id:auctionInstanceMonitoring)

[竞价实例](https://cloud.tencent.com/document/product/213/17816) 是可供您使用的折扣售卖的 CVM 计算资源，目前以按量计费实例刊例价的2折售卖。与按量计费实例不同的是，当 CVM 资源紧张时，竞价实例将会被中断回收。CVM 将会在回收前2分钟发出中断通知，您可参考 [查询竞价实例回收状态](https://cloud.tencent.com/document/product/213/37970) 获取竞价实例中断信息。
>?启用竞价实例回收监测能够帮助您减少竞价实例中断带来的风险，但您仍会面对竞价实例的中断特性带来的风险，建议避免在竞价实例上运行对稳定性要求极高的服务。


弹性伸缩的竞价实例回收监测功能为管理竞价实例生命周期提供了自动化体验，建议您在创建伸缩组时启用竞价实例回收监测。
- **启用竞价实例回收监测**：
会为您主动查询竞价实例中断通知，在实例中断前自动尝试将其替换为新的实例，帮助您保持伸缩组内的按量计费实例与竞价实例数量比，从而保持工作负载可用性。
除主动替换竞价实例来维持伸缩组容量平衡之外，还支持通过正常退还过程将竞价实例从伸缩组中移除。只要查询到竞价实例中断通知，弹性伸缩便立即发起退还流程，退还即将被回收的实例，同时尝试使用新的实例主动替换。
>!
>- 如果弹性伸缩监测到竞价实例中断通知时有扩容活动正在进行，则会先完成扩容活动再创建用来替换被回收实例的新实例。
>- 如果您需要在退还实例前执行所需操作，可使用缩容活动类型的生命周期挂钩。
- **不开启竞价回收监测**
弹性伸缩会在竞价实例中断，且发现健康检查失败后再进行替换。


### 控制按量计费与竞价实例的数量及配比[](id:controlQantityRatio)

创建伸缩组时您可以指定伸缩组内按量实例和竞价实例的配比，以及基础数量的按量计费实例。示意图如下：
<img src="https://main.qcloudimg.com/raw/424e235af953a076081ef05a9c6ebfd2.png" width="70%">

#### 指定按量计费基础实例数
按量计费基础实例数是伸缩组内按量计费实例必须满足的最小数量。如果指定按量计费基础实例数，伸缩组将确保在扩容时首先创建此部分的实例。

#### 指定按量计费实例百分比
计算超出按量计费基础实例数的部分，再根据按量计费实例百分比来确定要创建的按量计费实例和竞价实例的数量。您可以指定0到100间的任意比例。

#### 开启按量计费实例补充竞价容量
若开启按量计费实例补充竞价容量，当您在启动配置中所选机型对应的竞价实例库存不足时，弹性伸缩将为您尝试创建机型对应的按量计费实例。
>?若启用该功能，则伸缩组内按量计费实例与竞价实例的配比将无法严格控制。


### 指定竞价实例创建策略
弹性伸缩的竞价实例创建策略可帮助您以最佳的方式最有效地利用竞价资源，同时仍能利用竞价实例提供的大幅折扣，是一种让您获得优化使用计算资源成本的策略。弹性伸缩提供了以下可用于竞价实例创建的策略：

#### 容量优化策略（推荐）[](id:capacityOptimizationStrategy)
弹性伸缩优先选择最可用的竞价实例机型，以这种方式扩容可帮助您最好的利用竞价实例资源。容量优化策略可在减少中断可能性的前提下，降低总体资源使用成本。示意图如下：
<img src="https://main.qcloudimg.com/raw/6f44189847a6ed8533e9d6b03a3ea7eb.png" width="70%">
此种分配策略适用于：
- 大数据和分析
- 高性能计算
- 图像和媒体渲染
- 机器学习等中断成本高的业务

#### 成本优化策略[](id:costOptimizationStrategy)
弹性伸缩优先选择单核价格最低的竞价实例机型，将从您指定的可用区中分配您的实例，以这种方式扩容可帮助您最大程度节约成本。
成本优化策略适用于需中断成本低，及尽可能缩减计算资源使用成本的业务。例如：
- 时间不敏感的业务负载
- 极其短暂的工作负载
- 易于添加检查点和重新启动的业务（使用检查点可帮助您确保业务以可靠、可预测的方式运行）


### 添加缩容生命周期挂钩[](id:addLifecycleHook)
您可以在启用竞价实例回收监测的同时配置缩容活动的生命周期挂钩，配置后即可在弹性伸缩主动退还竞价实例前对其执行自定义操作。如需了解更多信息，请参见 [生命周期挂钩](https://cloud.tencent.com/document/product/377/34924)。
>!如果伸缩组已绑定负载均衡，则弹性伸缩会在实例与负载均衡解绑后调用生命周期挂钩执行自定义操作。
>
使用缩容活动的生命周期挂钩功能有机会在弹性伸缩释放实例前帮助您完成如下操作：
- 执行数据备份操作
- 将系统或业务日志上传到对象存储
- 平滑关闭 CMQ 工作线程
- 从域名系统注销

## 使用建议
弹性伸缩可帮助您获得业务实际所需的规模和性能，并以最合适的集群容量帮助您维护业务的可用性。弹性伸缩旨在支持灵活的工作负载，并自动对容量的动态变化做出快速的响应。创建按量计费和竞价实例混合的伸缩组时，建议：
- 通过跨多个可用区运行多机型、多计费模式的方式部署业务，以增强可用性。
- 在启动配置中配置多机型，详情请参见 [多机型配置](https://cloud.tencent.com/document/product/377/37533)。由于每个可用区中每种机型的资源量独立不相关，若您配置了多机型，则可获得更多计算资源。
- 不要拘泥于最新一代的机型，可选择其他代次的机型，以降低成本和减少中断。
- 选择重试策略，弹性伸缩会不断尝试重新创建，以确保新实例无法创建或创建失败。
- 为进一步降低竞价实例中断可能性，推荐结合竞价实例回收监测功能、多机型配置、竞价实例分配策略（其中推荐容量优化策略）相结合使用。适用于可在 CVM 间快速迁移的业务，例如容器化工作负载、大数据和分析、图像和媒体渲染、批量处理、Web 应用等。
- 如果您需要在退还实例前执行自定义操作，则可使用缩容活动类型的生命周期挂钩。



## 操作指南
您可参考 [创建按量计费和竞价实例混合的伸缩组](https://cloud.tencent.com/document/product/377/59130)，前往弹性伸缩控制台开始使用该功能。

