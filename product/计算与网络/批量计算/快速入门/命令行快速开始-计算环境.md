## 一个使用计算环境的例子
本例介绍如何使用命令行来创建计算环境，然后向指定计算环境提交一个作业，最后销毁计算环境。

## 开始前的准备
开始前请根据文档 [开始前的准备](/doc/product/599/10807) 里的检查清单做好准备，同时本例将使用到命令行工具（CLI）和对象存储（COS），用户需要先安装和配置命令行工具以及创建一个 COS Bucket。

### 安装和配置命令行工具
安装和配置命令行工具请查看 [命令行工具 - 前置准备](/doc/product/599/10548) 里第一章节 **『安装腾讯云命令行工具 CLI』** 和第二章节 **『配置腾讯云命令行工具 CLI』**，安装完后检查下安装成功。
```
tccli batch help

NAME
        batch
DESCRIPTION
        batch-2017-03-12
USEAGE
        tccli batch <action> [--param...]
OPTIONS
        help
        show the tccli batch help info
        --version
        specify a batch api version
AVAILABLE ACTION
        DescribeComputeEnv
        用于查询计算环境的详细信息
        CreateTaskTemplate
        用于创建任务模板
```

### 创建保存结果的COS Bucket

这个简单例子里，结果直接输出到系统标准输出里，Batch 可以采集系统标准输出 stdout 和 stderr，并在任务结束后将信息上传到您指定的 COS Bucket 里，您需要提前准备好保存信息的 Bucket 和 子文件夹。

请参照 [命令行工具 - 前置准备](/doc/product/599/10548) 里第三章节 **『准备 COS 目录』**，创建对应 COS Bucket 和 子文件夹。


## 创建计算环境

您可以将官方提供的例子修改为在您的账号下可执行的 Batch 计算环境。在此之前，请先查看计算环境配置的各项含义。
您也可以参考 [创建计算环境](https://cloud.tencent.com/document/api/599/15891) 等计算环境相关接口。

```
tccli batch CreateComputeEnv --version 2017-03-12 --ComputeEnv '{
    "EnvName": "test compute env",          // 计算环境名称
    "EnvDescription": "test compute env",   // 计算环境描述
    "EnvType": "MANAGED",                   // 计算环境类型，托管型
    "EnvData": {                            // 具体配置（可参照 CVM 创建实例说明）
        "InternetAccessible": {
            "PublicIpAssigned": "TRUE",
            "InternetMaxBandwidthOut": 50
        },
        "LoginSettings": {
            "Password": "*****"             // 登录密码（需替换）
        },
        "InstanceType": "S1.SMALL1",        // CVM 实例类型
        "ImageId": "img-xxxxyyyy"           // CVM 镜像 ID（需替换）
    },
    "DesiredComputeNodeCount": 2            // 计算节点期望个数
}'
--Placement'{
    "Zone": "ap-guangzhou-2"                // 可用区（可能需替换）
}'
```


#### 请求示例
```
tccli batch CreateComputeEnv --version 2017-03-12  --ComputeEnv '{"EnvName": "test compute env", "EnvDescription": "test compute env", "EnvType": "MANAGED", "EnvData": {"InstanceType": "S1.SMALL2", "ImageId": "待替换", "LoginSettings": {"Password": "待替换"}, "InternetAccessible": {"PublicIpAssigned": "TRUE", "InternetMaxBandwidthOut": 50}, "SystemDisk": {"DiskType": "CLOUD_BASIC", "DiskSize": 50 } }, "DesiredComputeNodeCount": 2 }' --Placement '{"Zone": "ap-guangzhou-2"}'
```

#### 返回示例
返回值，其中 EnvId 为 Batch 计算环境的唯一标识。
```
{
    "EnvId": "env-jlatqfkn", 
    "RequestId": "297ed003-7373-4950-9721-242d3d40b3ca"
}
```

## 查看计算环境列表
#### 请求示例
```
tccli batch DescribeComputeEnvs --version 2017-03-12
```

#### 返回示例(部分已省略）
```
{
    "TotalCount": 1, 
    "ComputeEnvSet": [
        {
            "EnvId": "env-jlatqfkn", 
            "ComputeNodeMetrics": {
                ...
            }, 
            "EnvType": "MANAGED", 
            "DesiredComputeNodeCount": 2, 
            "EnvName": "test compute env", 
            "Placement": {
                ...
            }, 
            "CreateTime": "2019-10-08T08:55:12Z"
        }
    ], 
    "RequestId": "7a1f9338-0118-46bf-b59f-60ace9f154f5"
}
```


## 查看指定计算环境
#### 请求示例
```
tccli batch DescribeComputeEnv --version 2017-03-12 --EnvId env-jlatqfkn
```

#### 返回示例（部分已省略）
```
{
    "EnvId": "env-jlatqfkn", 
    "ComputeNodeMetrics": {
        ...
    }, 
    "EnvType": "MANAGED", 
    "DesiredComputeNodeCount": 2, 
    "ComputeNodeSet": [
        ...
    ], 
    "RequestId": "407de39c-1c3d-489e-9a35-5257ae561e87", 
    "Placement": {
        ...
    }, 
    "EnvName": "test compute env", 
    "CreateTime": "2019-10-08T08:55:12Z"
}
```

## 向指定计算环境提交任务
#### 请求示例
```
tccli batch SubmitJob --version 2017-03-12  --Job '{"JobName": "test job", "JobDescription": "xxx", "Priority": "1", "Tasks": [{"TaskName": "hello2", "TaskInstanceNum": 1,  "Application": {"DeliveryForm": "LOCAL", "Command": "python -c \"fib=lambda n:1 if n<=2 else fib(n-1)+fib(n-2); print(fib(20))\" "}, "EnvId": "待替换", "RedirectInfo": {"StdoutRedirectPath": "待替换", "StderrRedirectPath":  "待替换"} } ] }' --Placement '{"Zone": "ap-guangzhou-2"}'

```

#### 返回示例
```
{
    "RequestId": "d6903404-5765-474b-b516-39137456fa5a", 
    "JobId": "job-qjq3mqp7"
}
```

## 销毁计算环境
#### 请求示例
```
tccli batch DeleteComputeEnv --version 2017-03-12 --EnvId env-jlatqfkn
```

#### 返回示例
```
{
    "RequestId": "029becda-2a4e-4989-aa77-6fbb5a873555"
}
```

