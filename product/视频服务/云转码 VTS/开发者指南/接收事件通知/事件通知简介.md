### 事件通知定义
在腾讯云转码服务（VTS）中，事件是指文件在转码服务中的任务状态的变化。从最初的起始状态到最终转码任务结束，文件的任务状态会发生若干次变化。比如从起始的等待状态到处理中，然后进入各子任务处理阶段，最终以成功或失败结束。在全部事件中，对客户开放的部分事件称为“事件通知”。

### 事件通知类型
当前提供的事件通知如下：

| 事件类型     | 事件名称 | 含义 |
|:---------:|:---:|:---:|
| ProcedureStateChanged | ProcedureStateChangeEvent | 状态改变，具体状态参考事件内部Status字段。 一般为FINISH，表示任务完成（成功或失败）。|

### 事件通知方式

相较于传统的HTTP事件通知方式，基于消息队列的方式提供了更高的安全性，可靠性。因此，VTS选择了后者提供事件通知服务。

VTS服务使用腾讯云消息队列（CMQ）发送事件通知。客户在使用VTS服务时，需要同时开通CMQ服务并对VTS进行授权，以便接收转码任务事件通知。如果客户选择不开通CMQ或在工作流模板中不设置任何的事件通知CMQ队列地址，则客户不会收到来自VTS服务的任务事件通知。

需要指出的是，客户在使用腾讯云 API 拉取CMQ事件消息时，需要对每个消息进行确认，然后该消息才会被从CMQ中移除；否则客户会持续拉取到同一个事件消息。

### 事件通知示例

```
{
  "Response": {
    "EventSet": [
      {
        "EventHandle": "EventHandle1",
        "EventType": "ProcedureStateChanged",
        "FileUploadEvent": null,
        "ProcedureStateChangeEvent": {
          "TaskId": "1256768367-Procedure-475b7237438a39560b9879a4556cb177t1",
          "Status": "FINISH",
          "ErrCode": 0,
          "Message": "",
          "FileId": "5285890784246869930",
          "FileName": "small",
          "FileUrl": "https://123.vts2.myqcloud.com/d042887avtstransgzp1256768367/c643347c5285890784246869930/1546950643_4191274987.100_0.jpg",
          "MetaData": {
            "AudioDuration": 59.990001678467,
            "AudioStreamSet": [
              {
                "Bitrate": 383854,
                "Codec": "aac",
                "SamplingRate": 48000
              }
            ],
            "Bitrate": 1021028,
            "Container": "mov,mp4,m4a,3gp,3g2,mj2",
            "Duration": 60,
            "Height": 480,
            "Rotate": 0,
            "Size": 7700180,
            "VideoDuration": 60,
            "VideoStreamSet": [
              {
                "Bitrate": 637174,
                "Codec": "h264",
                "Fps": 23,
                "Height": 480,
                "Width": 640
              }
            ],
            "Width": 640
          },
          "MediaProcessResultSet": [
            {
              "Type": "Transcode",
              "TranscodeTask": {
                "Status": "SUCCESS",
                "ErrCode": 0,
                "Message": "SUCCESS",
                "Input": {
                  "Definition": 20,
                  "WatermarkSet": null
                },
                "Output": {
                  "Url": "http://123.vts2.myqcloud.com/d042887avtstransgzp1256768367/c643347c5285890784246869930/v.f20.mp4",
                  "Size": 4189073,
                  "Container": "mov,mp4,m4a,3gp,3g2,mj2",
                  "Height": 480,
                  "Width": 640,
                  "Bitrate": 552218,
                  "Md5": "eff7031ad7877865f9a3240e9ab165ad",
                  "Duration": 60.04700088501,
                  "VideoStreamSet": [
                    {
                      "Bitrate": 503727,
                      "Codec": "h264",
                      "Fps": 24,
                      "Height": 480,
                      "Width": 640
                    }
                  ],
                  "AudioStreamSet": [
                    {
                      "Bitrate": 48491,
                      "Codec": "aac",
                      "SamplingRate": 44100
                    }
                  ],
                  "Definition": 0
                }
              },
              "AnimatedGraphicTask": null,
              "SnapshotByTimeOffsetTask": null,
              "SampleSnapshotTask": null,
              "ImageSpriteTask": null,
              "CoverBySnapshotTask": null
            },
            {
              "Type": "CoverBySnapshot",
              "TranscodeTask": null,
              "AnimatedGraphicTask": null,
              "SnapshotByTimeOffsetTask": null,
              "SampleSnapshotTask": null,
              "ImageSpriteTask": null,
              "CoverBySnapshotTask": {
                "Status": "SUCCESS",
                "ErrCode": 0,
                "Message": "SUCCESS",
                "Input": {
                  "Definition": 10,
                  "PositionType": "Time",
                  "PositionValue": 0,
                  "WatermarkSet": null
                },
                "Output": {
                  "CoverUrl": "http://123.vts2.myqcloud.com/d042887avtstransgzp1256768367/c643347c5285890784246869930/1546950643_4191274987.100_0.jpg"
                }
              }
            }
          ],
          "AiContentReviewResultSet": null,
          "AiRecognitionResultSet": null
        },
        "FileDeleteEvent": null,
        "PullCompleteEvent": null,
        "EditMediaComplete": null,
        "WechatPublishComplete": null,
        "TranscodeCompleteEvent": null,
        "ConcatCompleteEvent": null,
        "ClipCompleteEvent": null,
        "CreateImageSpriteCompleteEvent": null,
        "SnapshotByTimeOffsetCompleteEvent": null
      },
      {
        "EventHandle": "EventHandle3",
        "EventType": "ProcedureStateChanged",
        "FileUploadEvent": null,
        "ProcedureStateChangeEvent": {
          "TaskId": "1256768367-procedurev2-49dfbaea6786dd78ecf70d6256c7ec20t0",
          "Status": "FINISH",
          "ErrCode": 0,
          "Message": "",
          "FileId": "5285890784273533167",
          "FileName": "small2",
          "FileUrl": "http://123.vts2.myqcloud.com/1c1ae5d2vtsgzp1256768367/9ce0cd925285890784273533167/q1BORBPQH1IA.mp4",
          "MetaData": {
            "AudioDuration": 59.990001678467,
            "AudioStreamSet": [
              {
                "Bitrate": 383854,
                "Codec": "aac",
                "SamplingRate": 48000
              }
            ],
            "Bitrate": 1021028,
            "Container": "mov,mp4,m4a,3gp,3g2,mj2",
            "Duration": 60,
            "Height": 480,
            "Rotate": 0,
            "Size": 7700180,
            "VideoDuration": 60,
            "VideoStreamSet": [
              {
                "Bitrate": 637174,
                "Codec": "h264",
                "Fps": 23,
                "Height": 480,
                "Width": 640
              }
            ],
            "Width": 640
          },
          "MediaProcessResultSet": [
            {
              "Type": "SampleSnapshot",
              "TranscodeTask": null,
              "AnimatedGraphicTask": null,
              "SnapshotByTimeOffsetTask": null,
              "SampleSnapshotTask": {
                "Status": "SUCCESS",
                "ErrCode": 0,
                "Message": "SUCCESS",
                "Input": {
                  "Definition": 10,
                  "WatermarkSet": null
                },
                "Output": {
                  "ImageUrlSet": [
                    "http://123.vts2.myqcloud.com/d042887avtstransgzp1256768367/9ce0cd925285890784273533167/1547051785_1651252995.100_0.jpg",
                    "http://123.vts2.myqcloud.com/d042887avtstransgzp1256768367/9ce0cd925285890784273533167/1547051785_1651252995.100_6000.jpg",
                    "http://123.vts2.myqcloud.com/d042887avtstransgzp1256768367/9ce0cd925285890784273533167/1547051785_1651252995.100_12000.jpg",
                    "http://123.vts2.myqcloud.com/d042887avtstransgzp1256768367/9ce0cd925285890784273533167/1547051785_1651252995.100_18000.jpg",
                    "http://123.vts2.myqcloud.com/d042887avtstransgzp1256768367/9ce0cd925285890784273533167/1547051785_1651252995.100_24000.jpg",
                    "http://123.vts2.myqcloud.com/d042887avtstransgzp1256768367/9ce0cd925285890784273533167/1547051785_1651252995.100_30000.jpg",
                    "http://123.vts2.myqcloud.com/d042887avtstransgzp1256768367/9ce0cd925285890784273533167/1547051785_1651252995.100_36000.jpg",
                    "http://123.vts2.myqcloud.com/d042887avtstransgzp1256768367/9ce0cd925285890784273533167/1547051785_1651252995.100_42000.jpg",
                    "http://123.vts2.myqcloud.com/d042887avtstransgzp1256768367/9ce0cd925285890784273533167/1547051785_1651252995.100_48000.jpg",
                    "http://123.vts2.myqcloud.com/d042887avtstransgzp1256768367/9ce0cd925285890784273533167/1547051785_1651252995.100_54000.jpg"
                  ],
                  "Definition": 0,
                  "SampleType": "",
                  "Interval": 0,
                  "WaterMarkDefinition": null
                }
              },
              "ImageSpriteTask": null,
              "CoverBySnapshotTask": null
            }
          ],
          "AiContentReviewResultSet": null,
          "AiRecognitionResultSet": null
        },
        "FileDeleteEvent": null,
        "PullCompleteEvent": null,
        "EditMediaComplete": null,
        "WechatPublishComplete": null,
        "TranscodeCompleteEvent": null,
        "ConcatCompleteEvent": null,
        "ClipCompleteEvent": null,
        "CreateImageSpriteCompleteEvent": null,
        "SnapshotByTimeOffsetCompleteEvent": null
      }
    ],
    "RequestId": "335bdaa3-db0e-46ce-9946-51941d9cb0f5"
  }
}
```

事件通知消息中具体结构体及字段含义请参考[API接口文档--数据结构](/product/1090/33426&lang=cn&!document=1#EventContent)文档。