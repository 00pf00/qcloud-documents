## 概述
云点播基于 [访问管理](/document/product/598) 为开发者提供了灵活的权限管理功能。开发者可以直接使用权限管理功能，无需开通。
阅读本文前，开发者需要对腾讯云访问管理（以下简称 CAM）和云点播子应用体系有所了解。涉及的概念主要有：
- [用户类型](/document/product/598/13665)、[API 密钥](/document/product/598/37140)、[策略](/document/product/598/10601) 、[策略语法](/document/product/598/10603)
- [子应用](https://cloud.tencent.com/document/product/266/39050)

### 应用场景
云点播权限管理的典型应用场景如下：
- **云产品维度权限隔离**：某企业内有多个部门在使用腾讯云，其中 A 部门专门负责对接云点播，因此需要授予 A 部门访问云点播的权限，但又不允许其访问其它云产品。这时可以创建一个子用户，只授予该子用户访问云点播的权限，然后将子用户提供给 A 部门使用。
- **云点播子应用维度权限隔离**：某企业内有多个业务在使用云点播，相互之间需要进行隔离。隔离包括资源隔离和权限隔离两个方面，前者由云点播子应用体系提供，后者则由云点播权限管理来实现。该企业可以为每个业务创建一个子用户，授予对应的云点播子应用权限，使得每个业务只能访问和自己相关的子应用。
- **云点播操作维度权限隔离**：某企业内有某个业务在使用云点播，该业务的产品运营人员需要访问云点播控制台，获取统计数据信息（如流量地域分布、视频播放次数等），以便进行运营分析，同时不允许其进行敏感操作（如删除文件、关闭域名等）。这时可以先创建自定义策略，该策略拥有云点播控制台登录、统计数据 API 的访问权限，然后创建一个子用户，与上述策略绑定，将该子用户提供给运营人员。

### 资源粒度和操作粒度
权限管理的核心功能可以表达为：**允许或禁止某账号对某些资源进行某些操作**。对于云点播来说，资源的粒度是子应用，操作的粒度是服务端 API。

### 限制
- 资源粒度为子应用，不支持对更细粒度的资源（如媒体文件、域名等）做权限管理。
- 不支持 [项目与标签](/document/product/598/32738)。

## 基本用法
权限管理实质上是将子账号与策略进行绑定，或者说将策略授予子账号。


### 示例：创建拥有云点播完整权限的子用户
1. 以 [主账号](https://cloud.tencent.com/document/product/598/13665) 的身份访问 CAM 控制台的[【用户列表】](https://console.cloud.tencent.com/cam)，单击【新建用户】。
![](https://main.qcloudimg.com/raw/4964653a09f69e0e274947c5f2b13d74.png)
2. 在“新建用户”页面单击子用户类型下的【自定义创建】，进入“新建子用户”页面。
![](https://main.qcloudimg.com/raw/47509b7f1dc7c3475edb8b0a1784d15a.png)
3. 填写用户信息。
	1. 填写用户名，勾选【编程访问】和【腾讯云控制台访问】，其余选项按需配置。
	2. 单击【下一步】，按照页面的提示完成身份验证。
	![](https://main.qcloudimg.com/raw/a623d91442d86eea6bfae1108db17dad.png)
4. 设置用户权限。
	1. 搜索并勾选预设策略`QcloudVODFullAccess`。
	2. 单击【下一步】。
![](https://main.qcloudimg.com/raw/7be0ce70c3fe8b854d06f423e4cd6139.png)
5. 在“审阅信息和权限”分栏下单击【完成】，完成子用户的创建，在成功页面下载并保管好该子用户的登录链接和安全凭证，其中包含的信息如下表：
![](https://main.qcloudimg.com/raw/e0f59bdf4ec19e74ee3f956f0448c28d.png)
<table>
     <tr>
         <th nowrap="nowrap">信息</th>  
         <th nowrap="nowrap">来源</th>  
         <th nowrap="nowrap">作用</th>  
         <th nowrap="nowrap">是否必须保存</th>  
     </tr>
	 <tr>      
         <td>登录链接</td>   
	     <td>在页面中复制</td>   
	     <td nowrap="nowrap">方便登录控制台，省去填写主账号</td>   
	     <td>否</td>
     </tr> 
	 <tr>      
         <td nowrap="nowrap">用户名 </td>   
	     <td>安全凭证 CSV 文件</td>   
	     <td>登录控制台时填写</td>   
	     <td>是</td>
     </tr> 
	 <tr>      
         <td>密码</td>   
	     <td>安全凭证 CSV 文件 </td>   
	     <td >登录控制台时填写</td>   
	     <td >是</td>
     </tr> 
		  <tr>      
         <td>SecretId</td>   
	     <td>安全凭证 CSV 文件</td>   
	     <td >调用服务端 API 时使用，详见 <a href="https://cloud.tencent.com/document/product/598/37140">访问密钥</a></td>   
	     <td >是</td>
     </tr> 
	     <tr>      
         <td>SecretKey</td>   
	     <td>安全凭证 CSV 文件</td>   
	     <td >调用服务端 API 时使用，详见 <a href="https://cloud.tencent.com/document/product/598/37140">访问密钥</td>   
	     <td >是</td>
     </tr> 
</table>

将上述登录链接和安全凭证提供给云点播使用方，后者即可使用该子用户对云点播做所有操作（包括访问云点播控制台、请求云点播服务端 API 等）。
>?创建子用户的通用流程请参见 CAM 的 [创建子用户](/document/product/598/13674) 文档。

### <span id="p2"></span>示例：将云点播完整权限授予已存在的子用户
1. 以 [主账号](/document/product/598/13665) 的身份访问 CAM 控制台的[【用户列表】](https://console.cloud.tencent.com/cam)，单击想要进行授权的子账号。
![](https://main.qcloudimg.com/raw/f4b1910408cd17e2a7987ea14e15ad0c.png)
2. 单击“用户详情”页面权限栏的【添加策略】，如下图所示（实际操作中，根据子账号已有权限的不通过，页面的信息可能有所差异。如果子账号的权限非空，则单击【关联策略】）。
![](https://main.qcloudimg.com/raw/8d5c65842bcbf130d54674a89e389666.png)
3. 选择【从策略列表中选取策略关联】，搜索并勾选预设策略`QcloudVODFullAccess`。后续按页面提示完成授权流程即可。

### 示例：解除子用户的云点播完整权限
1. 以 [主账号](/document/product/598/13665) 的身份访问 CAM 控制台的[【用户列表】](https://console.cloud.tencent.com/cam)，单击想要解除授权的子账号。
![](https://main.qcloudimg.com/raw/f4b1910408cd17e2a7987ea14e15ad0c.png)
2. 在“用户详情”页面权限栏找到预设策略`QcloudVODFullAccess`，单击右侧的【解除】。按页面提示完成解除授权流程即可。
![](https://main.qcloudimg.com/raw/60cffda1b41cb4aec6cd016a011a1928.png)

## 高级用法
### 自定义策略
预设策略虽然使用方便，但灵活性较低。如果开发者要求更精细的权限控制能力，则需要创建自定义策略。
创建自定义策略的方法有多种，下方表格展示各种方法的主要区别，具体操作流程请参考下文。

| 创建入口   | 创建方法     | 效力<br/>（Effect） | 资源<br/>（Resource） | 操作<br/>（Action） | 灵活性 | 难度 |
| ---------- | ------------ | ------------------- | --------------------- | ------------------- | ------ | ---- |
| 控制台     | 策略生成器   | 手动选择            | 语法描述              | 手动选择            | 中     | 中   |
| 控制台     | 策略语法     | 语法                | 语法                  | 语法                | 高     | 高   |
| 服务端 API | CreatePolicy | 语法                | 语法                  | 语法                | 高     | 高   |

>?云点播不支持按照产品功能创建自定义策略。

### <span id = "p1"></span>资源语法描述
如上文所述，云点播权限管理的资源粒度是子应用。子应用的策略语法描述方式遵循 [CAM 标准](/document/product/598/10606)。在下文的示例中，开发者的账号 ID 是12345678，APPID 是1250000001（主应用 ID 等于 APPID），开发者创建了两个云点播子应用，ID 分别是1400000001和1400000002。
- **云点播所有资源的策略语法描述**
```
"resouce": [
	"qcs::vod::uin/12345678:subAppId/*"
]
```
- **主应用的策略语法描述**
```
"resouce": [
	"qcs::vod::uin/12345678:subAppId/1250000001"
]
```
- **单个子应用的策略语法描述**
```
"resouce": [
	"qcs::vod::uin/12345678:subAppId/1400000001"
]
```
- **主应用和单个子应用的策略语法描述**
```
"resouce": [
	"qcs::vod::uin/12345678:subAppId/1250000001",
	"qcs::vod::uin/12345678:subAppId/1400000001"
]
```

### <span id ="p3"></span>操作语法描述
如上文所述，云点播权限管理的操作粒度是服务端 API。在下文的示例中，以`DescribeMediaInfos`、`DescribeAllClass`等服务端 API 为例。
- **云点播所有服务端 API 的策略语法描述**
```
"action": [
	"name/vod:*"
]
```
- **单个服务端 API 操作的策略语法描述**
```
"action": [
	"name/vod:DescribeMediaInfos"
]
```
- **多个服务端 API 操作的策略语法描述**
```
"action": [
	"name/vod:DescribeMediaInfos",
	"name/vod:DescribeAllClass"
]
```

### 示例：在控制台使用策略生成器创建自定义策略
在下文示例中，我们将创建一个自定义策略。该策略允许对1400000001这个云点播子应用进行任何操作，除了`ProcessMedia`这个服务端 API。
1. 以 [主账号](/document/product/598/13665) 的身份访问 CAM 控制台的[【策略】](https://console.cloud.tencent.com/cam/policy)，单击【新建自定义策略】。
2. 选择【按策略生成器创建】，进入策略创建页面。
3. 选择服务和操作。
	1. 【效果(Effect)】配置项选择【允许】。
	2. 【服务(Service)】配置项选择【云点播】。
	3. 【操作(Action)】配置项勾选【All】。
	4. 【资源(Resource)】配置项按照 [资源语法描述](#p1) 说明填写`qcs::vod::uin/12345678:subAppId/1400000001`。
	5. 【条件(Condition)】配置项无需配置。
	6. 单击【添加声明】，页面最下方会出现一条“允许对云点播子应用1400000001进行任何操作”的声明。
4. 在同个页面中继续添加另一条声明。
	1. 【效果(Effect)】配置项选择【拒绝】。
	2. 【服务(Service)】配置项选择【云点播】。
	3. 【操作(Action)】配置项勾选`ProcessMedia`（可通过搜索功能选择）。
	4. 【资源(Resource)】配置项按照 [资源语法描述](#p1) 说明填写`qcs::vod::uin/12345678:subAppId/1400000001`。
	5. 【条件(Condition)】配置项无需配置。
	6. 单击【添加声明】，页面最下方会出现一条“拒绝对云点播子应用1400000001进行`ProcessMedia`操作”的声明。
![](https://main.qcloudimg.com/raw/f1021e0b522b588364759e5bda7636fb.png)
5. 单击【下一步】，按需修改策略名称（也可以不修改）。
6. 单击【创建策略】完成自定义策略的创建。后续将该策略授予子用户的方法同 [示例：将云点播完整权限授予已存在的子用户](#p2)。


### 示例：在控制台使用策略语法创建自定义策略
在下文示例中，我们将创建一个自定义策略。该策略允许对1400000001和1400000002这两个云点播子应用进行任何操作，但不允许对1400000001进行`ProcessMedia`操作。

1. 以 [主账号](/document/product/598/13665) 的身份访问 CAM 控制台的[【策略】](https://console.cloud.tencent.com/cam/policy)，单击【新建自定义策略】。
2. 选择【按策略语法创建】，进入策略创建页面。
3. 在【选择模板类型】框下选择【空白模版】。
>?所谓策略模版，指新策略是现有策略（预置策略或自定义策略）的一个拷贝，然后在此基础上做调整。在实际使用中，开发者可以根据情况选择合适的策略模版，降低编写策略内容的难度和工作量。
4. 单击【下一步】，按需修改策略名称（也可以不修改）。
5. 在【编辑策略内容】编辑框中填写策略内容。本示例的策略内容为：
```
{
    "version": "2.0",
    "statement": [
        {
            "effect": "allow",
            "action": [
                "name/vod:*"
            ],
            "resource": [
                "qcs::vod::uin/12345678:subAppId/1400000001",
                "qcs::vod::uin/12345678:subAppId/1400000002"
            ]
        },
        {
            "effect": "deny",
            "action": [
                "name/vod:ProcessMedia"
            ],
            "resource": [
                "qcs::vod::uin/12345678:subAppId/1400000001"
            ]
        }
    ]
}
```
>?策略内容遵循 CAM [策略语法](/document/product/598/10603) 规范，其中资源和操作两个元素的语法分别如上文 [资源语法描述](#p1) 和 [操作语法描述](#p3) 所述。
6. 单击【创建策略】完成自定义策略的创建。后续将该策略授予子用户的方法同 [示例：将云点播完整权限授予已存在的子用户](#p2)。

### 示例：基于服务端 API 创建自定义策略
对于大多数开发者来说，在控制台完成权限管理操作已经能满足业务需求。但如果需要将权限管理能力自动化和系统化，则可以基于服务端 API 来实现。
策略相关的服务端 API 属于 CAM，具体请参见 [CAM 官网文档](https://cloud.tencent.com/document/product/598)。此处仅列出几个主要接口：
- [创建策略](https://cloud.tencent.com/document/product/598/34578)
- [删除策略](/document/product/598/34577)
- [绑定策略到用户](/document/product/598/34579)
- [解除绑定到用户的策略](/document/product/598/34575)

### 不需要关联资源的服务端 API
- [查询子应用列表](/document/product/266/36304)：所有子用户都有权限调用该接口，不需要授权（**即使已经在策略中显式拒绝该接口，仍然可以调用**）。该接口返回对应云点播账号下的所有子应用列表（含主应用）。
- [修改子应用状态](/document/product/266/36302)：该接口仅具备云点播完整权限（相当于预设策略`QcloudVODFullAccess`）时才允许访问。一个子用户即使拥有某个子应用的所有权限，也无权限启用/停用该子应用。

## FAQ
#### 上传文件需要什么权限？
云点播的上传方式有 [服务端上传](/document/product/266/9759)、[客户端上传](/document/product/266/9219)、[拉取上传](/document/product/266/35575)、[直播录制](/document/product/267/32739) 等几种方式，各自需要的权限如下：

| 上传方式   | 资源权限     | 操作权限                                                     | 备注               |
| ---------- | ------------ | ------------------------------------------------------------ | ------------------ |
| 服务端上传 | 指定的子应用 | [申请上传](/document/product/266/31767)<br/>[确认上传](/document/product/266/31766) |          -          |
| 客户端上传 | 指定的子应用 | [申请上传](/document/product/266/31767)<br/>[确认上传](/document/product/266/31766) |            -        |
| 拉取上传   | 指定的子应用 | [拉取上传](/document/product/266/35575)                      |          -          |
| 直播录制   | 所有子应用   | -                                                       | 需开通直播录制功能 |

>?在云点播控制台上进行 [本地上传](/document/product/266/2841#.E6.9C.AC.E5.9C.B0.E4.B8.8A.E4.BC.A0.E6.AD.A5.E9.AA.A4) 视频属于客户端上传。

#### 服务端上传返回无权限，但其它上传方式能成功是什么原因？
可能是因为服务端 SDK 的版本太旧，请更新到最新版 [SDK](/document/product/266/9759#1.-.E5.8F.91.E8.B5.B7.E4.B8.8A.E4.BC.A0)。

#### 观看视频需要什么权限？
观看视频实质上是向云点播 CDN 发起请求，操作者的身份是普通观众而非腾讯云账号，因此不需要授予操作者任何权限（如果开启了 [防盗链](/document/product/266/11243) 或 [视频加密](/document/product/266/9638)，需满足相关文档中所述条件才能观看，但这些均与权限管理无关）。

#### 能否只对单个文件做授权？
不支持。云点播权限管理的资源粒度是子应用。

#### 如果出现相互冲突的权限设置会怎样？
出现冲突的权限设置可能是下面的场景：
- 一个自定义策略中存在多个声明，这些声明之间存在相互冲突的描述（例如一个声明允许对某个资源的访问，另一个声明则拒绝对同个资源的访问）。
- 一个子用户同时绑定了多个策略，这些策略之间存在相互冲突的描述。

云点播的权限管理基于 CAM，权限的判定遵循 CAM 的策略 [评估逻辑](/document/product/598/10605)。

#### 云点播是否可以进行跨账号资源访问？
跨账号资源访问是指主账号 A 将自己的全部或部分云点播权限授予主账号 B（或其子账号），也就是说授权者和被授权者属于两个独立的腾讯云账号。云点播**不支持**跨账号资源访问。
