# 对接说明及对接前准备

《开发对接指南》系列文档旨在说明在腾讯云上购买TBaaS产品后如何进行应用开发对接，即如何在应用系统上调用合约与区块链网络进行交互。

# 对接方式

合约是应用系统与区块链网络进行交互的唯一途径，所以不同的对接方式对应着不同的合约调用方式。

​            <img src="https://main.qcloudimg.com/raw/19edff5cdc90d246b992da5a9973d35f.png" alt="img" style="zoom: 50%;" />            

如上图所示，目前用户的应用系统可以通过两种方式调用TBaaS上区块链网络的合约，即云API以及区块链官方SDK。两种方式最终都是通过区块链SDK与区块链网络进行交互，可以认为云API是对区块链SDK的封装。下图仅为两种调用方式的逻辑关系，应用系统包括上层应用和腾讯云SDK/区块链SDK。

 <img src="https://main.qcloudimg.com/raw/1eeb81933f77b5ccf590bf36d14a028a.png" alt="img" style="zoom:50%;" />            

云API和区块链SDK的优缺点和适用场景如下表所示

|           | 优缺点                                                       | 适用场景                                                     |
| --------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 云API     | 配置简单，使用SecretID和SecretKey即可接入网络；功能较少，仅包含调用、查询、发起交易、 | 用户侧应用系统希望以最快的速度或者最小的开发对接云上的区块链网络。用户侧应用系统对区块链的调用频率低于50笔每秒（TPS）。用户侧应用系统无法固定部署在与区块链所在地域相同的云上私有网络（VPC）中或用户不打算购买腾讯云服务器（CVM）。 |
| 区块链SDK | 配置繁琐；功能强大；tbaas-fabric-sdk-java在原生社区SDK上进行了封装，简化配置流程的同时，保留了丰富的功能支持 | 用户侧应用系统对区块链的调用频率超过50笔每秒（TPS）。用户侧应用系统已经基于区块链原生的 SDK 进行了相关开发，迁移至云上时，希望改动尽可能少。用户侧应用系统所在 VPC 与区块链在同一地域。例如，应用系统 VPC 在广州，区块链网络节点也需要在购买在广州，目前 TBaaS 仅支持同地域打通。用户侧 VPC 内有空闲的 IP 地址，即 VPC 内 IP 地址不能被耗尽。 |

# **合约调用**

应用系统调用实例化在通道上的合约的调用逻辑如下图所示，使用SecretID和SecretKey作为账户的标识，表明拥有该账户的访问权限。需要使用组织名（OrgName）、通道名（ChannelName）、节点名（PeerName）以及合约名（ChaincodeName）来定位一个合约并表明自己有调用该合约的权限。

所以在公有云上调用合约之前，需要完成以下准备工作：

1. 注册腾讯云账号（获取SecretID和SecretKey）
2. 购买TBaaS节点（PeerName）
3. 创建/加入网络（ClusterID）
4. 创建/加入通道（ChannelName）
5. 安装/实例化合约（ChaincodeName）

 <img src="https://main.qcloudimg.com/raw/a12043673e27ee8f270b22e7173b9df3.png" alt="img" style="zoom: 80%;" />            

## **合约示例**

使用的合约示例为[java-contract-demo](https://tbaasdoc-1259695942.cos.ap-guangzhou.myqcloud.com/java-contract-demo.zip)，该合约支持以下四种方法。对应下面构造调用请求时funcName字段取值范围为: {"query", "queryHistory", "rangeQuery", "write"}

 <img src="https://main.qcloudimg.com/raw/6cab62d39903511247d05c032f616eb5.png" alt="img" style="zoom:50%;" />            

## **获取调用参数**

- **ClusterID**：合约所在的区块链网络ID

  <img src="https://main.qcloudimg.com/raw/28cef4c9ba799fdfa5dd1834cf90603c.png" alt="img" style="zoom:50%;" />            

- Region：该账户节点所在地域，可以概览页下方查看

  <img src="https://main.qcloudimg.com/raw/b780e99bbbdde33beefa31286d4d32c8.png" alt="img" style="zoom: 25%;" />            

- **OrgName**：组织名。可进入网络后在组织管理标签页查看，即带有当前组织标签的组织名。

  <img src="https://main.qcloudimg.com/raw/a5523d2b295ee30c839e8d552fea49b8.png" alt="img" style="zoom: 33%;" />      

- ChannelName：通道名称。被调用的合约实例化到该通道。

- PeerName：组织加入通道时的任一peer，该参数可在通道详情标签页查看。

- ChainCodeName：合约名称。
