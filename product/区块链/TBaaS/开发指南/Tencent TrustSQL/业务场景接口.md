## TrustSQL 业务场景接口汇总

### 数字资产相关接口

<table>
	<tr>
	<th width="50%">接口名</th>
	<th>接口功能</th>
	</tr>
	<tr>
	<td>asset_issue_apply  </td>
	<td>资产发行申请</td>
	</tr>
	<tr>
	<td>asset_issue_submit   </td>
	<td>资产发行提交</td>
	</tr>
	<tr>
	<td>asset_mult_transfer_mid_apply </td>
	<td>资产转让至中间账户申请（转让签收场景）</td>
	</tr>
	<tr>
	<td>asset_mult_transfer_mid_submit</td>
	<td>资产转让至中间账户提交（转让签收场景）</td>
	</tr>
	<tr>
	<td>asset_mult_signin_apply</td>
	<td>资产转让签收申请（转让签收场景）</td>
	</tr>
	<tr>
	<td>asset_mult_signin_submit  </td>
	<td>资产转让签收提交（转让签收场景）</td>
	</tr>
	<tr>
	<td>asset_transfer_apply   </td>
	<td>资产直接转让申请（非签收场景）</td>
	</tr>
	<tr>
	<td>asset_transfer_submit </td>
	<td>资产直接转让提交（非签收场景）</td>
	</tr>
	<tr>
	<td>asset_settle_apply </td>
	<td>资产兑付申请</td>
	</tr>
	<tr>
	<td>asset_settle_submit   </td>
	<td>资产兑付提交</td>
	</tr>
	<tr>
	<td>asset_account_query  </td>
	<td>资产批量查询</td>
	</tr>
	<tr>
	<td>trans_batch_query</td>
	<td>交易批量查询</td>
	</tr>
	<tr>
	<td>asset_rec_sum_query </td>
	<td>资产汇总对账</td>
	</tr>
	<tr>
	<td>asset_rec_detail_query </td>
	<td>资产明细对账</td>
	</tr>
	<tr>
	<td>trans_rec_sum_query </td>
	<td>交易汇总对账</td>
	</tr>
	<tr>
	<td>trans_rec_detail_query </td>
	<td>交易明细对账</td>
	</tr>
</table>

### 信息共享相关接口

<table>
	<tr>
	<th width="50%">接口名</th>
	<th>接口功能</th>
	</tr>
	<tr>
	<td>Iss_Append</td>
	<td>共享信息新增/追加</td>
	</tr>
	<tr>
	<td>Iss_Query</td>
	<td>共享信息查询</td>
	</tr>
</table>


## Trustsql 业务场景接口示例

### 数字资产服务
本例以数字资产服务相关接口中的资产发行接口 `asset_issue_apply` 为例。
1. <span id="step1"></span>用户需设置自己的参数并封装成 POST 请求，请求的 URL 为 TBaaS 平台。用户自定义参数如下所示：
```
values = {"mch_sign":"MEQCID0FuZnQUmzTFlokvIOr0WOhraDMAKRuyolhuy2", "owner_account":"1MdjmfAWm2xH67uR5Egx9c5R1pXYZVU9Hu","mch_id":"12345678","mch_pubkey":"A7wklkNCp3PgBiWPRTjUsv98DRi2QRQ69/Qs93XdIiDJ","timestamp":"1535955749","owner_uid":"owner_uid5259","chain_id":"ch6f2mp139e8tyhwco","content":{"test":"test"},"amount":10000000000000,"version":"2.0","owner_account_pubkey":"A7wklkNCp3PgBiWPRTjUsv98DRi2QRQ69/Qs93XdIiDJ","sign_type":"ECDSA","source_id": "52227180","asset_type": 1,"unit": "fen","node_id": "tb6ckw7vr49mf0g1sb"}
```
封装的 JSON 格式为：
```
{"Service" : "dam",  "Method" : "asset_issue_apply", "Param": values 的字符串}
```
2. 从返回结果中获取 `sign_str` 和 `transaction_id`。返回结果如下所示：
```
{"version":"2.0","sign_type":"ECDSA","mch_id":"trust_mch","mch_sign":"MEUCIQDKqvBbz3xLKXk6Y6tfUjRYAYCtV1reyDtQqtaik3KFmQIgGbVQjYiYCay7lw4XOwxZROAX3HRF4rWX/9I0lMmutuI=","chain_id":"ch6f2mp139e8tyhwco","retcode":0,"retmsg":"SUCCESS","transaction_id":"201907300035132738","asset_id":"26aNKohVAE6X67k8Z2ZgPWZvTBf87ma9nfQ2jiLgaDGz1h3","sign_str_list":[{"id":1,"account":"1MdjmfAWm2xH67uR5Egx9c5R1pXYZVU9Hu","sign_str":"58dbee169d2e7e8897204245b468e2ccd6c4fa6646e26280e62d05642aa54fba"}],"mch_pubkey":""}
```
3. 将 `sign_str` 用 `Qch3zytFxs+F1+32oqmqzL8XXEJjt+0rpedD3Tp61jI=` 进行 ECDSA 签名，获取 `sign`。
4. 调用 `asset_issue_submit` 接口，进行资产发行提交。用户自定义参数如下所示：
>?其中 `sign` 和 `transaction_id` 已从 [步骤1](#step1) 中获取。
>
```
values={"mch_sign":"MEQCID0FuZnQUmzTFlokvIOr0WOhraDMAKRuyolhuy2","mch_id":"12345678","mch_pubkey":"A7wklkNCp3PgBiWPRTjUsv98DRi2QRQ69/Qs93XdIiDJ","timestamp":"1535955749","chain_id":"ch6f2mp139e8tyhwco","version":"2.0","sign_type":"ECDSA","source_id":"52227180","asset_type":1,"node_id":"tb6ckw7vr49mf0g1sb","transaction_id":"201907300035132738","sign_list":[{"account":"1MdjmfAWm2xH67uR5Egx9c5R1pXYZVU9Hu","sign_str":"58dbee169d2e7e8897204245b468e2ccd6c4fa6646e26280e62d05642aa54fba","id":1,"sign":"MEQCIFG8Rlky48cTtk9Nh27V+IK/OZaR348jkg2tJDqvlQg0AiAF+ARNwSom6iqBoos4AHPcrsBRxIGbKsSmze1dbyttIw=="}]}
```
封装的 JSON 格式为：
```
{"Service" : "dam",  "Method" : "asset_issue_submit ", "Param": values 的字符串}
```
返回结果如下所示：
```
{"version":"2.0","sign_type":"ECDSA","mch_id":"trust_mch","mch_sign":"MEUCIQCpPdckb60H/2coiaekeAQmP+5OzakSGwC9XCDa2n4XJQIgEpaf+f4SFQ6q5FE2/rnhtA3qMRw+EEYkTWjYhEg4LKg=","chain_id":"ch6f2mp139e8tyhwco","retcode":0,"retmsg":"SUCCESS","asset_id":"26aNKohVAE6X67k8Z2ZgPWZvTBf87ma9nfQ2jiLgaDGz1h3","trans_hash":"c939226796a18f355a9626cbe03483a3405d72620140c40591fff83b8327482a","trans_b_height":2,"trans_b_timestamp":1564456174,"mch_pubkey":""}
```

### 信息共享服务
本例以信息共享服务相关接口中的共享信息新增接口 `Iss_Append` 为例。
1. <span id="step"></span>用户需设置自己的参数并封装成 POST 请求，请求的 URL 为 TBaaS 平台。用户自定义参数如下所示：
```
values = {"mch_sign":"MEQCID0FuZnQUmzTFlokvIOr0WOhraDMAKRuyolhuy2", "node_id": "tb6ckw7vr49mf0g1sb","chain_id":"ch6f2mp139e8tyhwco","public_key":"A7wklkNCp3PgBiWPRTjUsv98DRi2QRQ69/Qs93XdIiDJ","account":"1MdjmfAWm2xH67uR5Egx9c5R1pXYZVU9Hu","mch_pubkey":"A7wklkNCp3PgBiWPRTjUsv98DRi2QRQ69/Qs93XdIiDJ","timestamp":"1535955749","sign":"","content":{"test":"content_8804177188"},"mch_id":"12345678","version":"2.0","sign_type":"ECDSA","extra_info":{"test":"test"}}
```
封装的 JSON 格式为：
```
{"Service" : "iss",  "Method" : "Iss_Append", "Param": values的字符串}
```
2. 从返回结果中获取 `sign_str`。返回结果如下所示：
```
{"version":"2.0","sign_type":"ECDSA","mch_id":"trust_mch","mch_sign":"MEYCIQDoNs11+aGS/AtpSlpI9CWnqfcd47w9PzWXYrbpwPwKmwIhAO14RahFLaa6Kz+ga1Tc4Q6fpQzKOWNNGqgQw0omOKdQ","retcode":0,"retmsg":"SUCCESS","sign_str":"003fca1b393f536cdd0d17fd68e88277607328a2b026bb392ac9c798acfa4cfb","t_hash":"ac2e0e0415235ae1cd11f0019bc28d72542847dbd1434da84bde9ae9f0f0acbf","inputs":[{"index":0,"output_point":{"hash":"0000000000000000000000000000000000000000000000000000000000000000","index":-1,"issueNo":"117e77a22c4b8f80f66d5173fb934d53"},"voucher":""}],"outputs":[{"condition":"6GS968dzAPG2643DVXp1Qb2TaTS8sV4KA7c4efu","amount":1,"address":"1MdjmfAWm2xH67uR5Egx9c5R1pXYZVU9Hu","data":"6QqbdaZ6wQhEEAiA7goe2MvwrW7a9mCnNd6z9ujCHD1va5hh76uK2zA8ZP6zegvovXSF6WakDRL8U8xwYs3hDoupkWf4oPLx","index":0,"id":"1515fBVwCUCUSCSC9C1SdtjV2VYRphNGm5FEyeGbsUijHUnnanuca2oR1GNxdt"}]}  
```
3. 将 `sign_str` 用 `Qch3zytFxs+F1+32oqmqzL8XXEJjt+0rpedD3Tp61jI=` 进行 ECDSA 签名，得到 `sign`。
4. 将获取的 `sign` 值填入 [步骤1](#step) 的 `sign` 字段，并重新执行 [步骤1](#step)。
返回结果如下所示：
```
{"version":"2.0","sign_type":"ECDSA","mch_id":"trust_mch","mch_sign":"MEUCIQCp3An9noXV5tmuuNAVqwGsaGcWxzEMK61mqRygvyme+QIgIjIojlCeokKPUizSp2MqtROwIv93DMZC8w8TgAiKQ+Q=","retcode":0,"retmsg":"SUCCESS","t_hash":"ac2e0e0415235ae1cd11f0019bc28d72542847dbd1434da84bde9ae9f0f0acbf","b_height":"1","b_time":"2019-07-29 17:56:44"}
```

## 数字资产相关接口详解

### 资产发行申请
>!申请和提交要在同一个节点上操作。
>
**接口名**：asset_issue_apply
 **请求方法**：POST
 **请求字段**：如下表
<table>
	<tr>
	<th>名称</th>	<th>类型</th>	<th>必填</th>	<th>限制</th>	<th>描述</th>
	</tr>
	<tr>
	<td>version</td>	<td>String</td>	<td>是</td>	<td> 1 ≤ length ≤ 8</td>
	<td>版本号，此版本固定填写“2.0”。</td>
	</tr>
	<tr>
	<td>sign_type</td>	<td>String</td>	<td>是</td>	<td>0 ≤ length ≤ 8</td>
	<td>签名算法类型，此版本固定为 “ECDSA”。</td>
	</tr>
	<tr>
	<td>mch_id</td>	<td>String</td>	<td>是</td>	<td>1 ≤ length ≤ 32</td>
	<td>通讯方的 ID。腾讯云账号的 APPID，可从 <a href="https://console.cloud.tencent.com/developer">账号信息</a> 页面获取。</td>
	</tr>
	<tr>
	<td>mch_sign</td>	<td>String</td>	<td>是</td>	<td>1 ≤ length ≤ 256</td>
	<td>通讯方签名结果。</td>
	</tr>
	<tr>
	<td>chain_id</td>	<td>String</td>	<td>是</td>	<td>1 ≤ length ≤ 32</td>
	<td>链 ID。</td>
	</tr>
	<tr>
	<td>node_id</td>	<td>String</td>	<td>是</td>	<td>1 ≤ length ≤ 32</td>
	<td>节点 ID。</td>
	</tr>
	<tr>
	<td>mch_pubkey</td>	<td>String</td>	<td>是</td>	<td>1 ≤ length ≤ 64</td>
	<td>节点公钥。用户可在 TrustSQL 控制台，节点列表的节点公钥处上传。</td>
	</tr>
	<tr>
	<td>source_id</td>	<td>String</td>	<td>否</td>	<td>0 ≤ length ≤ 64</td>
	<td>源资产唯一 ID。</td>
	</tr>
	<tr>
	<td>owner_uid</td>	<td>String</td>	<td>是</td>	<td>1 ≤ length ≤ 64</td>
	<td>资产转出方（即资产发行方、资产所有者）的 UID。</td>
	</tr>
	<tr>
	<td>owner_account</td>	<td>String</td>	<td>是</td>	<td>1 ≤ length ≤ 64</td>
	<td>资产转出方（即资产发行方、资产所有者）的账户地址。</td>
	</tr>
	<tr>
	<td>owner_account_pubkey</td>	<td>String</td>	<td>是</td>	<td>1 ≤ length ≤ 64</td>
	<td></td>
	</tr>
	<tr>
	<td>asset_type</td>	<td>uint64</td>	<td>是</td>	<td>0 ≤ value ≤ 32</td>
	<td>资产类型，用户可发行不同类型的数字资产。例如：0. 商票  1. 权益  2. Q币  3. 游戏装备  4. 黄金  5. 积分  6. 卡券  7. 股权...<br>目前仅有0. 商票类别的资产要求 source id 不可重入，其余数字所代表的类别无该要求，亦不限于以上举例，可由业务方自行定义。</td>
	</tr>
	<tr>
	<td>amount</td>	<td>uint64</td>	<td>是</td>	<td>0 ≤ value ≤ 10,000,000,000,000</td>
	<td>发行的资产份额。</td>
	</tr>
	<tr>
	<td>unit</td>	<td>String</td>	<td>否</td>	<td>1 ≤ length ≤ 32</td>
	<td>资产单位。</td>
	</tr>
	<tr>
	<td>content</td>	<td>jsonObject</td>	<td>否</td>	<td>-</td>
	<td>资产内容（注意与 source_id 保持对应）。</td>
	</tr>
	<tr>
	<td>timestamp</td>	<td>int64</td>	<td>是</td>	<td>value ≥ 0</td>
	<td>当前 unix 时间戳（秒），与服务器时间相差过远会返回失败。</td>
	</tr>
</table>

**请求示例**：
```
{
	"mch_sign": "MEUCIQDBRrc5gNkSNS+T3dksuhkMEu/8bjKP0jtHaQbheZoFNgIgImnADk5gXkr/giqWPS1i6kXXndHEvg3n6VvlhuFp6SA=",
	"owner_account": "1LpqkE1FrCrumjV4aLLn4kL5P5NbyZ1PYD",
	"mch_id": "mch_id",
	"mch_pubkey": "A54sbt2MnFA+w+A6gL3M7o2O7Zq8m2Be7A5vHr1HVoHO",
	"timestamp": "1545027668",
	"owner_uid": "owner_uid5259",
	"chain_id": "chain_id",
	"node_id": "node_id",
	"content": {
		"test": "test"
	},
	"amount": 10000000000000,
	"version": "2.0",
	"owner_account_pubkey":"AilPJBYrDQjXiJ4Wr7hjUTZjvhdODzZVqRw80N1terbc",
	"sign_type": "ECDSA",
	"source_id": "52227180",
	"asset_type": 1,
	"unit": "fen"
}
```
**应答**：
```
{
	"version":"2.0",
	"sign_type":"ECDSA",
	"mch_id":"trust_mch",
	"mch_sign":"MEUCIFYS4uRRI9NP1Ce04jGZveqOp1TW14cVsCWi5QMmFXrBAiEA0dN5BSBdzbYvvW78mrb4PWlFpP308DjNPMM4wAPuwRU=",
	"chain_id":"chain_id",
	"retcode":0,
	"retmsg":"SUCCESS",
	"transaction_id":"201812170005782161",
	"asset_id":"26aQAUR1Y2hW57XcuDsYfCRgWPefD8Xk11HZdt976TLRQ7U",
	"sign_str_list":[
		{
			"id":1,
			"account":"1LpqkE1FrCrumjV4aLLn4kL5P5NbyZ1PYD",
			"sign_str":"0b1914183cd1ecf2ea79c4d65efbf8d3041eb0b29622ec5771d9241d1a2c96ab",
		}
	]
	"mch_pubkey":"AjOZgNdnh6y0pH7yYyFts2xUm13wTd6upr/6jXjiHiVW"
}
```
**应答字段解析**：
<table>
	<tr>
	<th>名称</th>	<th>类型</th>	<th>必填</th>	<th>限制</th>	<th>描述</th>
	</tr>
	<tr>
	<td>version</td>	<td>String</td>	<td>是</td>	<td>1 ≤ length ≤ 8</td>
	<td>版本号，此版本固定填写“2.0”。</td>
	</tr>
	<tr>
	<td>sign_type</td>	<td>String</td>	<td>是</td>	<td>1 ≤ length ≤ 8</td>
	<td>签名算法类型，此版本固定为 “ECDSA”。</td>
	</tr>
	<tr>
	<td>mch_id</td>	<td>String</td>	<td>是</td>	<td>1 ≤ length ≤ 32</td>
		<td>通讯方的 ID。腾讯云账号的 APPID，可从 <a href="https://console.cloud.tencent.com/developer">账号信息</a> 页面获取。</td>
	</tr>
	<tr>
	<td>mch_sign</td>	<td>String</td>	<td>是</td>	<td>1 ≤ length ≤ 256</td>
	<td>通讯方签名结果。</td>
	</tr>
	<tr>
	<td>chain_id</td>	<td>String</td>	<td>是</td>	<td>1 ≤ length ≤ 32</td>
	<td>链 ID。</td>
	</tr>
	<tr>
	<td>retcode</td>	<td>int32</td>	<td>是</td>	<td>-</td>
	<td>应答 code，成功时为0。</td>
	</tr>
	<tr>
	<td>retmsg</td>	<td>String</td>	<td>是</td>	<td>-</td>
	<td>应答信息，成功时内容为 SUCCESS。</td>
	</tr>
	<tr>
	<td>transaction_id</td>	<td>String</td>	<td>是</td>	<td>1 ≤ length ≤ 32</td>
	<td>唯一标识一次交易的 ID。</td>
	</tr>
	<tr>
	<td>asset_id</td>	<td>String</td>	<td>是</td>	<td>0 ≤ length ≤ 64</td>
	<td>资产 ID。</td>
	</tr>
	<tr>
	<td>sign_str_list</td>	<td>message 数组</td>	<td>是</td>	<td>0 ≤ length ≤ 64</td>
	<td>待签名串</td>
	</tr>
	<tr>
	<td>sign_str_list.id</td>	<td>int32</td>	<td>是</td>	<td>-</td>
	<td>序号</td>
	</tr>
	<tr>
	<td>sign_str_list.account</td>	<td>String</td>	<td>是</td>	<td>-</td>
	<td>签名账户</td>
	</tr>
	<tr>
	<td>sign_str_list.sign_str</td>	<td>String</td>	<td>是</td>	<td>-</td>
	<td>签名串。</td>
	</tr>
	<tr>
	<td>mch_pubkey</td>	<td>String</td>	<td>是</td>	<td>1 ≤ length ≤ 64</td>
	<td>通讯方公钥（支持1.2以上版本）。</td>
	</tr>
</table>

<style>
	.params{margin-bottom:0px !important;}
</style>

