本文为您详细介绍 PHP 代码规范。


PHP 常用代码规范检查工具如下：

<div class="table-wrap"><span class="expand-btn"><svg fill="currentColor" preserveAspectRatio="xMidYMid meet" height="25px" width="25px" viewBox="0 0 18 18" class="cuk-icon cuk-icon-expand null" style="vertical-align: middle;" id="fuck"><g><path d="m15.0292969 2.81425781-3.3257813.41308594c-.1160156.0140625-.1634765.1546875-.0826172.23730469l.9615235.96152343-2.69824221 2.69824219c-.05449219.05449219-.05449219.14414063 0 .19863281l.79277341.79277344c.0544922.05449219.1441407.05449219.1986328 0l2.7-2.7.9615235.96152344c.0826172.08261719.2232422.03339844.2373047-.08261719l.4113281-3.32402344c.0123047-.09140625-.0650391-.16875-.1564453-.15644531zm-7.70625002 7.06992188c-.05449219-.05449219-.14414063-.05449219-.19863282 0l-2.69824218 2.70000001-.96152344-.9615235c-.08261719-.0826171-.22324219-.0333984-.23730469.0826172l-.41308594 3.3240235c-.01054687.0914062.06503907.1669922.15644532.1564453l3.32578125-.413086c.11601562-.0140625.16347656-.1546875.08261718-.2373046l-.96152343-.9615235 2.7-2.7c.05449218-.0544922.05449218-.1441406 0-.1986328z"></path></g></svg></span><table>
<thead>
<tr>
<th>工具</th>
<th>lint 命令</th>
<th>支持 IDE</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://github.com/squizlabs/PHP_CodeSniffer">CodeSniffer</a></td>
<td>phpcs –standard=PSR12 app/</td>
<td><a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=wongjn.php-sniffer">VSCode</a>、<a target="_blank" rel="noopener" href="https://plugins.jetbrains.com/plugin/6610-php">IDEA</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/phpmd/phpmd">PHPMD</a></td>
<td>phpmd app/</td>
<td><a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=ecodes.vscode-phpmd">VSCode</a></td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/phpstan/phpstan">PHPStan</a></td>
<td>phpstan analyse app tests</td>
<td><a target="_blank" rel="noopener" href="https://marketplace.visualstudio.com/items?itemName=calsmurf2904.vscode-phpstan">VSCode</a></td>
</tr>
</tbody></table></div>

## CodeSniffer
[CodeSniffer](https://github.com/squizlabs/PHP_CodeSniffer) 内置多种规范，其中常用的 [PSR12](https://www.php-fig.org/psr/psr-12/) 规范包括下列规则：
- 每行代码最大长度 120 个字符；
- 运算符左右各 1 个空格；

安装：
```
$ composer require --dev squizlabs/php_codesniffer
```

全量检查：
```
$ ./vendor/bin/phpcs --standard=PSR12 src/
 
FILE: laravel-wechat/src/ServiceProvider.php
-------------------------------------------------------------------
FOUND 30 ERRORS AND 1 WARNING AFFECTING 12 LINES
-------------------------------------------------------------------
  43 | ERROR   | [x] Expected at least 1 space before "."; 0 found
  43 | ERROR   | [x] Expected at least 1 space after "."; 0 found
 
  91 | WARNING | [ ] Line exceeds 120 characters; contains 130 characters
 
 101 | ERROR   | [x] Expected at least 1 space before "."; 0 found
 101 | ERROR   | [x] Expected at least 1 space after "."; 0 found

```
 
本地增量检查：
```
git diff --diff-filter=d --name-only HEAD | grep ".php$" | xargs ./vendor/bin/phpcs --standard=PSR12
```

持续集成合并请求增量检查：
```
copy
sh "git diff --diff-filter=d --name-only ${env.MR_TARGET_BRANCH}... | grep '.php\$' | xargs ./vendor/bin/phpcs --standa
```
