本文为您详细介绍 CODING 持续部署中的应用与项目。

## 前提条件

使用 CODING 项目管理的前提是，您的腾讯云账号需要开通 CODING DevOps 服务，详情请参见 [开通服务](https://cloud.tencent.com/document/product/1112/37264)。 

## 进入项目

1. 登录 [CODING 控制台](https://console.cloud.tencent.com/coding)，单击团队域名进入 CODING 使用页面。
2. 鼠标移动至页面右上方的头像处，选择【团队管理】>【部署设置】>【应用】。

## 功能介绍

CODING 持续部署中的应用和项目都是属于企业/团队的一级资源，它们之间是多对多的关联关系，即一个项目可以包含多个应用，一个应用从属于多个项目。
![](https://main.qcloudimg.com/raw/5fc16ba3ed1c8a7ff1018ef7cfbc5fa3.png)
在该设计下，运维人员可以专注于应用的持续部署管理（部署流程、基础设施等），而非运维人员（一般指开发）只需要在项目维度操作（提交发布单，查看发布详情），使运维能够专注于在云的基础上做基础设施运维，开发在项目内就能够进行大部分业务运维并完成从需求到发布的完整闭环。

## 应用

应用是 CODING CD 中的基本部署单位。应用包含若干个应用集群，以及安全组和负载均衡器等。应用对部署的软件集合进行抽象，通常代表你想要部署的服务、配置、以及运行所需的基础设置。推荐的做法是一个应用对应微服务架构中的一个服务。

应用也是运维人员操作的对象，一个完整的应用包含若干个应用集群，以及安全组和负载均衡器等。应用的功能入口路径为【团队管理】>【部署设置】>【项目设置】，您可以在此管理项目绑定或解除绑定。
![](https://main.qcloudimg.com/raw/2db6f99f35a044b8117833b04ea81340.png)
单击【管理应用】可进入部署控制台新建应用，配置应用以及对应用进行部署管理和基础设施管理。
![](https://main.qcloudimg.com/raw/bb990558823dd83441a1d0d674238cb2.png)

### 准确定义应用

在微服务架构下的微服务往往对应于一个 CODING 持续部署的应用，当然您也可以在了解对应关系的情况下依照自己的偏好来设定对应关系。下面是一个典型的团队、项目、应用、集群、云账号之间的关系示例：

- 团队：XXX 科技有限公司
  - 云账号
    - 自建 Kubernetes Service Account
    - 腾讯云北京 TKE 集群 Service Account
    - 腾讯云香港 API Key
  - 项目1：车载用品电商站点项目
    - 应用1：车载电商后端
    - 应用2：车载电商前端
    - 应用3：物流管理服务
  - 项目2：服装电商站点项目
    - 应用1：服装电商后端
    - 应用2：服装电商前端
    - 应用3：物流管理服务
  - 部署控制台
    - 应用1：车载电商后端
      - 测试集群
      - 生产集群
    - 应用2：车载电商前端
      - 测试集群
      - 生产集群
    - 应用3：物流管理服务
      - 车载电商测试集群
      - 车载电商生产集群
      - 服装电商测试集群
      - 服装电商生产集群
    - 应用4：服装电商后端
      - 测试集群
      - 生产集群
    - 应用5：服装电商前端
      - 测试集群
      - 生产集群

## 应用创建

进入 CODING 部署控制台创建应用,点击导航栏【应用】>【创建应用】。在进行应用创建之前，请确保您已经完成了 [云账号绑定](https://cloud.tencent.com/document/product/1159/45162)。
![](https://main.qcloudimg.com/raw/83a78df69d0b2d70ee898f1963e7874f.png)

新建应用表单字段解释：

| 字段                                   | 是否必填       | 说明                                                         |
| -------------------------------------- | -------------- | ------------------------------------------------------------ |
| 应用名                                 | 是             | 标识应用的唯一ID                                             |
| 应用描述                               | 否             | 应用描述信息                                                 |
| 云服务                                 | 是             | 目前支持 Kubernetes 和 腾讯云服务器                          |
| 执行任务时，仅参考云服务提供的健康检查 | 布尔值，默认否 | 启用此选项后，部署控制台执行任务（如创建、销毁腾讯云伸缩组实例）时仅参考云服务商提供的健康检查。<br/>如果禁用，则由第三方服务（负载均衡器，服务发现）提供健康检查。 |
| 执行任务时，显示健康检查覆盖选项       | 布尔值，默认否 | 启用此选项后，用户可以在执行每个任务时选择是否仅由云服务商提供健康检查。 |
| 实例端口                               | 否             | 用于生成运行实例的访问链接，在应用配置页面可以更改端口号。   |
| 执行中的部署流程支持重启               | 布尔值，默认否 | 启用此选项后，用户可以重启正在执行的部署流程，此行为可能会引发异常，因此不推荐启用。 |
| 运行中的部署流程支持重复执行           | 布尔值，默认否 | 启用此选项后，用户可以以同样的参数再次启动部署流程。         |

## 应用与项目关联

在部署控制台内完成应用创建后，需要前往【团队设置】>【部署设置】中将应用与项目相关联。
![](https://main.qcloudimg.com/raw/9f5bfaa3a75aa4342eb6e595e742c02d.png)

## 新建发布单

当运维人员完成对应用的 [部署流程配置](https://cloud.tencent.com/document/product/1159/45165) 后，开发人员在项目内就可以实现从项目协同到应用发布的 DevOps 闭环。典型的场景是当有新版本需要发布时，开发人员在【持续部署】>【Kubernetes】页面新建发布单，发布单自动触发部署流程执行，开发可随时查看发布状态和历史详情。
![](https://main.qcloudimg.com/raw/efd89ed9bfa4bf586b32bf7d907bc395.png)

## 扩展设置

### 应用属性配置

进入应用详情页，单击右上方【配置】进入应用配置页面。最上方显示了创建应用时填写的应用属性。点击【编辑应用属性】，即可更新应用属性。

### 应用通知

目前支持四种通知方式：

- CODING 站内通知
- 企业微信
- 钉钉
- BearyChat

### 显示 / 隐藏功能入口

对于不需要显示的功能入口，可以在【特性】栏将其禁用，这里的禁用并不会删除相应的数据，仅表示在控制台界面隐藏。可以隐藏以下功能入口：

- 部署流程
- 集群
- 负载均衡器
- 安全组

### 添加实例的自定义属性链接

在【集群】>【服务组】>【实例详情】面板可以查看运行实例的自定义链接，自定义链接提供关于实例的简略信息，如：日志、健康状态等。

![](https://main.qcloudimg.com/raw/8a4b85d91666df3ed5c31e82d076faf7.png)

自定义链接对应的 IP 可以是公有或私有 IP，默认端口为 80；如果需要设置其他端口号，在 Path 文本框以`:`开头，如：`:7002/health`。

1. 在【链接】一栏，点击【Add Section】
   2.【Section Heading】输入自定义链接标题
   3.【Links】输入自定义链接名称，以及 URL

URL 字段支持使用表达式引用更多的实例属性。例如对于腾讯云实例，可以使用`{region}`引用实例的所在地域。

![](https://main.qcloudimg.com/raw/33707d942d0d3f0aaf3d5c2cfb82ab8d.png)

4. 单击【Add Link】在同一属性下添加更多链接。
5. 单击【Add Section】添加新的自定义属性链接。
6. 单击【撤销】取消添加操作。【撤销】不会删除已保存的自定义属性链接。
7. 单击【保存】完成操作。

### 流量保护

流量保护旨在确保任何时间至少有一个实例处于正常运行状态。

启用流量保护功能后，如果用户或者脚本尝试删除、禁用或对服务组进行伸缩容操作，CODING 控制台会对操作进行验证以确保集群中至少有一个实例在正常运行，否则将会拒绝用户或脚本请求。

1. 在【流量保护】栏，点击【添加流量保护】。
2. 以下是需要填写的字段：

| 字段   | 必填项 | 说明                                                         |
| ------ | ------ | ------------------------------------------------------------ |
| 云账号 | 是     | 设置流量保护的云账号                                         |
| 地域   | 是     | 可选的地域，`*`表示选择所有地域                              |
| 分组   | 否     | 设置流量保护的集群分组，如果留空表示选择不属于任何分组的集群 |
| 详情   | 否     | 详情是区分集群的三级字段，具有相同 `${Application}-${Stack}-${Detail}` 的服务组属于同一个集群 |

3. 单击【保存】使配置生效。

### 应用删除

1. 如果应用中有服务组，需要先删除服务组。
2. 在应用列表页，选择要删除的应用。
3. 单击【配置】。
4. 滑动到页面底部即可删除应用。
