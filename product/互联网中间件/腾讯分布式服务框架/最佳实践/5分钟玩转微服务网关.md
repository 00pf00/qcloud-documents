## 五分钟玩转微服务网关

本文帮助您用从0开始用5分钟时间部署微服务网关、通过微服务网关对外暴露微服务API并为API设置访问权限、限流策略。

腾讯云 TSF 提供了微服务网关 SDK 并封装了限流、密钥对鉴权、第三方鉴权、设置访问标签等等功能，方便用户在界面上管理微服务API。用户需要自行准备计算资源（虚拟机或容器）将微服务网关部署，并导入微服务API。

流程

1. 部署微服务网关
2. 通过微服务网关托管微服务API
3. 设置API限流策略



### 步骤1：部署微服务网关

1. 创建微服务网关应用

   登陆腾讯云TSF控制台，点击应用管理，新建应用，应用类型选择微服务网关应用。

   ![](https://main.qcloudimg.com/raw/24f7aaec58cca7ce5ebfa6c81c5906e5.png)

2. 部署微服务网关应用

   点击应用管理，点击新建好的微服务网关应用，进入应用详情页，上传程序包。这里给出不包含任何自定义过滤器的微服务网关Demo [下载链接](https://alon-deployment-gz-1257356411.cos.ap-guangzhou.myqcloud.com/tsf-demo-simple-1.16.0.zip?_ga=1.250118594.510479937.1548238548) ，将文件中 zuul - demo进行打包，上传。

   新建部署组，将网关部署在希望对外暴露微服务API的微服务所在的命名空间中。有关全局命名空间、非全局命名空间对微服务网关的影响，请参考 [部署微服务网关](https://cloud.tencent.com/document/product/649/40200)。

   ![](https://main.qcloudimg.com/raw/6c5e6df8c2d4582c17cd9b1a00c2c0e7.png)

   部署应用。

3. 为微服务网关设置外网访问VIP
   - 当微服务网关部署在虚拟机上时，可以为部署组下机器配置负载均衡，详情请参考[负载均衡使用说明](https://cloud.tencent.com/document/product/214/8975)。
   - 当微服务网关部署组在容器上时，可以设置容器部署组访问方式为外网访问，详情请参考[容器部署组访问方式](https://cloud.tencent.com/document/product/649/16929)。

说明：提供的Demo端口默认为8080，可通过启动参数进行调整。



步骤2：通过微服务网关托管微服务API

1. 点击组建中心 - 微服务网关 - 分组管理页面，新建分组

2. 填写分组名称，最长60个字符

3. 填写访问context。context是用户访问网关管理的某一个API的路径的路径参数。以“/”开头，不能为空。在这个例子中，添加为 /myfirsttest

4. 选择鉴权类型：密钥对鉴权或免鉴权。当选择密钥对鉴权时，请求参数中不带正确的 secret id和签名的访问会被拒绝。

![](https://main.qcloudimg.com/raw/fdf3e10ccf43c6441d411b320cd0f060.png)

5. 将分组与步骤1中创建的微服务网关应用的部署组进行绑定。请注意这里绑定的是创建的微服务网关应用的部署组，而不是需要对外暴露接口的微服务的部署组。

6. 导入API，选择对外暴露的微服务下的API

   ![](https://main.qcloudimg.com/raw/66f9f9dab619c474cd116fb6a31b81d8.png)

7. 发布分组。发布之后，即可通过访问微服务网关的部署组 + 分组下的 API 访问路径对API进行访问了。



有关访问路径的说明：

微服务网关访问路径为：

微服务网关域名或ip+port /分组contxt/微服务所在命名空间/微服务名称/API path

如我们创建了一个应用类型为微服务网关的应用，部署组中节点ip为 10.10.10.10，端口为8080，希望访问命名空间为default的微服务provider，api路径为 /echo，为此创建了一个访问路径为 test的分组。此时访问路径为

10.10.10.10:8080/test/default/provider/echo

其中，微服务网关的默认端口为8080，用户可以通过修改启动参数对网关默认端口进行修改。



有关为微服务网关所在的部署组配置对外VIP的说明：

- 当微服务网关部署在虚拟机上时，用户可以将微服务网关所在的部署组的机器挂载在腾讯云负载均衡实例后面。详情请参考[负载均衡文档](https://cloud.tencent.com/document/product/214/8975)。
- 当微服务网关部署在容器上时，且需要将微服务 API 暴露在公网访问，则在新建容器部署组时，选择公网访问方式。详情请参考：[容器部署组访问方式](https://cloud.tencent.com/document/product/649/16929)。



### 步骤3：为微服务API设置限流

1. 点击微服务网关 - 分组管理，查看分组详情中 API列表页面

2. 为已经导入的API设置限流

   ![](https://main.qcloudimg.com/raw/57542c30b07c5f175a27e3815206515f.png)


