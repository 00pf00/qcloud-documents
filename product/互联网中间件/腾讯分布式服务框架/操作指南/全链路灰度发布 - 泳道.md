# 泳道的配置

使用全链路灰度发布之前，需要先配置泳道。一条泳道相当于一个灰度环境，环境中包含的是应用中需要进行灰度测试的部署组。在全链路发布概述中的示例图中，我们希望为不同微服务的版本2创建一条泳道，将微服务A、B、D部署版本2的部署组都放在一个泳道中。

假设当前访问链路为 gateway -> consumer -> provider。其中consumer、provider都有两个版本。希望通过请求参数test = 1时配置流量通过网关访问到consumer、provider的版本1 中。

### 新建泳道

1. 登陆腾讯微服务平台TSF，在全链路灰度发布页面点击泳道配置，点击创建泳道。

2. 填写泳道的名称和备注。

3. 向泳道中导入部署组。

![](https://main.qcloudimg.com/raw/3cc50a5c8443931fba7536226740718b.png)

   在选择部署组页面用户可以将部署组导入泳道中。

   此时，我们需要创建一个泳道，将gateway、consumer的版本1部署组、provider的版本1部署组添加到这个泳道中。设置gateway为泳道的入口。

**过滤条件**

用户可以通过选择命名空间类型、命名空间名称、应用名称和部署组名称进行筛选过滤部署组。默认提供了命名空间类型和命名空间名称作为过滤条件。

当用户希望切换命名空间时，需要用户点击当前已经选中的命名空间的名称，在弹出的下拉列表中切换，如上图所示。

当用户希望通过应用名称筛选部署组时，可以点击命名空间右侧的空白位置，便可弹出应用和部署组的下拉选项，如图所示。

![](https://main.qcloudimg.com/raw/54f15009259fcd7a99adc1b586ce885a.png)



**泳道入口**

全链路灰度发布规则配置后，会在泳道的入口部署组上对请求规则进行校验，以此来判断请求是否应该进入某一个泳道中。通常情况下，泳道入口是一个网关。

同一个泳道中支持多个入口，在请求经过每一个入口部署组时，都会判断请求是否应该进入泳道中。

配置方法：在选择部署组页面勾选需要被导入到泳道中部署组后，在穿梭框的右侧通过“泳道入口”开关配置。



**泳道与命名空间**

当前TSF支持两种命名空间：全局命名空间和普通命名空间。有关命名空间的说明请参考文档《全局命名空间》。

由于普通命名空间之间访问隔离，同一个泳道中不能包含不同普通命名空间中的部署组。

泳道中可以包含全局命名空间中的部署组和普通命名空间中的部署组。



### 删除泳道

1. 登陆腾讯微服务平台TSF，在全链路灰度发布页面点击泳道配置。
2. 删除不需要的泳道。
3. 当泳道上已经绑定了全链路灰度发布的规则，则不能删除。



### 编辑泳道

1. 登陆腾讯微服务平台TSF，在全链路灰度发布页面点击泳道配置。
2. 点击进入需要编辑的泳道详情页。
3. 可以在基本信息卡片编辑泳道的名称和备注。
4. 可以在部署组管理卡片中向泳道添加和删除部署组，或设置某个部署组为泳道入口。









