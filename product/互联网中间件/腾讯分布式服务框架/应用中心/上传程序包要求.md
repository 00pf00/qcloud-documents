目前虚拟机应用支持的程序包格式包括 jar 、tar.gz 和 zip。
- jar： FatJar 格式的程序包，用户可以参考 [如何打 FatJar 包](https://cloud.tencent.com/document/product/649/16934)。
- tar.gz 、zip ： 压缩包中 **必须** 包含三个文件：
  - start.sh：启动脚本
  - stop.sh：停止脚本
  - cmdline：用于检查应用进程是否存在

| 文件类型 | 启动方式                                                     |
| -------- | ------------------------------------------------------------ |
| jar      | 虚拟机上的 agent 会使用 `jar -jar` 命令启动程序              |
| tar.gz   | 虚拟机上的 agent 会解压压缩包，使用解压目录下的 `start.sh` 脚本启动应用程序 |
| zip      | 虚拟机上的 agent 会解压压缩包，使用解压目录下的 `start.sh` 脚本启动应用程序 |



### start.sh / stop.sh / cmdline 说明
以一个 Python 应用的压缩包为示例，解压后的文件目录如下：
- promotionService.py
- start.sh
- stop.sh
- cmdline

start.sh 启动脚本内容如下：
```python
#! /bin/bash

already_run=`ps -ef|grep "python promotion"|grep -v grep|wc -l`
if [ ${already_run} -ne 0 ];then
	echo "promotionService already Running!!!! Stop it first"
	exit -1
fi

nohup python promotionService.py 8093 &
```

stop.sh 停止脚本内容如下：
```python
#!/bin/bash

pid=`ps -ef|grep "python promotion"|grep -v grep|awk '{print $2}'`
kill -SIGTERM $pid
echo "process ${pid} killed"
```

cmdline 检测进程脚本，agent 通过 `ps aux | grep 'cmdline 内容'` 来检测进程是否存在，示例如下：

```
python promotion
```

### cmdline 更多说明

如果启动应用是 Java 应用，启动脚本中通过 `java -java xxx.jar` 来启动应用。在 cmdline 文件中使用完整的 java 启动命令。例如启动脚本中包含如下启动命令：

```
java -Xms128m -Xmx512m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=512m -jar consumer-demo-0.0.1-SNAPSHOT.jar
```

那么在 cmdline 中内容为：

```
java -Xms128m -Xmx512m -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=512m -jar consumer-demo-0.0.1-SNAPSHOT.jar
```

当应用启动后，agent 会在服务器上执行 `ps aux | grep 'cmdline 内容'` 来检查进程是否存在。

![](https://main.qcloudimg.com/raw/d13fea5b8c7c59b091bfca894c9eadaa.png)

