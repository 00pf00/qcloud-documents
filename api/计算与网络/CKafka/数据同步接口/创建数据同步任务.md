## 1. 接口描述

本接口 (AddConnector) 用于在 CKafka 实例下修改主题属性。

接口请求域名：`ckafka.api.qcloud.com`

## 2. 输入参数

以下请求参数列表仅列出了接口请求参数，其它参数见 [公共请求参数](https://cloud.tencent.com/doc/api/431/5883) 页面。

| 参数名称 | 必选 | 类型 | 描述 |
| --- | --- | --- | --- |
| zoneId | 否 | String | 可用区Id。|
| description | 是 | String | connector 描述。 |
| connectorClass| 是 | String | 执行该任务的class名称，不同种类的同步connector有不同的名称，当前ckafka不同实例之间的同步就是com.tencent.ckafka.replicator.KafkaSourceConnector。当前现在仅支持com.tencent.ckafka.replicator.KafkaSourceConnector。|
| config | 是 | json string  | 具体实例参见下节配置说明描述。 |
| name |否|string|connector 名称。|

## 3. 配置说明

### 3.1 基础配置

| 配置项 | 必选 | 类型 | 配置说明 |
| --- | --- | --- | --- |
|src.broker	|选填|	string | 源kafka broker地址。|
|dest.broker	|选填	|string	|目的kafka broker地址。|
|src.instance	|选填	|string	|源实例名称。|
|dest.instance	|选填	|string|	目标实例名称。|
|connector.class|	必填|	string	|目前仅支持com.tencent.ckafka.replicator.K2KSourceConnector 任务，后续会有更多connector类型。|
|tasks.max	|必填	|string|	同步的线程数量。|
|quota.value|	选填|	string|	connector流控阈值。|
|quota.unit	|选填	|string	|BANDWIDTH 流控单位:BANDWIDTH:流量/mbps  RECORD:记录数/条。 |
|quota.strategy	|选填|	string| org.apache.kafka.connect.storage.SimpleStrategy	流控策略SimpleStrategy，平均分配流控给各个Task 。|


基础配置说明:
1. 业务connector不能写基础配置的配置项，只能从中读取；
2. dest.instance和dest.broker，优先使用dest.broker配置；src.instance和src.broker同理；
3. 流控相关参数参数根据connector的类型进行不同方向的流控:sourceconnector则控制从源kafka集群拉取消息的速率；sinkconnector则控制将数据导入目的kafka集群的速率。


### 3.2 业务配置
| 配置项 | 必选 | 类型 |默认值| 配置说明 |
| --- | --- | --- | --- |---|
|auto.create	|选填|	string	|false|	是否在目标集群创建topic，如果设置为false，topic不存在会停止任务|
|keep.partition|	选填|	string	|false|	源/目的端集群的topic的partition数是否必须保持一致，如果设置为true，不一致时会停止任务|
|topic.regex|	选填	|string	|N/A	|用正则表达式匹配topic|
|topic.regex.{key}|	选填|	string	|N/A|	匹配topic的正则表达式|
|topic.regex.{key}. dest.prefix|	选填|	string|	N/A|	目的端集群创建topic时，在源topic名称的基础上加上前缀|
|topic.regex.{key}. dest.suffix	|选填	|string	|N/A|	目的端集群创建topic时，在源topic名称的基础上加上后缀|
|topic.regex.{key}.blacklist|	选填|	string|	false|	是否为黑名单配置|
|topic.regex.{key}.offset.reset|	选填	|string|	earliest|	
|topic.regex.{key}.offset.offset|	选填|	string|	N/A	|
|topic.regex.{key}.offset.timestamp|	选填|	string	|N/A	|
|topic.config|	选填|	string|	N/A|	单个topic复制配置|
|topic.config.{key}|	选填	|string|	N/A|	topic名称|
|topic.config.{key}.dest.topic|	选填	|string|	N/A|	目的端topic名称，默认与源端保持一致|

业务配置说明：

1. connector开始工作的offset设置，默认从earliest开始，同时配置多个时，优先级从低到高为: reset < offset < timestamp；
2. 配置优先级:  黑名单topic > 单个topic > 正则topic > 全局topic

优先级示例说明：

1.如果topicA在topic.config中配置了，同时也符合正则表达式配置topic.*，这个时候topicA以topic.config的配置为准；
2.如果topicA配置了auto.create=true，全局配置了auto.create=false，这个时候auto.create=true；
3.topicA符合正则表达式规定的黑名单，即使在topic.config中配置了，也不会生效。

### 3.3 业务配置示例
```
{
    "connector.class":"com.tencent.ckafka.replicator.K2KSourceConnector",  // 当前只支持这种类型数据同步方式
    "src.instance":"ckafka-9comx6cs",  //  源实例
    "dest.instance":"ckafka-jizhaw80",  // 目的实例
    "topic.config":{  // topic 同步配置
        "date":{  // 源topic名称
            "dest.topic":"date"   // 目的topic名称
        }
    }
}
```


## 4. 示例

输入：
config: "{"connector.class":"com.tencent.ckafka.replicator.K2KSourceConnector","src.instance":"ckafka-9comx6cs","dest.instance":"ckafka-jizhaw80","topic.config":{"date":{"dest.topic":"date"}}}"
connectorClass: "com.tencent.ckafka.replicator.K2KSourceConnector"
description: null
name: "test"
zoneId: 200004

```
 https://domain/v2/index.php?Action=AddConnector&description=test&name=test&zoneId=200004&connectorClass=com.tencent.ckafka.replicator.K2KSourceConnector&config=xxx&<公共请求参数>
```

输出：

```
  {
      "code" : 0,
      "codeDesc":"Success"
      "message" : "ok",
  }

```
